(function(a){a.getScript=function(c,f,d){var b=true;var e=[];if(!!d&&typeof d=="object"){b=d.cache?d.cache:false;e=d.parameter?d.parameter:[]}else{if(!!d&&typeof d=="boolean"){b=d}}window.setTimeout(function(){a.ajax({type:"GET",url:c,success:function(){try{if(typeof f!=="undefined"){f.apply(this,(e))}}catch(g){}},dataType:"script",scriptCharset:"gbk",cache:b})},0)};a.getCss=function(c,e){var b=document.getElementsByTagName("head")[0];function d(f,h){var g=document.createElement("link");g.setAttribute("rel","stylesheet");g.setAttribute("type","text/css");if(h){g.charset=h}g.setAttribute("href",f);b.appendChild(g)}if(typeof c==="string"){d(c,e)}else{if(a.isArray(c)){a.each(c,function(f){d(c[f],e)})}}};a.addStyle=function(f){if(document.all){var d=document.createStyleSheet();for(var c in f){d.addRule(c,f[c])}}else{var e=document.createElement("style");e.type="text/css";var b=[];for(var c in f){b.push(c+"{"+f[c]+"}")}e.innerHTML=b.join(" ");document.getElementsByTagName("HEAD").item(0).appendChild(e)}};a.Buffers=function(){this._s=new Array};a.Buffers.prototype={append:function(b){this._s.push(b)},toString:function(){var b=this._s.join("");this._s.length=0;return b}};if(a.cookie){return}a.cookie=function(e,f,c){if(arguments.length>1&&String(f)!=="[object Object]"){c=a.extend({},c);if(f===null||f===undefined){c.expires=-1}if(typeof c.expires==="number"){var h=c.expires,d=c.expires=new Date();d.setDate(d.getDate()+h)}f=String(f);return(document.cookie=[encodeURIComponent(e),"=",c.raw?f:encodeURIComponent(f),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join(""))}c=f||{};var b,g=c.raw?function(i){return i}:decodeURIComponent;return(b=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?g(b[1]):null};a.getParm=function(d,i){var c=d?d:window.location.toString();var e;if(c&&c.indexOf("?")){var b=c.split("?");var f=b[1];var h={};if(f&&f.indexOf("&")){var g=f.split("&");jQuery.each(g,function(j,l){if(l&&l.indexOf("=")){var k=l.split("=");if(i){if(typeof(i)=="string"&&i==k[0]){e=k[1]==null?"":k[1];return e}}else{h[k[0]]=k[1]}}})}}return h}})(jQuery);(function(c,d){function a(f,g){var e=new Image();e.src=f;g({width:e.width,height:e.height})}var b=function(g,e){this.file=d(g);this.img=new Image();this._preload=null;this._data="";this._name="";var f=this._setOptions(e);this._size=this._getFileSize();this.ratio=f.ratio;this.maxWidth=f.maxWidth;this.maxHeight=f.maxHeight;this.$panel=d(f.panel);var h=this;this.$panel.find(".close").click(function(){h.clearFile()});this._getData=this._getDataFun(f.mode);this._show=f.mode!=="filter"?this._simpleShow:this._filterShow};b.MODE=d.browser.msie?((d.browser.version==="7.0"||d.browser.version==="8.0"||d.browser.version==="9.0")?"filter":"simple"):"domfile";b.TRANSPARENT="http://comment.news.sohu.com/upload/comment4_1/images/space.gif";b.prototype={preview:function(){if(this.file){this._getFileName();if(!this.name){return}if(!/((\.gif)|(\.png)|(\.jpg)|(\.jpeg))$/ig.test(this.name)||this.size/(1024*1024)>5){this.clearFile();d(this.options.select_panel).find(".message").html("文件格式不支持,请选择5M以内的JPG、GIF、PNG图片文件").addClass("notice");return}var e=this;this._getData(function(f){e._preview(f)})}},clearFile:function(){if(d.browser.msie){this.file.replaceWith('<input type="file" accept="image/gif,image/jpeg,image/x-png" name="imgfile" class="uploadfile"/>')}else{this.file[0].value=""}this.$panel.hide();this.options.onClearFile&&this.options.onClearFile(this)},_setOptions:function(e){this.options={mode:b.MODE,ratio:0,maxWidth:0,maxHeight:0,container:"",select_panel:"",panel:"",onAfterShow:null,onClearFile:null};return d.extend(this.options,e||{})},_afterPreview:function(){d(this.options.select_panel).hide();var e=d(this.options.panel).find(".filename").height()+d(this.options.panel).find(".preview").height()+38;d(this.options.panel).find(".preview_panel_middle").height(e+"px");this.options.onAfterShow&&this.options.onAfterShow(this)},_getDataFun:function(e){switch(e){case"filter":return this._filterData;case"domfile":return this._domfileData;case"simple":default:return this._simpleData}},_filterData:function(h){this.file.select();try{var f=document.selection.createRange().text}catch(g){f=null}h(f)},_getFileName:function(){if(this.file[0].files&&this.file[0].files[0]){var f=this.file[0].files[0];this.name=f.name}else{if(this.file[0].value){var g=this.file[0].value;this.name=g.substring(g.lastIndexOf("\\")+1)}else{try{var g=document.selection.createRange().text;this.name=g.substring(g.lastIndexOf("\\")+1)}catch(h){}}}},_getFileSize:function(){if(this.file[0].files&&this.file[0].files[0]){var e=this.file[0].files[0];this.size=e.size||0}},_domfileData:function(g){var f=this.file[0].files[0];if(typeof c.webkitURL!="undefined"){g(c.webkitURL.createObjectURL(f))}else{if(f.getAsDataURL){g(f.getAsDataURL())}else{if(c.FileReader){var e=new FileReader();e.onloadend=function(h){g(this.result)};e.readAsDataURL(f)}else{if(c.URL&&c.URL.createObjectURL){g(c.URL.createObjectURL(f))}else{g(null)}}}}},_simpleData:function(f){var e=this.file[0].value;f(e)},_preview:function(e){this._data=e;this._show()},_simplePreload:function(){if(!this._preload){var e=this._preload=new Image(),f=this,g=function(){f._imgShow(f._data,this.width,this.height)};this._onload=function(){this.onload=null;g.call(this)};e.onload=d.browser.msie?this._onload:g;e.onerror=function(){f._error()}}else{if(d.browser.msie){this._preload.onload=this._onload}}},_simpleShow:function(){this.$panel.find(".filename").html(this.name).attr("title",this.name);if(this._data){this._simplePreload();this._preload.src=this._data}else{this._NotShowInfo()}this._afterPreview()},_filterPreload:function(){if(!this._preload){var f=this._preload=document.createElement("div");d(f).css({width:"150px",visibility:"hidden",position:"absolute",left:"-9999px",top:"-9999px",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='image')"});var e=document.body;e.insertBefore(f,e.childNodes[0])}},_filterShow:function(){this._filterPreload();this.$panel.find(".filename").html(this.name).attr("title",this.name);if(!this._data){this._NotShowInfo()}else{var f=this._preload,i=this._data.replace(/[)'"%]/g,function(e){return escape(escape(e))});try{f.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=i}catch(j){this._error("filter error");return}if(i.indexOf("%2529")<0){this.img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"+i+"')";var g=this;this.img.src=b.TRANSPARENT;var h=this;a(i,function(e){h._imgShow(b.TRANSPARENT,e.width,e.height)})}else{this._NotShowInfo()}}this._afterPreview()},_imgShow:function(j,i,e){this.$panel.find(".filename").html(this.name).attr("title",this.name);if(!j){this._NotShowInfo();return}i=i>0?i:this.maxWidth;e=e>0?e:this.maxHeight;var f=this.img,h=f.style,g=Math.max(0,this.ratio)||Math.min(1,Math.max(0,this.maxWidth)/i||1,Math.max(0,this.maxHeight)/e||1);h.width=Math.round(i*g)+"px";h.height=Math.round(e*g)+"px";f.src=j;this.$panel.find(".preview_panel_middle");this.$panel.show().find(".preview").html("").append(f);this._afterPreview()},_NotShowInfo:function(){this.$panel.show().find(".preview").html("<p style='height:50px; text-align:center;line-height:50px;'>暂时无法预览此图片</p>")},_error:function(e){d(this.options.select_panel).show();this.$panel.hide();this.clearFile();d(this.options.select_panel).find(".message").html("图片无法预览,请选择5M以内的JPG、GIF、PNG图片文件").addClass("notice");return}};c.ImagePreview=b})(window,jQuery);(function(e){function b(g){}function a(i,j,g){var h=new Image();h.src=i;if(h.width===0||h.height===0){e(h).bind("load",function(){try{j({width:h.width,height:h.height})}catch(k){}});e(h).bind("error",g)}else{j({width:h.width,height:h.height})}}var c=navigator.userAgent,d=/msie/i.test(c)&&!window.opera;function f(j,k){var h=j.clientWidth,i=j.clientHeight;if(d&&e.browser.version==="6.0"){return}if(d){cosDeg=Math.cos(k*Math.PI/180);sinDeg=Math.sin(k*Math.PI/180);var g=j.filters.item(0);g.M11=g.M22=cosDeg;g.M12=-(g.M21=sinDeg);e(j).css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+g.M11+",M12="+g.M12+",M21="+g.M21+",M22="+g.M22+",SizingMethod='auto expand')")}else{if(j.style.MozTransform!==undefined){j.style.MozTransform="rotate("+k+"deg)"}else{if(j.style.OTransform!==undefined){j.style.OTransform="rotate("+k+"deg)"}else{if(j.style.webkitTransform!==undefined){j.style.webkitTransform="rotate("+k+"deg)"}else{j.style.transform="rotate("+k+"deg)"}}}}}e.fn.extend({ImagePowerView:function(n){var i={warper:null,max_size:{width:500,height:10000},big_img_size:null,big_rotate_size:null,min_size:{width:120},IsPowerShow:false,big_img:null,source_img:null,small_img:null,angle:0};var j=this;if(this[0]["tagName"]!=="IMG"){return}function h(){i.max_size.width=j.parent().width()>600||j.parent().width()<=0?i.max_size.width:j.parent().width()-110;if(this.attr("data-big")&&this.attr("data-source")){i.small_img=this.attr("src");i.big_img=this.attr("data-big");i.source_img=this.attr("data-source")}else{if(/_c120$/ig.test(this.attr("src"))){i.small_img=this.attr("src");if(/\.gif/ig.test(this.attr("src"))){i.big_img=i.source_img=i.small_img.replace(/_c120$/ig,"")}else{i.big_img=i.small_img.replace(/_c120$/ig,"_w500");i.source_img=i.small_img.replace(/_c120$/ig,"")}}else{i.big_img=i.big_img||this.attr("src");i.source_img=i.source_img||this.attr("src");i.small_img=this.attr("src")}}this.addClass("scale_img_big").css({filter:"progid:DXImageTransform.Microsoft.Matrix(sizingmethod='auto expand');"}).css(i.min_size);this.wrap("<div class='powerviewer_warper clear'></div>");i.warper=j.parent();i.warper.css({width:i.max_size.width+80,"max-height":i.max_size.height,overflow:"hidden"});this.bind("click",function(){if(i.IsPowerShow){l()}else{m()}});a(i.small_img,function(o){i.min_size.height=120*o.height/o.width});a(i.big_img,function(o){var q=Math.min(1,Math.max(0,i.max_size.width)/o.width||1,Math.max(0,i.max_size.height)/o.height||1);var p=Math.min(1,Math.max(0,i.max_size.width)/o.height||1,Math.max(0,i.max_size.height)/o.width||1);i.big_img_size={width:o.width*q,height:o.height*q};i.big_rotate_size={width:o.width*p,height:o.height*p}})}var g=this;a(this[0]["src"],function(){h.apply(g)},function(){g.remove()});function m(){if(i.IsPowerShow){return}i.IsPowerShow=true;html="<div class='control_bar'><a href='javascript:void(0)' class='img-away hide'>收起</a>|<a class='img-source' href='"+i.source_img+"' target='_blank'>查看原图</a>|<a href='javascript:void(0)'  class='img-left-rotation turn_left'>向左转</a>|<a  href='javascript:void(0)' class='img-right-rotation turn_right'>向右转</a></div>";i.warper.addClass("powerviewer_warper_active").prepend(html);j.attr("src",i.big_img).css(i.big_img_size).removeClass("scale_img_big").addClass("scale_img_small");i.warper.find(".hide").bind("click",function(){l()});i.warper.find(".turn_left").bind("click",function(){k(i.angle-90)});i.warper.find(".turn_right").bind("click",function(){k(i.angle+90)});i.warper.parents(".floor-bord").find("h5").addClass("hide").removeClass("hide");i.scrollY=window.scrollY}function l(){if(!i.IsPowerShow){return}i.IsPowerShow=false;k(0,true);j.attr("src",i.small_img);j.css(i.min_size).removeClass("scale_img_small").addClass("scale_img_big");i.warper.removeClass("powerviewer_warper_active").find(".control_bar").remove();i.warper.parents(".floor-bord").find("h5").addClass("hide").removeClass("hide");if(i.big_img_size.height>window.screen.availHeight){window.scrollTo(0,j.position().top-100)}}function k(q,p){if(e.browser.msie&&e.browser.version==="6.0"){return}if(Math.abs((q/90)%2)===1){j.css({position:"relative"});j.css(i.big_rotate_size);i.warper.css({height:i.big_rotate_size.width+40});if(!d){j.css({left:((0+i.big_rotate_size.height-i.big_rotate_size.width)/2)+"px",top:((i.big_rotate_size.width-i.big_rotate_size.height)/2)+"px"})}}else{j.css({position:""});j.css(i.big_img_size);var o=i.big_img_size.height+40+"px";o=p?"auto":o;o==="auto"?i.warper.css({height:o}):i.warper.css({height:o});if(!d){j.css({left:"auto",top:"auto"})}}f(j[0],q);i.angle=q;i.warper.parents(".floor-bord").find("h5").addClass("hide").removeClass("hide")}}})})(jQuery);(function($){var p={comments:{}};p.Model=function($t,opts){p.me=this;this.$layout=$t;this.opts=opts;if(!opts.editor){return}this.Init()};p.Model.prototype={Init:function(){var _t=this;_t.inputHTML();_t.InputEvts();_t.ImgUpEvt();_t.getFaceImg();if(this.opts.canShareToQuanzi){$.fn.shareToQuanzi.init({container:".comment .reshipmentShare",topicId:this.opts.topicId})}},inputHTML:function(){var _t=this,$opts=_t.opts,$layout=_t.$layout,inputInf={};if($opts.simpleMode){$opts.$comm_nameInfoad=""}$.extend(inputInf,{login_rePic:$opts.$login_rePic,login_reLink:$opts.$login_reLink,icon:$opts.$icon,comm_newmsg:"",comm_nameInfoad:$opts.$comm_nameInfoad,inputbox_topright_adver:$opts.$inputbox_topright_adver,inputbox_topright_adver2:$opts.$inputbox_topright_adver2,comm_textAD:$opts.comm_textAD});if($opts.simpleMode){$opts.$comm_nameInfo=$opts.$comm_nameInfoSimple;$opts.$comm_setInfo=""}if($opts.picComm){var theFile={allCount:0,valueCount:0};if(window[$opts.tab_file_n]){theFile=eval($opts.tab_file_n)}$.extend($opts,{picQuickTextAD:"看新闻，说两句"});var $cntCbtn=$($opts.picArea||"#contentA .control .btn");if($cntCbtn.length>0){$cntCbtn.append($.fn.commMain.ParseTpl(thecode.commModel.PicSimpleSubmit,{valueCount:theFile.valueCount,topicId:$opts.topicId,inputValue:$opts.picQuickTextAD}));$cntCbtn.find(".review-layer-in textarea").bind("keyup",function(e){if(e&&e.stopPropagation){e.stopPropagation()}else{window.event.cancelBubble=true}});var cntBtn="#contentA .control .btn ";var $cntQikBtn=$(cntBtn+".review-btn"),$picPlayBtn=$(cntBtn+".play"),$cntQikLay=$(cntBtn+".review-layer");if($.browser.msie&&($.browser.version=="6.0")&&!$.support.style&&!$opts.picArea){$cntQikLay.css({background:'url("http://pic.sohu.com/upload/pic/images/review_layer_bg.png")',height:26})}var $btnLeft=$cntQikBtn.offset().left;if(!$opts.picLayerCss){var $btnWidth=$cntQikBtn.width();$cntQikLay.css({left:$btnLeft+7,top:83})}else{$cntQikLay.css($.extend($opts.picLayerCss,{left:$btnLeft+7}))}$picPlayBtn.remove();$cntQikLay.hide();$cntQikBtn.hide();$(cntBtn+".review-num").hide()}}if($opts.login){$opts.pp.xpt=$opts.pp.base64;if($opts.pp.icon==""){$opts.pp.icon=$opts.$icon}$.extend(inputInf,$opts.pp,{login_reLink:$opts.$comm_setInfo,comm_newmsg:"",comm_nameInfoad:$opts.$comm_nameInfo,inputbox_topright_adver:$opts.$inputbox_topright_adver,inputbox_topright_adver2:$opts.inputbox_topright_adver2,setUrl:$opts.$setUrl})}if($opts.simpleMode){$layout.css("width",$opts.frameWidth+30);$layout.append($.fn.commMain.ParseTpl(thecode.commModel.textstrSimple,inputInf));$layout.find(".remark").width($opts.frameWidth);$layout.find(".remark .form .comInput .comBord").css("background","none");$layout.find(".remark textarea").width($opts.frameWidth-15);$($opts.comBord).text($opts.comm_textAD);$($opts.comBord).addClass("opinion")}else{$layout.append($.fn.commMain.ParseTpl(thecode.commModel.textstr,inputInf));this.checkOpenImg($layout,$opts)}if($opts.pageList){$layout.children(".remark").find(".r .comm-jifen").hide();$layout.children(".remark").find(".r .newReply").hide()}else{$layout.children(".remark").find(".r .comm-jifen").show();$layout.children(".remark").find(".r .newReply").show()}if($opts.login){$($opts.comBord).addClass("opinion");$.fn.commMain.commJifen.getUserInfo();$.fn.commMain.commJifen.getUpgradeInfo();var CommUrl={testStr:["u31195732_1357f33ee4eg213","u21709311_134bc19f3c4g214","e362255_12e8c8c119cg213"],doUrl:true};var icon="",localUrl=window.location;$.each(CommUrl.testStr,function(i,n){icon=inputInf.icon;if(icon.indexOf(n)>-1){$.get("http://123.125.116.20/stat/userAccessRecord.jsp?url="+localUrl)}});if(inputInf.icon.indexOf("nobody.gif")==-1){$($opts.reLink).find(".setPic").remove()}else{$($opts.reLink).find(".setPic").show()}if($opts.pp.userId.indexOf("sohuh")==-1){$($opts.reLink).find(".setPass").remove();$($opts.nameInfo).find(".set-nickname").hide()}else{}}},checkOpenImg:function($layout,$opts){var mode=$opts.openImage;mode===0?$layout.find("li.img").show():$layout.find("li.img").remove();if(mode===0&&!$.cookie("comment_closetips")){$layout.find("div.tips").show();$layout.find("li.img").click(function(e){$("li.img div.tips").hide();var expdate=new Date();var expdate2=new Date();expdate2.setHours(23,59,59);expdate.setTime(expdate2.getTime());$.cookie("comment_closetips","1",{expires:expdate,path:"/",domain:"sohu.com"})})}},InputEvts:function(){var _t=this,$opts=_t.opts,$layout=_t.$layout;if(!$opts.login){$($opts.rePic).find("a").attr("target","");$($opts.reLink).find("a").eq(0).bind("click",function(){$.regMonitor("normalloginopen");$.CommentLogin.commnetLoginInit(SohuComment.login)});$($opts.reLink).find("a").eq(1).bind("click",function(){$.regMonitor("normalregister");$.CommentLogin.commentRegInit(SohuComment.login);return false});if($opts.simpleMode){$($opts.reLinkSimple).find("a").eq(0).bind("click",function(){$.CommentLogin.commnetLoginInit(SohuComment.login)});$($opts.reLinkSimple).find("a").eq(1).bind("click",function(){$.CommentLogin.commentRegInit(SohuComment.login)})}}$($opts.comBord).bind("keyup",_t.inputKey).bind("paste",_t.inputKey).bind("cut",_t.inputKey).bind("focus",_t.focusHandler).bind("blur",_t.blurHandler).bind("keydown",_t.ctrlEnterHandler);$.fn.commMain.bindemote($($opts.faceFrag),$($opts.comBord));$($opts.commtopk).unbind();$($opts.commtopk).bind("click",function(){$($opts.comShare).hide();var $layout=$(this).closest(".remark"),$form=$layout.find(".form"),$formPK=$layout.find(".formPK");$form.hide();$formPK.slideDown("fast",function(){_t.pkEvent(this)});$.regMonitor("debateclickpk")});$($opts.substr).bind("click",function(){var _tt=this,$this=$(_tt),$layout=$this.closest(".form"),content=$layout.find("textarea").val(),textObj=$layout.find("textarea"),$errorInfo=$layout.find(".erInfo");if(content){content=$.trim(content)}if(content==$opts.comm_textAD||content==$opts.comm_text){textObj.focus();$errorInfo.html($opts.required);$.alertMsg($errorInfo);if(textObj.css("background-image")=="none"){emptyContentAlert(textObj)}return}else{}}).bind("mouseover",function(){$(this).addClass("over")}).bind("mouseout",function(){$(this).removeClass("over")});if($opts.picComm){var cntBtn="#contentA .control .btn ";if($(cntBtn).length>0){var $cntQikBtn=$(cntBtn+".review-btn"),$cntQikBtnA=$(cntBtn+".review-btn a"),$cntQikLay=$(cntBtn+".review-layer"),$cntQikTA=$cntQikLay.find("textarea"),$cntQikBArea=$cntQikLay.find(".review-layer-btn"),$cntQikCancel=$cntQikBArea.find("a"),$cntQikSub=$cntQikBArea.find(".re-appear");$cntQikTA.bind("focus",function(){if($cntQikTA.val()==$opts.picQuickTextAD){$cntQikTA.val("")}$(this).css({color:"#333"})}).bind("blur",function(){if($cntQikTA.val()===""){$cntQikTA.val($opts.picQuickTextAD);if($cntQikLay.find(".re-null").length>0){$cntQikLay.find(".re-null").remove()}}$(this).css({color:"#C7C7C7"})}).bind("keydown",_t.ctrlEnterHandler).bind("keyup",_t.picInputKey).bind("paste",_t.picInputKey).bind("cut",_t.picInputKey);$cntQikBtnA.unbind("click").bind("click",function(e){if($(cntBtn+".review-layer:visible").length>0){$cntQikBtn.removeClass("review-btn-clk");$cntQikLay.hide("fast");if($.cookie("ppinf")){$.regMonitor("PicIconClickIcon")}}else{$cntQikBtn.addClass("review-btn-clk");var $btnLeft=$cntQikBtn.offset().left;if(!$opts.picLayerCss){var $btnWidth=$cntQikBtn.width();$cntQikLay.css({left:$btnLeft,top:83})}else{$cntQikLay.css($.extend($opts.picLayerCss,{left:$btnLeft}))}$cntQikLay.show("fast");$cntQikTA.focus()}});var $a=$(cntBtn+".review-num a");function review_num_evt(){if($.cookie("ppinf")){$.regMonitor("PicIconClickComment")}$a.die("click").unbind("click").click();$a.one("click",review_num_evt)}setTimeout(function(){$a.die("click").unbind("click").one("click",review_num_evt)},1000);$cntQikCancel.unbind("click").bind("click",function(){$cntQikBtn.removeClass("review-btn-clk");$cntQikLay.hide("fast")});$cntQikSub.unbind("click").bind("click",function(){if($cntQikTA.val()==$opts.picQuickTextAD){if($cntQikLay.find(".re-null").length===0){$cntQikCancel.before('<em class="re-null">评论内容不能为空</em >');$.alertMsg($cntQikLay.find(".re-null"));emptyContentAlert($cntQikTA)}}});$(window).unbind("resize").bind("resize",function(){var $btnLeft=$cntQikBtn.offset().left,$btnWidth=$cntQikBtn.width();if(!$opts.picLayerCss){$cntQikLay.css({left:$btnLeft,top:83})}else{$cntQikLay.css($.extend($opts.picLayerCss,{left:$btnLeft}))}});$(cntBtn+".review-btn").show();$(cntBtn+".review-num").show()}}$($opts.logOut).bind("click",function(){jQuery.CommentLogin.doLogout()});$($opts.faceDefault).unbind("click").bind("click",function(){var tArea=$(this).closest(".remark").find(".form textarea");tArea.focus();var theValue="["+$(this).attr("data_ubb")+"]";tArea.val(tArea.val()+theValue);$.fn.commMain.setCaretPosition(tArea.get(0),tArea.val().length)});$($opts.nameInfo).find(".set-nickname a").add($($opts.reLink).find(".setPass")).click(function(){var password=$opts.pp.userId.substr(4,8);var data={extend:{nickname:escape($opts.pp.nick),passport:escape($opts.pp.userId),password:password,seq:password},msg:"execute success",status:0};$.CommentLogin.commnetDialog();$.CommentLogin.commnetDialogPosition();$.CommentLogin.commentTalkSuccess(data);$("#diglog_wrapper .talk-success-content .talk-title").html('<span class="login-icon talk-set-nick"></span>修改密码或昵称！');$.CommentLogin.commentSetPassStatus();return false});$($opts.newReply).bind("click",function(){$.fn.commMain.commCount.renewReplay()})},ImgUpEvt:function(){var _t=this,$layout=_t.$layout;$layout.find(".img a").eq(0).unbind("click").bind("click",function(){$(this).parents(".remark").find(".message").html("支持5M以内的JPG、GIF、PNG图片文件").removeClass("notice");$(this).parents(".remark").find(".upload_panel").css({left:$(this).parent().position().left-20});$(this).parents(".remark").find(".preview_panel").is(":hidden")&&$(this).parents(".remark").find(".upload_panel").toggle()});$layout.find(".uploadfile").live("mouseover",function(){$(this).parents(".remark").find(".img_upload_btn").addClass("img_upload_btn_hover")}).live("mouseout",function(){$(this).parents(".remark").find(".img_upload_btn").removeClass("img_upload_btn_hover")});$layout.find(".close_upload").live("click",function(){$(this).parents(".remark").find(".upload_panel").hide()});if($.browser.msie){if($.browser.version!="6.0"){$(document).bind("mousedown",function(e){if($(e.target).parents(".upload_panel").length<=0){$(".upload_panel").hide()}})}else{$layout.find(".upload_panel .img_panel_middle").append("<span class='close_upload'></span>")}var t=null;var timer=$.browser.version=="6.0"?300:100;function previewImg(){if(this.value===""){var othis=this;setTimeout(function(){previewImg.call(othis)},timer);return}if(t==null){return}var othis=this;var v=$(othis).parents(".remark").find(".commtxt");new ImagePreview($(this),{maxWidth:150,maxHeight:150,panel:$(this).parents(".remark").find(".preview_panel"),select_panel:$(this).parents(".remark").find(".upload_panel"),onAfterShow:function(tar){$(othis).parents(".remark").find(".commtxt").focus();if(v.val()===$.fn.commMain.defaults.comm_textAD||v.val()===""){v.val("分享图片");v.parent().addClass("comInputOvr");$(othis).parents(".remark").find(".reshipmentShare").show();$("#SOHUcomment .btn").unbind("click").bind("click",_t.submitComm)}},onClearFile:function(tag){if(v.val()=="分享图片"){v.val("")}}}).preview();t=null}$layout.find(".uploadfile").die("click").live("click",function(){othis=this;setTimeout(function(){t=1;previewImg.call(othis)},timer)});$layout.find(".uploadfile").die("change").live("change",function(){t=null;previewImg.call(this)})}else{$(document).bind("mousedown",function(e){if($(e.target).parents(".upload_panel").length<=0){$(".upload_panel").hide()}});$layout.find(".uploadfile").die("change").live("change",function(){var othis=this;new ImagePreview($(this),{maxWidth:150,maxHeight:150,panel:$(this).parents(".remark").find(".preview_panel"),select_panel:$(this).parents(".remark").find(".upload_panel"),onAfterShow:function(tar){$(othis).parents(".remark").find(".commtxt").focus();var v=$(othis).parents(".remark").find(".commtxt");if(v.val()===$.fn.commMain.defaults.comm_textAD||v.val()===""){v.val("分享图片");v.parent().addClass("comInputOvr");$(othis).parents(".remark").find(".reshipmentShare").show();$("#SOHUcomment .btn").unbind("click").bind("click",_t.submitComm)}},onClearFile:function(){var v=$(othis).parents(".remark").find(".commtxt");if(v.val()==="分享图片"){v.val("")}}}).preview()})}},pkEvent:function(me){var _t=this,$opts=_t.opts,$layout=$(me).closest(".remark");$layout.find(".formPK .close").bind("click",function(){var _t=$(this),$layout=$(_t).closest(".remark");_t.unbind();$layout.find(".formPK").hide();$layout.find(".form").show();$.regMonitor("debateclickclose");return false});$layout.find(".comBord").bind("keyup",_t.pkKey).bind("paste",_t.pkKey).bind("cut",_t.pkKey).bind("focus",_t.focusHandler).bind("blur",_t.blurHandler);$layout.find(".comBord").hover(function(){$(this).addClass("bordOver")},function(){$(this).removeClass("bordOver")});$layout.find(".pkBtn .btn").bind("click",function(){var err=true;if($layout.find(".pkBtn").val()==""){$layout.find(".pkBtn").focus().next("span").html($opts.PKtitleReq);err=false;return false}if($layout.find(".pktxtl").val().replace(/\s/g,"")==""){$layout.find(".pktxtl").focus().next("span").html($opts.PKtitleOSP);err=false;return false}if($layout.find(".pktxtr").val().replace(/\s/g,"")==""){$layout.find(".pktxtr").focus().next("span").html($opts.PKtitleOSP);err=false;_t.pkKey(this);return false}var _lenTitle=$.fn.commMain.len($.trim($layout.find(".pkBtn").val()));var _maxTitle=$opts.maxPKtitle;if(_lenTitle>_maxTitle){emptyContentAlert($layout.find(".subFrm .pkBtn"));err=false;return false}var _lenTxtL=$.fn.commMain.len($.trim($layout.find(".pktxtl").val()));var _maxTxtL=$opts.maxInputPK;if(_lenTxtL>_maxTxtL){emptyContentAlert($layout.find(".pktxtl"));err=false;return false}var _lenTxtR=$.fn.commMain.len($.trim($layout.find(".pktxtr").val()));var _maxTxtR=$opts.maxInputPK;if(_lenTxtR>_maxTxtR){emptyContentAlert($layout.find(".pktxtr"));err=false;return false}if(err){var pkbtnObj=$layout.find(".formPK .pkBtn input.btn");pkbtnObj.unbind("click").bind("click",_t.submitComm);pkbtnObj.trigger("click");$.regMonitor("debateclicksubmit")}else{return false}}).bind("mouseover",function(){$(this).addClass("over")}).bind("mouseout",function(){$(this).removeClass("over")})},picInputKey:function(e){var e=window.event||e,keyCode=e.keyCode||e.which;var _t=p.me,$opts=_t.opts,$this=$(this),$layout=$this.closest(".review-layer");var $btn=$layout.find("input"),_len=$.fn.commMain.len($.trim($this.val())),_max=($opts.maxInput),contentValue=$layout.find("textarea:visible").val(),$cancel=$layout.find(".review-layer-btn").find("a");if($layout.find(".re-null").length===0){$cancel.before('<em class="re-null">评论内容不能为空</em >')}if(_len>_max){$layout.find(".re-null").html($.fn.commMain.ParseTpl($opts.$MaxInputTxt,{maxInputLen:_len-_max})).attr("errlen",_len-_max).show()}else{if(contentValue==$opts.comm_textAD||contentValue==""||contentValue.replace(/\s/g,"").length==0){$layout.find(".re-null").html($opts.required)}else{if(keyCode!=13&&keyCode!=17&&!e.ctrlKey){$layout.find(".re-null").html("").attr("errlen",0);if(!$layout.length){$("#SOHUcomment .diglog-wrapper .comBtn .re-null").html(" ")}}$btn.unbind("click").bind("click",_t.PicSubmitComm)}}if($(this).height()<=66&&$(this).scrollTop()>0){$(this).css({wordWrap:"break-word",resize:"none"})}},inputKey:function(e){var e=window.event||e,keyCode=e.keyCode||e.which;var _t=p.me,$opts=_t.opts,$this=$(this),$layout=$this.closest(".remark");var showMessage="Ctrl+Enter快捷提交";if($layout.length==0){$layout=$this.closest(".face-com");showMessage=""}var $btn=$layout.find(".comBtn:visible .btn");var _len=$.fn.commMain.len($.trim($this.val())),_max=($opts.maxInput);var contentValue=$layout.find("textarea:visible").val();if(_len>_max){$layout.find(".re-null:visible").html($.fn.commMain.ParseTpl($opts.$MaxInputTxt,{maxInputLen:_len-_max})).attr("errlen",_len-_max).show()}else{if(contentValue==$opts.comm_textAD||contentValue==""||contentValue.replace(/\s/g,"").length==0){$layout.find(".re-null").html($opts.required)}else{if(keyCode!=13&&keyCode!=17&&!e.ctrlKey){$layout.find(".re-null").html(showMessage).attr("errlen",0);if(!$layout.length){$("#SOHUcomment .diglog-wrapper .comBtn .re-null").html(" ")}}$btn.unbind("click").bind("click",_t.submitComm)}}if($(this).height()<=66&&$(this).scrollTop()>0){$(this).css({wordWrap:"break-word",resize:"none"}).animate({height:"132px"})}if(e&&e.stopPropagation){e.stopPropagation()}else{window.event.cancelBubble=true}},ctrlEnterHandler:function(e){var e=window.event||e,keyCode=e.keyCode||e.which;var _t=p.me,$opts=_t.opts,$this=$(this),$layout=null;if(e.ctrlKey&&keyCode==13){if($("#SOHUcomment .diglog-face-layer:visible").length>0){$layout=$this.closest(".form")}else{$layout=$this.closest(".remark")}if($opts.picComm){var cntBtn="#contentA .control .btn .review-layer ";$cntQikSubmit=$(cntBtn+".review-layer-btn input");if($(cntBtn+":visible").length>0){_t.PicSubmitComm.call($cntQikSubmit)}else{var $btn=$layout.find(".comBtn:visible .btn");_t.submitComm.call($btn)}}var $btn=$layout.find(".comBtn:visible .btn");_t.submitComm.call($btn);return}},pkKey:function(e){var e=window.event||e,keyCode=e.keyCode||e.which;var _t=p.me,$opts=_t.opts,_i=this;if(!_i.nodeType){return false}var _len=$.fn.commMain.len($.trim($(this).val()));if($(_i).hasClass("pkBtn")){if(_len>$opts.maxPKtitle){$(_i).next("span").html($.fn.commMain.ParseTpl($opts.$MaxInputTxt,{maxInputLen:_len-$opts.maxPKtitle}));emptyContentAlert($(this));return false}}if($(_i).hasClass("pkTa")){if(_len>$opts.maxInputPK){$(_i).next("span").html($.fn.commMain.ParseTpl($opts.$MaxInputTxt,{maxInputLen:_len-$opts.maxInputPK}));emptyContentAlert($(this));return false}}$(_i).next("span").html("")},focusHandler:function(e){var $this=$(this);if($this.height()<66&&$this.hasClass("commtxt")){}var e=window.event||e,keyCode=e.keyCode||e.which;var _t=p.me,$opts=_t.opts,$layout=$this.closest(".form");var $faceLayer=$("#SOHUcomment .diglog-face-layer");$opts.isFocus=true;if($this.hasClass("commtxt")){if($this.val()==$opts.comm_textAD||$this.val()==$opts.comm_text){$layout.find(".comInput").addClass("comInputOvr").find(".commtxt").val("")}else{if(!$layout.find(".comInput").hasClass("comInputOvr")){$layout.find(".comInput").addClass("comInputOvr")}$($opts.substr).unbind("click").bind("click",_t.submitComm);if($faceLayer.length>0){$faceLayer.find(".face-com .comBtn input").unbind("click").bind("click",_t.submitComm)}}$($opts.comShare).show();return}else{}},blurHandler:function(e){var _t=p.me,$opts=_t.opts;if($(this)[0].type=="textarea"){if($(this).val()===""){if($(this).height()===132){$(this).animate({height:"66px"})}}}$opts.isFocus=false},submitComm:function(e){window.SubmitSource=true;var _t=p.me,$opts=_t.opts,d=$opts.data,_i=this,$layout=$(_i).closest(".form");var _max=($opts.maxInput);var topicId=$opts.topicId,content=$layout.find("textarea").val(),s,ic=$layout.find(".comInput"),ip=$(ic).height();var _len=$.fn.commMain.len($.trim(content)),textObj=$layout.find("textarea"),share="",cmt_from=0,changeJs=true;$(_i).closest(".remark").find(".comShare:visible input").each(function(i){if($(this).attr("checked")){share=share+$(this).val()+","}});if(_len>_max){$(textObj).addClass("textAreaNoBg");emptyContentAlert(textObj);return}if(!$opts.simpleMode){$(textObj).addClass("textAreaBg")}var buffer=new $.Buffers();var $errorInfo=$layout.find(".erInfo");if(content){content=$.trim(content)}$opts.$commpost=$.fn.commMain.ParseTpl($opts.$commsubmit,$opts);if(content==$opts.comm_textAD||content==""){textObj.focus();$errorInfo.html($opts.required).show();$.alertMsg($errorInfo);if(textObj.css("background-image")=="none"){emptyContentAlert(textObj)}return}else{if($(_i).closest(".face-com:visible").length>0){var regUbbStr=/\[[^\[\]]+\]/g;if(regUbbStr.test(content)){var remainContent=$.popEmote(content,true);if(remainContent=="null"){$errorInfo.html($opts.faceNoCom).show();textObj.focus();$.alertMsg($errorInfo);return}}}}if(!$opts.login){$opts.submitarr={me:_i};if($("#diglog_wrapper").length==0){$.CommentLogin.commnetLoginInit(SohuComment.submit)}return}var theClass="";if($opts.simpleMode){theClass=""}else{theClass="btnLoad"}$(_i).unbind("click").removeClass("over").addClass(theClass).parent().append('<em class="subloding"></em>').find("em").css({top:($(_i).offset().top+$(_i).height()/2-8),left:($(_i).offset().left+$(_i).width()/2-8)});if($(_i).attr("attr")=="pk"){share="";$layout=$(_i).closest(".formPK");content=$layout.find(".pktxtl").val()+"PK"+$layout.find(".pktxtr").val();buffer.append('<input type="hidden" name="debate" value="true" />');buffer.append('<input type="hidden" name="title" value="'+$.fn.commMain.encode($layout.find(".pkBtn").val())+'" />')}if(typeof $opts.forceface2show!=="undefined"&&$opts.forceface2show===true){cmt_from=7;$opts.forceface2show=false}if($(_i).closest(".face-com:visible").length>0){var regUbbStr=/\[[^\[\]]+\]/g;if(regUbbStr.test(content)){cmt_from=7}if($(_i).closest(".diglog-face-layer:visible").length>0){$.regMonitor($opts.userRegister+"floatfaceadd")}else{$.regMonitor($opts.userRegister+"faceadd")}}else{$.regMonitor($opts.userRegister+"review")}content=$.fn.commMain.encode(content);var quanziId=$.fn.shareToQuanzi.SelectedValue($(_i).closest(".remark").find(".siteSelect"));buffer.append('<input type="hidden" name="topicId" value="'+topicId+'" />');buffer.append('<input type="hidden" name="cmt_from" value="'+cmt_from+'" />');buffer.append('<input type="hidden" name="refer" value="'+$.returnRefer()+'" />');buffer.append('<input type="hidden" name="content" value="'+content+'" />');buffer.append('<input type="hidden" name="share" value="'+share+'" />');buffer.append('<input type="hidden" name="groupids" value="'+quanziId+'" />');buffer.append('<input type="submit" name="submitOK" value="马上发表" />');s=buffer.toString();var submitover=function(filename){if(quanziId!=""){var c="",q=quanziId.split(",");for(var i=0;i<q.length;i++){if(q[i].length>0){c=c+"|"+q[i]+"_"+topicId}}$.cookie("sharedQuanzi",($.cookie("sharedQuanzi")||"")+c,{path:"/",domain:"sohu.com"});var ipt=$(_i).closest(".remark").find(".comInput").append('<div class="reshipmentSucceed"><p>该文章已成功转载</p></div>');ipt.find(".reshipmentSucceed").fadeOut(3000,function(){ipt.find(".reshipmentSucceed").remove()});$.fn.shareToQuanzi.RemoveShared(quanziId)}$("#commtarget").unbind("load");$(".preview_panel,.upload_panel").hide();$layout.find(".over_txt_msg").hide();$("#divtarget form").remove();$(".img_upload_btn").each(function(){if($(this).prev().find("input").length<=0){$(this).prev().prepend('<input accept="image/gif,image/jpeg,image/x-png" type="file" name="imgfile" class="uploadfile"/>')}});var debateCode="";var $SohuComment=$("#SOHUcomment");var $myComment=$SohuComment.find(".mycomList .i-say-scope-cont");if(!window.cmt_user_topic_allcomment){$.getScript($opts.mytopicUrlData,function(){window[cmt_user_topic_allcomment]=eval(cmt_user_topic_allcomment)||null;_i.preLoad(window[cmt_user_topic_allcomment],"mine")},{cache:true})}if($(_i).attr("attr")=="comment"){$($opts.comInput).removeClass("comInputOvr").find("textarea").val("")}else{if($(_i).attr("attr")=="pk"){$layout=$($opts.formPK+":visible");content="您发起了一个辩论<a href='javascript:void(0);'>【"+$.fn.commMain.encode($layout.find(".pkBtn").val())+"】</a>";changeJs=false;debateCode=$.fn.commMain.ParseTpl($opts.$debateCode,{debateUrl:"javascript:void(0)",detateTarget:"",detateText:$opts.debateWait});$layout.find(".comBord").val("");ic=$layout.find(".pkInput");ip=$layout.height()*2-40;$($opts.comInput).removeClass("comInputOvr")}}if($opts.simpleMode){$(_i).val("").next().next("em").remove()}else{$(_i).val("马上发表").removeClass("btnload").next("em").remove()}if(quanziId==""){$(document).unbind("showJifenMsg").bind("showJifenMsg",function(event,gold){$($opts.$comm_add_jifen_exp.replace(/jifenNum/g,gold)).appendTo(ic).css({top:parseInt(ip/2)-17}).fadeIn(100,function(e){$(ic).find(".add-jifen").delay(2000).fadeOut(500,function(){$(this).remove();if($(_i).attr("attr")=="pk"){$($opts.closePK).trigger("click")}_t.InputEvts();if(!$opts.isFocus){$($opts.comInput).find("textarea").val($opts.comm_textAD)}})})});function bindshowCommentMsg(){$(document).unbind("showCommentMsg").bind("showCommentMsg",function(){$($opts.$complete).appendTo(ic).css({top:parseInt(ip/2)-7}).fadeIn(100,function(e){$(ic).find(".complete:eq(0)").first().delay(2000).fadeOut(500,function(){$(this).remove();if($(_i).attr("attr")=="pk"){$($opts.closePK).trigger("click")}_t.InputEvts();if(!$opts.isFocus){$($opts.comInput).find("textarea").val($opts.comm_textAD)}})})})}if($SohuComment.find(".comList .box").length>0){var plusNumArr=[0]}else{if($SohuComment.find(".comFull .red").length>0){if($SohuComment.find(".comFull .red").html()==0){var plusNumArr=[0,1]}else{var plusNumArr=[0]}}else{var plusNumArr=[0,1]}}}var len=$(_i).closest(".diglog-face").length;var theUrl="http://pinglun.sohu.com/s"+topicId+".html";if(/pinglun\.sohu\.com\/activity\/pandian2012_new/ig.test(location.href)||$opts.forbidFace===false){$layout.find(".erInfo").html("Ctrl+Enter快捷提交")}else{if(len>0){window.setTimeout(function(){$($opts.dialogLayer).hide();var defaultTextTop=$("#SOHUcomment .remark").eq(0).position().top-40;$(window).scrollTop(defaultTextTop)},2000)}else{if(d.mode=="2"&&$opts.urlChange){window.setTimeout(function(){if(location.href!=theUrl){location.href=theUrl}},200)}else{if($opts.urlChange){window.setTimeout(function(){if(location.href!=theUrl){location.href=theUrl}},2000)}else{}}}}if($(_i).closest(".face-com:visible").length>0){var regUbbStr=/\[[^\[\]]+\]/g;if(regUbbStr.test(content)){content=$.popEmote(content)}}if(!$opts.pp.level){$opts.$comm_level=""}else{$opts.pp.code=parseInt($opts.pp.level)}if(typeof $.fn.commMain.defaults.ForceFaceSend!=="undefined"&&$.fn.commMain.defaults.ForceFaceSend===true){content=$.popEmote(content.replace(/\n/g,"<br/>"));$.fn.commMain.defaults.ForceFaceSend=false}else{content=content.replace(/\n/g,"<br/>")}var link="<a href='http://i.sohu.com/scomment/home/all/#mypost' target='_blank'>顶0 回复0</a>";var falseHtml=$.fn.commMain.ParseTpl(thecode.commModel.myCommList,$.extend(true,{},$opts.pp,{link:link,content:content,createTime:$.fn.commMain.time.friendly(new Date().getTime())}),changeJs);if($myComment.find(".no_comment").length){$myComment.css({"margin-top":"",height:""});$myComment.find(".no_comment").remove()}$SohuComment.find(".mycomList").show();$myComment.prepend(falseHtml);var old_lastcommentId=0;if(typeof window.cmt_user_topic_allcomment!=="undefined"){old_lastcommentId=window.cmt_user_topic_allcomment.commentList[0]?window.cmt_user_topic_allcomment.commentList[0].commentId:0}var mytopicUrlData="http://"+$opts.host+"/static/cmt_user_topic_allcomment/"+$opts.pp.base64+"/"+$opts.topicId+"/1/3/?"+Math.random();if(filename&&typeof $opts.pp.base64!=="undefined"){$.getScript(mytopicUrlData,function(){var allcomment=eval(cmt_user_topic_allcomment)||null;if(allcomment&&allcomment.commentList[0]&&allcomment.commentList[0].commentId===old_lastcommentId){$($opts.comInput).find("textarea").val(content);$layout.find(".over_txt_msg").addClass("red").html("<p>发表失败，可能因为网络连接错误或图片超过<b>5M</b>，请确认后再次发表</p>").show();setTimeout(function(){$layout.find(".over_txt_msg").fadeOut("slow")},5000);$myComment.find("div.reply:eq(0)").remove()}else{bindshowCommentMsg();if(allcomment.commentList[0]["image"]){var img=$("<div><img class='scale_img' src='"+allcomment.commentList[0]["image"]+"_c120'/></div>");img.find(".scale_img").ImagePowerView();$myComment.find("div.reply:eq(0)").append(img)}}if($myComment.find("div.reply").length>3){$myComment.find("div.reply:eq(2)").remove()}},{cache:false})}else{bindshowCommentMsg();if($myComment.find("div.reply").length>3){$myComment.find("div.reply:eq(2)").remove()}if($(_i).attr("attr")=="comment"){var _commJifen=$.fn.commMain.commJifen.jifenRequest(plusNumArr)}else{if($(_i).attr("attr")=="pk"){$(document).trigger("showCommentMsg")}}}$("#SOHUcomment .face-pic").attr("show","false");setTimeout(function(){if($("#SOHUcomment .face-com").length>0){$("#SOHUcomment .commen-face ul li:eq(0)").trigger("click",[true])}},2500);var $faceLayer=$("#SOHUcomment .diglog-face-layer:visible");if($faceLayer.length>0){$("#SOHUcomment .diglog-face-layer .face-com textarea").val("");setTimeout(function(){$("#SOHUcomment .diglog-face-layer .face-pic").hide();$("#SOHUcomment .diglog-face-layer .face-com").hide();$("#SOHUcomment .diglog-face-layer .face-list").show()},2000);if($("#SOHUcomment .face-com").length>0){$("#SOHUcomment .comment-face ul li:eq(0)").trigger("click",[true]);$("#SOHUcomment .face-pic").attr("show","false")}}};if($("#divtarget").size()>0){$("#divtarget").remove()}$("<div/>").appendTo("body").css({top:"-5000px",left:"-1000px",position:"absolute"}).attr("id","divtarget").append('<iframe name="commtarget" id="commtarget"></iframe>');var t=ic.parents(".remark").find(".uploadfile"),f=t.size()>0?t[0].value:null;$('<form id="commform" enctype="multipart/form-data" method="post" accept-charset="gbk"/>').attr("action",$opts.$commpost).attr("target","commtarget").append(ic.parents(".remark").find(".uploadfile")[0]).append(s).appendTo("#divtarget");$("#commform").bind("submit",function(){$layout.find(".over_txt_msg").removeClass("red").html("<p><img src='http://comment.news.sohu.com/upload/comment4_1/images/icon_comm_loading.gif' style='width:15px;height:15px;text-valign:middle;'>正在发表，请等待...</p>").show();$("#commtarget").bind("load",function(){submitover(f)});if($.browser.msie){document.charset="gbk"}});$("#commform").submit();$opts.submitarr=null;$layout.find("textarea").blur();$.fn.commMain.commJifen.getUpgradeInfo();if($(".comment .comShare dd.isohu_check input").attr("checked")){var com=escape($($opts.comInput).find("textarea").val());var shareUrl="http://i.sohu.com/a/forward/blog/save.htm?newsId="+$opts.topicId+"&from=1&comment="+com+"&jsonp=?";$.ajax({type:"GET",url:shareUrl,dataType:"jsonp"})}return false},PicSubmitComm:function(e){window.SubmitSource=true;var _t=p.me,$opts=_t.opts,d=$opts.data,_i=this,$layout=$(_i).closest(".review-layer");var _max=($opts.maxInput);var topicId=$opts.topicId,content=$layout.find("textarea").val(),s,ic=$layout,ip=$(ic).height(),_iw=$(ic).width();var _len=$.fn.commMain.len($.trim(content)),textObj=$layout.find("textarea"),share="",cmt_from=0,changeJs=true;if(_len>_max){emptyContentAlert(textObj);return}var buffer=new $.Buffers();var $errorInfo=$layout.find(".erInfo");if(content){content=$.trim(content)}$opts.$commpost=$.fn.commMain.ParseTpl($opts.$commsubmit,$opts);if(content==$opts.picQuickTextAD||content==""){textObj.focus();$errorInfo.html($opts.required).show();$.alertMsg($errorInfo);if(textObj.css("background-image")=="none"){emptyContentAlert(textObj)}return}if(!$opts.login){$opts.submitarr={me:_i};if($("#diglog_wrapper").length==0){$.CommentLogin.commnetLoginInit(SohuComment.submit)}return}var theClass="";$(_i).unbind("click").val("提交中...");content=$.fn.commMain.encode(content);buffer.append('<input type="hidden" name="topicId" value="'+topicId+'" />');buffer.append('<input type="hidden" name="cmt_from" value="'+cmt_from+'" />');buffer.append('<input type="hidden" name="refer" value="'+$.returnRefer()+'" />');buffer.append('<input type="hidden" name="content" value="'+content+'" />');buffer.append('<input type="hidden" name="share" value="'+share+'" />');buffer.append('<input type="submit" name="submitOK" value="马上发表" />');s=buffer.toString();var submitover=function(){if($.cookie("ppinf")){$.regMonitor("PicIconSubmitSuccess")}var debateCode="";var $SohuComment=$("#SOHUcomment");var $myComment=$SohuComment.find(".mycomList .i-say-scope-cont");if(!window.cmt_user_topic_allcomment){$.getScript($opts.mytopicUrlData,function(){window[cmt_user_topic_allcomment]=eval(cmt_user_topic_allcomment)||null;_i.preLoad(window[cmt_user_topic_allcomment],"mine")},{cache:true})}if($layout.length>0){$layout.find("textarea").val($opts.picQuickTextAD)}$(_i).val("马上发表");$(document).unbind("showJifenMsg").bind("showJifenMsg",function(event,gold){$($opts.$pic_comm_add_jifen_exp.replace(/jifenNum/g,gold)).appendTo(ic).css({top:parseInt(ip/2)-17,position:"absolute",marginLeft:parseInt(_iw/2)-35}).fadeIn(100,function(e){$(ic).find(".add-jifen").delay(2000).fadeOut(500,function(){$(this).remove();_t.InputEvts();if(!$opts.isFocus){$layout.find("textarea").val($opts.picQuickTextAD)}})})});$(document).unbind("showCommentMsg").bind("showCommentMsg",function(){$($opts.$PicComplete).appendTo(ic).css({top:parseInt(ip/2)-7,position:"absolute",marginLeft:parseInt(_iw/2)-35}).fadeIn(100,function(e){$(ic).find(".complete:eq(0)").first().delay(2000).fadeOut(500,function(){$(this).remove();_t.InputEvts();if(!$opts.isFocus){$layout.find("textarea").val($opts.picQuickTextAD)}})})});if($SohuComment.find(".comList .box").length>0){var plusNumArr=[0]}else{if($SohuComment.find(".comFull .red").length>0){if($SohuComment.find(".comFull .red").html()==0){var plusNumArr=[0,1]}else{var plusNumArr=[0]}}else{var plusNumArr=[0,1]}}var _commJifen=$.fn.commMain.commJifen.jifenRequest(plusNumArr);var len=$(_i).closest(".diglog-face").length;var theUrl="http://pinglun.sohu.com/s"+topicId+".html";if(len>0){}else{if(d.mode=="2"&&$opts.urlChange){window.setTimeout(function(){var cntBtn="#contentA .control .btn ",$cntQikBtn=$(cntBtn+".review-btn"),$cntQikLay=$(cntBtn+".review-layer");if($cntQikLay.length>0){$cntQikLay.hide("fast");$cntQikBtn.removeClass("review-btn-clk")}},1000);window.setTimeout(function(){var $isay=$("#SOHUcomment .i-say-scope-cont");var top=$isay.offset().top-30;$("body,html").animate({scrollTop:top},1000)},200)}else{if($opts.urlChange){window.setTimeout(function(){var cntBtn="#contentA .control .btn ",$cntQikBtn=$(cntBtn+".review-btn"),$cntQikLay=$(cntBtn+".review-layer");if($cntQikLay.length>0){$cntQikLay.hide("fast");$cntQikBtn.removeClass("review-btn-clk");$cntQikLay.children("textarea").blur();$cntQikLay.children("input").blur();$(cntBtn).children("span").blur()}},1000);window.setTimeout(function(){var $isay=$("#SOHUcomment .i-say-scope-cont");var top=$isay.offset().top-30;$("body,html").animate({scrollTop:top},1000)},2000)}}}if($(_i).closest(".face-com:visible").length>0){var regUbbStr=/\[[^\[\]]+\]/g;if(regUbbStr.test(content)){content=$.popEmote(content)}}if(!$opts.pp.level){$opts.$comm_level=""}else{$opts.pp.code=parseInt($opts.pp.level)}var link="<a href='http://i.sohu.com/scomment/home/all/#mypost' target='_blank'>顶0 回复0</a>";var falseHtml=$.fn.commMain.ParseTpl(thecode.commModel.myCommList,$.extend(true,{},$opts.pp,{link:link,content:content.replace(/\n/g,"<br/>"),createTime:$.fn.commMain.time.friendly(new Date().getTime())}),changeJs);if($myComment.find(".no_comment").length){$myComment.css({"margin-top":"",height:""});$myComment.find(".no_comment").remove()}$SohuComment.find(".mycomList").show();if($myComment.find("p").length>2){$myComment.find("p:eq(2)").remove()}$myComment.prepend(falseHtml);$("#SOHUcomment .face-pic").attr("show","false");setTimeout(function(){if($("#SOHUcomment .face-com").length>0){$("#SOHUcomment .commen-face ul li:eq(0)").trigger("click",[true])}},2500);var $faceLayer=$("#SOHUcomment .diglog-face-layer:visible");if($faceLayer.length>0){$("#SOHUcomment .diglog-face-layer .face-com textarea").val("");setTimeout(function(){$("#SOHUcomment .diglog-face-layer .face-pic").hide();$("#SOHUcomment .diglog-face-layer .face-com").hide();$("#SOHUcomment .diglog-face-layer .face-list").show()},2000);if($("#SOHUcomment .face-com").length>0){$("#SOHUcomment .comment-face ul li:eq(0)").trigger("click",[true]);$("#SOHUcomment .face-pic").attr("show","false")}}};if($("#divtarget").size()>0){$("#divtarget").remove()}$("<div/>").appendTo("body").css({top:"-5000px",left:"-1000px",position:"absolute"}).attr("id","divtarget").append('<iframe name="commtarget" id="commtarget"></iframe>');$("#commtarget").bind("load",submitover);$("<form/>").appendTo("#divtarget").attr("id","commform").attr("method","post").attr("accept-charset","gbk").attr("action",$opts.$commpost).attr("target","commtarget").append(s);$("#commform").bind("submit",function(){if($.browser.msie){document.charset="gbk"}}).submit();$opts.submitarr=null;$layout.find("textarea").blur();$.fn.commMain.commJifen.getUpgradeInfo();return false},getFaceImg:function(){var _t=this,$opts=_t.opts,faceUrl="";if(!$opts.showFace){return}if($opts.login){$opts.userRegister="login"}else{if(!$opts.login&&$.cookie("lastdomain")){$opts.userRegister="unlogin"}else{$opts.userRegister="unregister"}}$opts.faceUrl=$opts.faceUrl||"http://{{#host}}/direct/topic/face/{{#topicId}}";faceUrl=$.fn.commMain.ParseTpl($opts.faceUrl,$.extend({},$opts));$.ajax({type:"get",url:faceUrl,dataType:"script",scriptCharset:"utf-8",success:function(){var mode=facelist.mode;if(mode!=0){$("#SOHUcomment .comment-face").hide();return}else{$opts.showFace=true;$("#SOHUcomment .comment-face").show();showFaceImg(facelist,$opts.qingComm)}}});function showFaceImg(d,qingComm){var faceListData=d.faceList,faceListStr="",faceCount=d.faceCount,$opts=this.opts,faceLayer="";$.each(faceListData,function(i){var face_count=faceCount[faceListData[i].id];var count=face_count==undefined?0:face_count;faceListStr=faceListStr+'<li><img data_id="'+faceListData[i].id+'" data_ubb="'+unescape(faceListData[i].faceCode)+'"  src="'+unescape(faceListData[i].url)+'" width="70" height="70" alt="" title="'+unescape(faceListData[i].name)+'" /><span>'+unescape(faceListData[i].name)+"<br><strong>"+count+"</strong></span></li>";faceLayer=faceLayer+'<li><img id="'+faceListData[i].id+'" data_ubb="'+unescape(faceListData[i].faceCode)+'"  src="'+unescape(faceListData[i].url)+'" width="50" height="50" title="'+unescape(faceListData[i].name)+'" alt=""><span class="face-title"><em class="num">'+count+"</em>"+unescape(faceListData[i].name)+"</span></li>"});faceListStr='<div class="face-wrapper clear" style="display:none"><div class="face-list"><ul>'+faceListStr+"</ul></div></div>";faceLayer='<div style="display: none; bottom:0;" class="diglog-wrapper diglog-face-layer" show="false" firstshow="false"><div class="face-wrapper"><div class="face-list"><ul>'+faceLayer+"</ul></div></div></div>";$("#SOHUcomment .remark").append(faceListStr);if(qingComm){$("#SOHUcomment").append(faceLayer);_t.faceLayerEvt()}_t.faceInputEvts();_t.faceTabEvt();_t.monitorFacetab()}},faceInputEvts:function(){var commentToggle=$("#SOHUcomment .comment-face ul li:eq(0)"),faceToggle=$("#SOHUcomment .comment-face ul li:eq(1)"),commentInput=$("#SOHUcomment .remark:eq(0)"),commentInputLeft=commentInput.find(".l"),commentInputRight=commentInput.find(".r"),$layout=this.$layout,$opts=this.opts;commentToggle.click(function(e,trigger){var $faceWrapper=commentInput.find(".face-wrapper:visible"),$facePic=commentInput.find(".face-pic:visible");if(commentToggle.attr("class")=="comment-face-now"){return}if($("#diglog_wrapper").find(".passportc").length>0){$("#diglog_wrapper").remove()}faceToggle.removeClass("comment-face-now");commentToggle.addClass("comment-face-now");commentInputLeft.show();commentInputRight.show();if($faceWrapper.length){$faceWrapper.hide()}if($facePic.length){$facePic.hide();commentInput.find(".face-com").hide()}trigger||$.regMonitor($opts.userRegister+"reviewclick")});faceToggle.click(function(e,trigger){var $faceWrapper=commentInput.find(".face-wrapper"),$facePic=commentInput.find(".face-pic");if(commentInput.find(".face-pic:visible").length){return}faceToggle.addClass("comment-face-now");commentToggle.removeClass("comment-face-now");commentInputLeft.hide();commentInputRight.hide();if($facePic.attr("show")=="true"){$facePic.show();commentInput.find(".face-com").show();if($.cookie("lastdomain")==null){$("#diglog_wrapper").hide();commentInput.find(".face-com textarea").focus();commentInput.find(".face-com .comShare").hide()}}else{$faceWrapper.show()}trigger||$.regMonitor($opts.userRegister+"faceclick")});if(!$.cookie("ppinf")&&!$.cookie("lastdomain")){faceToggle.trigger("click",[true]);$.regMonitor($opts.userRegister+"faceopen")}},faceTabEvt:function(){var _t=this,$layout=this.$layout,$opts=_t.opts,clickFlag=true;var $faceLi=$("#SOHUcomment .remark .face-wrapper .face-list li");$faceLi.hover(function(){var imgSrcA=$(this).find("img").attr("src").replace(/.gif/g,"_a.gif");$(this).addClass("current").find("img").attr("src",imgSrcA)},function(){var imgSrc=$(this).find("img").attr("src").replace(/_a.gif/g,".gif");$(this).removeClass("current").find("img").attr("src",imgSrc)});$faceLi.bind("click",_faceLiEvt);function _faceLiEvt(e,l){var $this=$(this);var time=300;if(l){time=0}if(!clickFlag){return}clickFlag=false;var imgSrcA=$this.find("img").attr("src"),imgSrc=imgSrcA.replace(/_a.gif|.gif/g,"_b.gif"),facePic=$("#SOHUcomment .remark:eq(0) .face-pic"),faceCom=$("#SOHUcomment .remark:eq(0) .face-com"),ubb=$this.find("img").attr("data_ubb"),$num=$this.find("strong");var faceId=$this.find("img").attr("data_id");var dingUrl="http://{{#host}}/post/quickcomment?topicId={{#topicId}}&quickId={{#faceId}}&cmt_from=7";$.getScript($.fn.commMain.ParseTpl(dingUrl,$.extend({},$opts,{faceId:faceId})),function(){},{cache:false});$this.unbind("click",_faceLiEvt);$this.append("<em class='num-up'>+1</em>");$this.find(".num-up").animate({bottom:"+50px"},time,showImgCom);$num.html(parseInt($num.html())+1);if(!l){$.regMonitor($opts.userRegister+"face")}showImgCom();function showImgCom(){$("#SOHUcomment .remark .face-wrapper").hide();$this.find(".num-up").remove();if(facePic.length){facePic.show();faceCom.show();if($.cookie("lastdomain")==null){faceCom.find(".comShare").hide()}else{faceCom.find(".comShare").show()}facePic.attr("show","true");facePic.find("img").attr("src",imgSrc).attr("data_ubb",ubb).attr("show","true");var $textArea=$("#SOHUcomment .face-com .comment-text-wrapper .commtxt:eq(0)");if(!l){$textArea.focus()}$("#SOHUcomment .face-com .comBtn .btn").unbind("click").bind("click",_t.submitComm);$textArea.val(ubb);if(!l){$.fn.commMain.setCaretPosition($textArea.get(0),$textArea.val().length)}}else{$("#SOHUcomment .remark:eq(0)").append(thecode.commModel.faceCommentTab);var cloneFrom=$layout.find(".form:first").clone(true),shareFrom=$layout.find(".comShare:first").clone(true),comTextWrapper=$layout.find(".face-com .comment-text-wrapper");comTextWrapper.append(cloneFrom);comTextWrapper.find(".comFun").remove();comTextWrapper.find(".faceBtn .to_isohu").remove();comTextWrapper.find(".faceBtn .isohu_check").remove();comTextWrapper.find(".erInfo").html("Ctrl+Enter快捷提交");comTextWrapper.find(".form").show();if($.cookie("lastdomain")){}else{comTextWrapper.find(".comShare").hide()}facePic=$("#SOHUcomment .remark:eq(0) .face-pic");facePic.attr("show","true");facePic.find("img").attr("src",imgSrc).attr("data_ubb",ubb).attr("show","true");var $textArea=$("#SOHUcomment .face-com .comment-text-wrapper .commtxt:eq(0)");if(!l){$textArea.focus()}$("#SOHUcomment .face-com .comBtn .btn").unbind("click").bind("click",_t.submitComm);$textArea.val(ubb);if(!l){$.fn.commMain.setCaretPosition($textArea.get(0),$textArea.val().length)}}$this.bind("click",_faceLiEvt);clickFlag=true}}},verifyBoxEvt:function(){var _t=this;$.CommentLogin.commnetLoginInit(SohuComment.submit);$("#diglog_wrapper").hide();$("#SOHUcomment .face-com .vcode-box #vcode").bind("focus",function(){$this=$(this);if($this.val()=="请输入验证码"){$this.val("")}}).bind("keydown",function(e){var e=window.event||e,keyCode=e.keyCode||e.which;if(e.ctrlKey&&keyCode==13){var $btn=$("#SOHUcomment .face-com .comBtn:visible .btn");_t.submitComm.call($btn);return}});$("#SOHUcomment .face-com .vcode-box .change-vcode a").click($.CommentLogin.commentGetVcode)},monitorFacetab:function(){var _t=this,$opts=this.opts;var $commentFace=$("#SOHUcomment .comment-face");var $faceLayer=$("#SOHUcomment .diglog-face-layer");var top=$commentFace.position().top;var clientHeight=document.documentElement.clientHeight;var scrollTop=0;var showFlag=true;$(window).scroll(function(){scrollTop=document.documentElement.scrollTop||window.pageYOffset;if(((scrollTop+clientHeight)>top)){if(showFlag){$.regMonitor($opts.userRegister+"commentrealshow");showFlag=false}if($faceLayer.attr("show")=="true"){_t.faceLayerHide()}}else{if((scrollTop+clientHeight)<top){var left=$commentFace.position().left;$faceLayer.css("left",left);if($faceLayer.attr("show")=="false"){_t.faceLayerShow()}}}});$(window).resize(function(){var left=$commentFace.position().left;top=$commentFace.position().top;clientHeight=document.documentElement.clientHeight;$faceLayer.css("left",left)});$(document).mouseup(function(e){var e=window.event||e,target=e.target||e.srcElement,tagname=target.tagName,scrollTop=window.pageYOffset||document.documentElement.scrollTop;if(((scrollTop+clientHeight)<top)&&($(e.target).parents("a").size()==0)&&!(/a|img|input|textarea|object|embed/i.test(tagname))){_t.faceLayerShow()}})},faceLayerEvt:function(){var _t=this,$opts=this.opts,$layout=$("#SOHUcomment");var $faceLi=$layout.find(".diglog-face-layer li");var $faceList=$layout.find(".diglog-face-layer .face-list");var $facePic=$layout.find(".diglog-face-layer .face-pic");var $faceCom=$layout.find(".diglog-face-layer .face-com");var $comFaceList=$layout.find(".remark .face-wrapper .face-list:eq(0)");$faceLi.hover(function(){var imgSrcA=$(this).find("img").attr("src").replace(/.gif/g,"_a.gif");$(this).addClass("current").find("img").attr("src",imgSrcA)},function(){var imgSrc=$(this).find("img").attr("src").replace(/_a.gif/g,".gif");$(this).removeClass("current").find("img").attr("src",imgSrc)});$faceLi.bind("click",_faceLiEvt);function _faceLiEvt(e,showPlus){var $this=$(this);var $faceImg=$this.find("img");var imgSrc=$faceImg.attr("src").replace(/_a.gif/g,".gif");var ubb=$faceImg.attr("data_ubb");var title=$faceImg.attr("title");var $textArea=$layout.find(".diglog-face-layer .form textarea");var $num=$this.find(".num");$layout.find(".comment-face li:eq(1)").trigger("click",["layer"]);if(showPlus!="false"){$.regMonitor($opts.userRegister+"floatface")}$this.unbind("click",_faceLiEvt);if(showPlus=="false"){_show()}else{$this.append("<em class='num-up'>+1</em>");$this.find(".num-up").animate({bottom:"+40px"},300,_show);$num.html(parseInt($num.html())+1)}function _show(){$this.find(".num-up").remove();if($faceCom.length>0){$faceList.hide();$facePic.find("img").attr("src",imgSrc).attr("data_ubb",ubb);$facePic.show();$faceCom.show();$faceCom.find(".erInfo").html("");$layout.find(".diglog-face-layer .comBtn .btn").unbind("click").bind("click",_t.submitComm);$layout.find(".diglog-face-layer .form textarea").val(ubb);$comFaceList.find("img[data_ubb='"+ubb+"']").trigger("click",["layer"]);$textArea.focus();$.fn.commMain.setCaretPosition($textArea.get(0),$textArea.val().length)}else{$faceList.hide();$layout.find(".diglog-face-layer .face-wrapper").append('<div class="l face-pic"><img width="50" height="50" data_ubb="'+ubb+'" title="'+title+'" alt="" src="'+imgSrc+'"></div><div class="r face-com"></div>');var cloneFrom=$layout.find(".form:first").clone(true);$faceCom=$layout.find(".diglog-face-layer .face-com");$facePic=$layout.find(".diglog-face-layer .face-pic");$faceCom.append(cloneFrom);$faceCom.find(".comFun").remove();$faceCom.find(".faceBtn .to_isohu").remove();$faceCom.find(".faceBtn .isohu_check").remove();$faceCom.find(".erInfo").html("");$faceCom.find(".form").show();$layout.find(".diglog-face-layer .form textarea").val(ubb);$layout.find(".diglog-face-layer .comBtn .btn").unbind("click").bind("click",_t.submitComm);$comFaceList.find("img[data_ubb='"+ubb+"']").trigger("click",["layer"]);$textArea=$layout.find(".diglog-face-layer .form textarea");$textArea.focus();$.fn.commMain.setCaretPosition($textArea.get(0),$textArea.val().length)}$this.bind("click",_faceLiEvt)}}},faceLayerShow:function(){var $layout=$("#SOHUcomment");var $faceLayer=$layout.find(".diglog-face-layer");var $comFacePic=$layout.find(".remark .face-pic");var $comFaceCom=$layout.find(".remark .face-com");var $textArea=$faceLayer.find(".face-com textarea");var $opts=this.opts;if($faceLayer.length<=0||$layout.find(".diglog-face-layer:visible").length>0){return}if($comFacePic.attr("show")=="true"){var $faceImg=$comFacePic.find("img");var ubb=$faceImg.attr("data_ubb");var content=$comFaceCom.find(".form textarea").val();$faceLayer.show();if($faceLayer.find(".face-list:visible").length>0){$faceLayer.find("li img[data_ubb='"+ubb+"']").trigger("click",["false"]);$textArea=$faceLayer.find(".face-com textarea");$textArea.val(content)}else{var imgSrc=$faceImg.attr("src").replace(/_b.gif/,".gif");var faceTitle=$faceImg.attr("title");$faceLayer.find(".face-pic img").attr({src:imgSrc,title:faceTitle,data_ubb:ubb});$textArea.val(content)}$.fn.commMain.setCaretPosition($textArea.get(0),$textArea.val().length);$faceLayer.attr("show","true")}else{$faceLayer.show();$faceLayer.attr("show","true");$faceLayer.find(".face-pic").hide();$faceLayer.find(".face-com").hide();$faceLayer.find(".face-list").show()}if($faceLayer.attr("firstshow")=="false"){$.regMonitor($opts.userRegister+"floatopen");$faceLayer.attr("firstshow","true")}},faceLayerHide:function(){var $layout=$("#SOHUcomment");var $faceLayer=$layout.find(".diglog-face-layer");var $comFacePic=$layout.find(".remark .face-pic:visible");var $comFaceCom=$layout.find(".remark .face-com");var $comTextArea=$comFaceCom.find(".form textarea");$comTextArea.val($faceLayer.find("textarea").val());if($comFacePic.length>0){$.fn.commMain.setCaretPosition($comTextArea.get(0),$comTextArea.val().length)}$faceLayer.hide();$faceLayer.attr("show","false")}};p.MyModelList=function($t,opts){p.l=this;this.$layout=$t;this.opts=opts;this.Init()};p.MyModelList.prototype={Init:function(){var _t=this,$opts=_t.opts,$layout=this.$layout;var d=$opts.myData;var loadingNum=$opts.loadingNum;if(typeof EmoteComm!="object"){window.setTimeout(function(){_t.listHTML()},200)}else{_t.listHTML()}_t.iintEvts()},listHTML:function(){var _t=this,$opts=_t.opts,$layout=this.$layout;var d=$opts.myData,s=new $.Buffers(),_commListHtml;var spCount,replyCount;var Link="";var $mycomList;if(!$layout.find(".mycomList").length){Link=$opts.pp.homeurl+"scomment/index.htm";thecode.commModel.myListModel=$.fn.commMain.ParseTpl(thecode.commModel.myListModel,{Link:Link});$layout.find(".remark:eq(0)").after(thecode.commModel.myListModel);$mycomList=$layout.find(".mycomList");if(!$opts.login&&d.commentList&&d.commentList.length==0){$mycomList.hide();return}if(d.commentList&&d.commentList.length==0){var $myCont=$mycomList.find(".i-say-scope-cont");$myCont.css({"margin-top":"15px",height:"30px"});$myCont.html("<span class='no_comment'>阿哦，您目前尚无评论，赶快说两句吧！</span>");return}}$mycomList=$layout.find(".mycomList");$mycomList.show();var dataLength=d.commentList.length-1;for(var i=0;i<=dataLength;i++){var commList=d.commentList[i];if(i===0){commList.boxTop=" boxTop"}else{if(i===(d.commentList.length-1)){commList.boxTop=" boxBot"}else{commList.boxTop=""}}var userFrom=commList.from;var commLevel="";var level=0;try{commList.createTime=$.fn.commMain.time.friendly(d.commentList[i].createTime)}catch(e){commList.createTime=""}content=$.fn.commMain.decode(unescape(commList.content));if(userFrom==7){content=p.ModelList.prototype.popEmote(content)}var link='<a target="_blank" href="http://i.sohu.com/p/'+commList.xpt+"/scomment/person/single/"+commList.commentId+'/">顶'+commList.spCount+" 回复"+commList.replyCount+"</a>";if(commList.floors.length){var firstFloor=commList.floors[0];var replayFloor=commList.floors[commList.floors.length-1];content=content.replace(/^回复.*?(:|：)/,function(){return""});var link='<a target="_blank" href="http://i.sohu.com/p/'+firstFloor.xpt+"/scomment/person/single/"+firstFloor.commentId+'/">顶'+commList.spCount+" 回复"+commList.replyCount+"</a>";content='<em class="reply">回复<a target="_blank" href="'+unescape(replayFloor.mylinks)+'">'+replayFloor.nickname+"</a></em>:"+content}if(commList.debate||commList.title){content='您发起了一个辩论<a target="_blank" href="'+$opts.lhost+$opts.topicId+"/d"+commList.commentId+'.html">【'+commList.title+"】</a>"}if(commList.status==2){}var image=(commList.status!=2&&commList.image)?"<div><img class='scale_img' src='"+commList.image+"_c120'/></div>":"";_commListHtml=$.fn.commMain.ParseTpl(thecode.commModel.myCommList,$.extend(true,{},commList,{link:link,content:content,image:image}),true);s.append(_commListHtml)}$mycomList.find(".i-say-scope-cont").append(s.toString());$mycomList.find(".i-say-scope-cont .scale_img").each(function(i){$(this).ImagePowerView()})},iintEvts:function(){}};p.ModelList=function($t,opts){p.l=this;this.$layout=$t;this.opts=opts;this.Init()};p.ModelList.prototype={Init:function(){var _t=this,$opts=_t.opts,$layout=this.$layout;var d=$opts.data;var loadingNum=$opts.loadingNum;if(!$opts.data||!$opts.data.belong){$($opts.comMenu).remove();$($opts.comList).remove()}$($opts.commLoading).remove();if(typeof EmoteComm!="object"){window.setTimeout(function(){_t.listHTML()},200)}else{_t.listHTML()}_t.iintEvts()},listHTML:function(){var _t=this,$opts=_t.opts,$layout=this.$layout;var d=$opts.data,s=new $.Buffers(),relationlist=$opts.relation,relation_me="",debateCode="",_commListTemplete,_commListHtml,loadingNum=$opts.loadingNum;var spCount,replyCount;var iploc,phone;var elite,talent,top,topClass;var commNum=0;var LinkHtml="";var LinkText="";var base64="";if(!$opts.showList){d.commentList=[]}if(!$opts.data||!$opts.data.belong){var listTapHtml=$.fn.commMain.ParseTpl(thecode.commModel.listTap,$.fn.commMain.defaults.$listTap[0]);if($opts.pageList&&($layout.children(".remark").size()===2||$layout.find(".remark").size()===3)){$layout.find(".remark").eq(1).before(listTapHtml);$layout.find(".comMenu").after($.fn.commMain.ParseTpl(thecode.commModel.listModel,d))}else{if($opts.simpleMode){$layout.append(listTapHtml).append($.fn.commMain.ParseTpl(thecode.commModel.listModelSimple,d));$layout.find(".remark").css("margin-bottom","0px");$layout.find(".comFull").css({background:"none",border:"none",padding:"0",margin:"auto",width:$opts.frameWidth})}else{$layout.append(listTapHtml).append($.fn.commMain.ParseTpl(thecode.commModel.listModel,d))}}}_t.changTab($opts.type);if(d.commentList&&d.commentList.length==0){if(d.allCount==0){$($opts.comMenu).hide();$($opts.comFull).html($.fn.commMain.ParseTpl($opts.$commFulltxt,d))}else{$($opts.comMenu).hide()}if($("#recommend_follower").length>0){this.initCard()}$("#container .before_loading").hide();return}var dataLength=d.commentList.length-1;for(var i=commNum;i<=dataLength;i++){if(i===0){d.commentList[i].boxTop=" boxTop"}else{if(i===(d.commentList.length-1)){d.commentList[i].boxTop=" boxBot"}else{d.commentList[i].boxTop=""}}var userFrom=d.commentList[i].from;var commLevel="";var level=0;d.commentList[i].createTime=$.fn.commMain.time.friendly(d.commentList[i].createTime);d.commentList[i].from=$.fn.commMain.from(d.commentList[i].from);d.commentList[i].authorimg=d.commentList[i].authorimg==""?$opts.$icon:d.commentList[i].authorimg;d.commentList[i].baseid=d.commentList[i].passport==undefined?"":$.fn.commMain.base64(unescape(d.commentList[i].passport));if(d.commentList[i].debate){var commentPK=d.commentList[i];commentPK.content="";debateCode=$.fn.commMain.ParseTpl(thecode.commModel.PKLayer,{debateUrl:$opts.lhost+$opts.topicId+"/d"+d.commentList[i].commentId+".html",title:commentPK.title,topicId:$opts.topicId,supportContent:commentPK.supportContent,opposeContent:commentPK.opposeContent,spCount:commentPK.debateSpCount,opCount:commentPK.debateOpCount,totalCount:commentPK.debateSpCount+commentPK.debateOpCount});commentPK.title=commentPK.supportContent+"<em>PK</em>"+commentPK.opposeContent}else{debateCode=""}if(d.commentList[i].topicTitle){var original=$.fn.commMain.ParseTpl($opts.$original,d.commentList[i],true)}if(!$opts.floorList){spCount="(<em>"+d.commentList[i].spCount+"</em>)";replyCount="(<em>"+d.commentList[i].replyCount+"</em>)"}else{spCount=parseInt(d.commentList[i].spCount);spCount="(<em>"+spCount+"</em>)";replyCount=""}if(d.commentList[i].location!=""&&d.commentList[i].location!=undefined){iploc="<em class='net-location'>"+d.commentList[i].location+"</em>"}else{if(d.commentList[i].iploc!=""&&d.commentList[i].iploc!=undefined){if(window.unescape(d.commentList[i].iploc).length>20){iploc="<em class='net-f' title='"+d.commentList[i].iploc+"'>["+window.escape(window.unescape(d.commentList[i].iploc).substring(0,20))+"...]</em>"}else{iploc="<em class='net-f'>["+d.commentList[i].iploc+"]</em>"}}else{iploc=""}}if(d.commentList[i].phone!=""&&d.commentList[i].phone!=undefined&&d.commentList[i].phone!="spider"){phone="<em class='sj'>"+d.commentList[i].phone+"</em>"}else{phone=""}if(d.commentList[i].talent){talent='<em class="badge gift"></em>'}else{talent=""}if(d.commentList[i].elite){elite='<em class="badge prime"></em>'}else{elite=""}if(d.commentList[i].top){top='<em class="badge top"></em>';if(i==0){if(!d.commentList[1].top){topClass="top_class first last"}else{topClass="top_class first"}}else{if(!d.commentList[i+1].top){topClass="top_class last"}else{topClass="top_class"}}}else{top="";topClass=""}if(userFrom==6||d.commentList[i].baseid==""){_commListTemplete=thecode.commModel.commListMobile}else{if(d.commentList[i].commentId<0){_commListTemplete=thecode.commModel.commListFalse}else{_commListTemplete=thecode.commModel.commList}}content=$.fn.commMain.decode(unescape(d.commentList[i].content));if(userFrom==7){content=_t.popEmote(content)}if(d.commentList[i].exp&&d.commentList[i].exp.currentRank&&d.commentList[i].exp.currentRank.task){var code=d.commentList[i].exp.currentRank.code;var taskMedalName=unescape(d.commentList[i].exp.currentRank.task.name);level=code<10?"0"+code:code;commLevel=level?$.fn.commMain.ParseTpl($opts.$comm_level,{level:level,code:code,levelMedalName:taskMedalName}):""}base64=d.commentList[i].baseid;if(unescape(d.commentList[i].passport)==$opts.pp.userId){LinkText="我的微博"}else{LinkText="TA的微博"}LinkHtml="<span class='weibo'>|<a target='_blank' href='http://comment4.news.sohu.com/direct/cmt_mblog_profile?xpt="+base64+"&srcid=1002600004'>"+LinkText+"</a></span>";var image=(d.commentList[i]["status"]!=2&&d.commentList[i]["image"])?"<div><img class='scale_img' src='"+d.commentList[i]["image"]+"_c120'/></div>":"";var famous="";var fromquanzi="";if(userFrom==3){var extra=d.commentList[i].extra&&d.commentList[i].extra.split(/_http/ig);if(extra&&extra[0]==="1"){if(extra.length>=3){famous="<span class='pVer' style='background-image:none;' title='"+(extra.length>=4?extra[3]:"")+"'><img src='http"+extra[2]+"'></span>"}else{famous="<span class='pVer' title='微博名人'></span>"}}if(d.commentList[i]["status"]!=2&&d.commentList[i]["image"]){var source=d.commentList[i]["image"];var small=source.substring(0,source.lastIndexOf("/")+1)+"f_"+source.substring(source.lastIndexOf("/")+1);var big=small.replace("/f_","/m_");image="<div><img class='scale_img' src='"+small+"' data-big='"+big+"' data-source='"+source+"'/></div>"}if(extra&&extra.length>1){d.commentList[i].authorimg="http"+extra[1]}d.commentList[i].from=d.commentList[i].from=="3"?"":d.commentList[i].from}else{if(userFrom==9){var extra=d.commentList[i].extra&&d.commentList[i].extra.split(/\|/ig);fromquanzi='来自 <a href="http://q.sohu.com/group/'+extra[0]+'">'+extra[1]+"圈</a>"}}_commListHtml=$.fn.commMain.ParseTpl(_commListTemplete,$.extend(true,{},d.commentList[i],{content:content,famous:famous,debateCode:debateCode,relation_me:relation_me,original:original,spCount:spCount,replyCount:replyCount,iploc:iploc,phone:phone,elite:elite,talent:talent,top:top,topClass:topClass,commNum:i,commLevel:commLevel,LinkHtml:LinkHtml,userFrom:userFrom,image:image,fromquanzi:fromquanzi}),true);var htmlObj=$(_commListHtml);var htmlWrapperObj=$("<div></div>").append(htmlObj);if($opts.floorList&&d.commentList[i].floors.length>0){var _floorHtml="";try{_floorHtml=_t._floorHtml(htmlObj,d.commentList[i].floors)}catch(e){console.log(e)}htmlObj.find("h4").after($opts.$floorWrapper);htmlObj.find(".comm-floor-wrapper").append(_floorHtml)}s.append(htmlWrapperObj.html())}var ss=s.toString();if($opts.loading>0&&$opts.pageList){if(d.belong&&d.belong=="mine"){$($opts.myComList).append(ss).find(".scale_img").each(function(i){$(this).ImagePowerView()})}else{$($opts.comList).append(ss).find(".scale_img").each(function(i){$(this).ImagePowerView()})}}else{$($opts.comFull).before(ss);$($opts.comFull).parent().find(".scale_img").each(function(i){$(this).ImagePowerView()})}if(d.commentList[0].commentId<0){var pos=$("#SOHUcomment").offset();$(document).scrollTop(pos.top-50)}$("#SOHUcomment .comList .box").relation();if($opts.pageList){$layout.find(".comMenu .r").pageList();$($opts.comFull).remove();if(d.commentList.length>5&&$layout.find(".remark").size()===1){var clone_remark=$layout.find(".remark").clone(true);clone_remark.addClass("clone");clone_remark.find(".face-wrapper").hide();clone_remark.find(".l , .r").show();$layout.append(clone_remark)}}$("#container .before_loading").hide();this.initCard();var $debateBtn=$("#SOHUcomment .comList .box .partPK a");var $debateLayer=$("#SOHUcomment .comList .box .argue-wrapper");if($debateBtn.length){$debateBtn.click(function(){setTimeout(function(){$.regMonitor("debateclickentry")},1000)})}if($debateLayer.length){$debateLayer.find("a").click(function(){setTimeout(function(){$.regMonitor("debateclickentry")},200)})}},_floorHtml:function(prevObj,floorsData){var _t=this,$opts=_t.opts,$layout=_t.$layout,_tempFloorObj="",_floorObj,_dataLength=0,_floorTemplate,debateCode="",tempFloorHide="";var spCount=0,content;var _tempWrapper="",_floorNoupWrapper="";var iploc,phone;_dataLength=floorsData.length;$.each(floorsData,function(i){var level=0;var commLevel="";var userFrom=floorsData[i].from;spCount=parseInt(floorsData[i].spCount);content=$.fn.commMain.decode(unescape(floorsData[i].content));if(userFrom==7){content=_t.popEmote(content)}if(floorsData[i].location!=""&&floorsData[i].location!=undefined){iploc="<em class='net-location'>"+floorsData[i].location+"</em>"}else{if(floorsData[i].iploc!=""&&floorsData[i].iploc!=undefined){if(window.unescape(floorsData[i].iploc).length>20){iploc="<em class='net-f' title='"+floorsData[i].iploc+"'>["+window.escape(window.unescape(floorsData[i].iploc).substring(0,20))+"...]</em>"}else{iploc="<em class='net-f'>["+floorsData[i].iploc+"]</em>"}}else{iploc=""}}if(floorsData[i].phone!=""&&floorsData[i].phone!=undefined&&floorsData[i].phone!="spider"){phone="<em class='sj'>"+floorsData[i].phone+"</em>"}else{phone=""}if(floorsData[i].debate){if(floorsData[i].title){floorsData[i].content=floorsData[i].title}debateCode=$.fn.commMain.ParseTpl($opts.$debateCode,{debateUrl:$opts.lhost+$opts.topicId+"/d"+floorsData[i].commentId+".html",detateTarget:' target="_blank"',detateText:$opts.debatePart})}else{debateCode=""}if(floorsData[i].exp&&floorsData[i].exp.currentRank&&floorsData[i].exp.currentRank.task){var code=floorsData[i].exp.currentRank.code;var taskMedalName=unescape(floorsData[i].exp.currentRank.task.name);level=code<10?"0"+code:code;commLevel=$.fn.commMain.ParseTpl($opts.$comm_level,{level:level,code:code,levelMedalName:taskMedalName})}var image=(floorsData[i].content!="%u8BE5%u8BC4%u8BBA%u5DF2%u5220%u9664"&&floorsData[i]["image"])?"<div><img class='scale_img' src='"+floorsData[i]["image"]+"_c120'/></div>":"";var famous="";if(userFrom==3){var extra=floorsData[i].extra&&floorsData[i].extra.split(/_http/ig);if(extra&&extra[0]==="1"){if(extra.length>=3){famous="<span class='pVer' style='background-image:none;' title='"+(extra.length>=4?extra[3]:"")+"'><img src='http"+extra[2]+"'></span>"}else{famous="<span class='pVer' title='微博名人'></span>"}}if(image!==""){var source=floorsData[i]["image"];var small=source.substring(0,source.lastIndexOf("/")+1)+"f_"+source.substring(source.lastIndexOf("/")+1);var big=small.replace("/f_","/m_");image="<div><img class='scale_img' src='"+small+"' data-big='"+big+"' data-source='"+source+"'/></div>"}}_floorObj=$.fn.commMain.ParseTpl(thecode.commModel.floorListModel,$.extend(true,{},floorsData[i],{content:content,debateCode:debateCode,commentId:floorsData[i].commentId,spCount:spCount,num:i+1,floorNum:i,iploc:iploc,phone:phone,commLevel:commLevel,image:image,famous:famous}),true);if(_dataLength<=15){_floorObj=$(_floorObj).prepend(_tempFloorObj);_tempFloorObj=$(_floorObj)}else{if(i<10){_floorObj=$(_floorObj).prepend(_tempFloorObj);_tempFloorObj=$(_floorObj)}else{if(i>=_dataLength-5){if(_tempWrapper.length==0){_tempWrapper=$("<div></div>").append(_tempFloorObj,_floorNoupWrapper);_floorObj=_tempWrapper.html()}else{_floorObj=$(_floorObj).prepend(_tempFloorObj)}_tempFloorObj=$(_floorObj)}else{if(_floorNoupWrapper.length==0){tempFloorHide=$.fn.commMain.ParseTpl($opts.$floorHide,$.extend(true,{},{floorsCount:_dataLength+1}),true);_floorNoupWrapper=$('<div class="floor-bord-noup-wrapper"></div>').prepend(tempFloorHide)}}}}});return _floorObj},_showHideFloorHtml:function(commnum){var _t=this,$opts=_t.opts,debateCode="";var floorsData=$opts.data.commentList[commnum].floors,_tempWrapper="";var iploc,phone;$.each(floorsData,function(i){var commLevel="";var level=0;if(floorsData[i].debate){if(floorsData[i].title){floorsData[i].content=floorsData[i].title}debateCode=$.fn.commMain.ParseTpl($opts.$debateCode,{debateUrl:$opts.lhost+$opts.topicId+"/d"+floorsData[i].commentId+".html",detateTarget:' target="_blank"',detateText:$opts.debatePart})}else{debateCode=""}if(floorsData[i].location!=""&&floorsData[i].location!=undefined){iploc="<em class='net-location'>"+floorsData[i].location+"</em>"}else{if(floorsData[i].iploc!=""&&floorsData[i].iploc!=undefined){iploc="<em class='net-f'>["+floorsData[i].iploc+"]</em>"}else{iploc=""}}if(floorsData[i].phone!=""&&floorsData[i].phone!=undefined&&floorsData[i].phone!="spider"){phone="<em class='sj'>"+floorsData[i].phone+"</em>"}else{phone=""}spCount=parseInt(floorsData[i].spCount);if(floorsData[i].exp&&floorsData[i].exp.currentRank){var code=floorsData[i].exp.currentRank.code;level=code<10?"0"+code:code;var taskMedalName=unescape(floorsData[i].exp.currentRank.task.name);commLevel=$.fn.commMain.ParseTpl($opts.$comm_level,{level:level,code:code,levelMedalName:taskMedalName})}_floorObj=$.fn.commMain.ParseTpl(thecode.commModel.floorListModel,$.extend(true,{},floorsData[i],{debateCode:debateCode,commentId:floorsData[i].commentId,spCount:spCount,num:i+1,floorNum:i,iploc:iploc,phone:phone,commLevel:commLevel}),true);_floorObj=_floorObj.replace("floor-bord","floor-bord-noup floor-bord");if(i>=10&&i<=floorsData.length-5){if(_tempWrapper.length==0){_tempWrapper=$("<div></div>").append(_floorObj)}else{_tempWrapper.append(_floorObj)}}});return _tempWrapper.html()},iintEvts:function(){var _t=this,$opts=_t.opts,$layout=_t.$layout;if($opts.data&&$opts.data.belong){return}$($opts.dingReply).each(function(){var commentId=$(this).closest(".box,.floor-bord").attr("data-commentid"),topicId=$opts.topicId,$commlist=$(this).closest(".box").find(".comSubList");if($(this).closest(".comm-floor-wrapper").length>0){$commlist=$(this).parent().next(".comm-floor-replay")}$(this).find("a").eq(0).agree(commentId,topicId);$(this).find("a").eq(1).reply($commlist,commentId)});$($opts.follow).find(".follow").each(function(){$(this).follows($(this).closest(".box").attr("data-baseid"))});$($opts.floorBordBox).add($($opts.floorBordBoxExt)).each(function(){$(this).bind("mouseover",function(e){var $floor=$(this),$target=$(e.target).closest("div.floor-bord");if($floor[0]===$target[0]){$floor.addClass("floor-bg").find("> h5").removeClass("hide")}});$(this).bind("mouseout",function(e){$(this).removeClass("floor-bg");$(this).find("> h5").addClass("hide")})});if($opts.pageList){$($opts.comList).find(".comm-floor-wrapper .comm-floor-show a").each(function(){$(this).click(function(){var _commNum=$(this).parents(".box").attr("data-commnum");var _floorHtml=_t._showHideFloorHtml(_commNum);var _floorBordNoupWrapper=$(this).parent().parent();_floorBordNoupWrapper.html(_floorHtml);_t._showfloorEvts(_floorBordNoupWrapper)})})}if($opts.backTop){$.fn.backTop()}$("#SOHUcomment .comList .box .argue-wrapper").each(function(){$(this).debateFn()})},_showfloorEvts:function(floorNoupWrapper){var _t=this,$opts=_t.opts;floorNoupWrapper.find("span.feed-set").each(function(){var commentId=$(this).closest(".floor-bord-noup").attr("data-commentid"),topicId=$opts.topicId,$commlist=$(this).closest(".box").find(".comSubList");if($(this).closest(".comm-floor-wrapper").length>0){$commlist=$(this).parent().next(".comm-floor-replay")}$(this).find("a").eq(0).agree(commentId,topicId);$(this).find("a").eq(1).reply($commlist,commentId)});floorNoupWrapper.find(".floor-bord-noup").each(function(){$(this).bind("mouseover",function(e){var $floor=$(this),$target=$(e.target).closest("div.floor-bord");if($floor[0]===$target[0]){$floor.addClass("floor-bg").find("> h5").removeClass("hide")}});$(this).bind("mouseout",function(e){$(this).removeClass("floor-bg");$(this).find("> h5").addClass("hide")})})},changTab:function(n){var _t=this,$opts=_t.opts;var tmp={all:0,hot:1};if(n!=="mine"){$($opts.comMenu).find("li").removeClass("now");$($opts.comMenu).find("li").eq(tmp[n]).addClass("now")}$.each(tmp,function(i,j){if(i==n){$($opts.comMenu).find("li").eq(tmp[i]).unbind("click")}else{$($opts.comMenu).find("li").eq(tmp[i]).unbind("click").bind("click",function(){SohuComment.GetModule("commList").Init($.extend({},$opts,{type:i,pages:{pageNo:1}}))})}})},inputKey:function(e){var e=window.event||e,keyCode=e.keyCode||e.which;var _t=p.l,$opts=_t.opts;var _len=$.fn.commMain.len($.trim($(this).val()));var _rows=$.fn.commMain.len($.trim($(this).val()));var _max=($opts.maxInput);if(_len>_max){$($opts.erInfo).html($.fn.commMain.ParseTpl($opts.$MaxInputTxt,{maxInputLen:_len-_max})).show()}else{$($opts.form).find(".erInfo").html("").hide()}if(e.ctrlKey&&keyCode==13){return}},focusHandler:function(e){var _t=p.l,$opts=_t.opts;if($($opts.comBord).val()==$opts.comm_textAD){$($opts.comInput).addClass("comInputOvr").find("textarea").val("")}else{if(!$($opts.comInput).hasClass("comInputOvr")){$($opts.comInput).addClass("comInputOvr")}}},findDiv:function(param){if(param.xpt){return $(document.body).find('div[data-baseid="'+param.xpt+'"]')}else{if(param.friendid){return $(document.body).find('div[data-baseid="'+param.xpt+'"]')}}return null},initCard:function(){var followerBox=$("#SOHUcomment"),self=this;if(!$.iCard){return}$(function(){self.card=new $.iCard({bindElement:followerBox,params:{product:"scomment"},onFollow:function(param){var $div=self.findDiv(param)},onUnfollow:function(param){var $div=self.findDiv(param);var followerBtn=$div.find("div.fun a");followerBtn.follows(followerBtn.closest(".box").attr("data-baseid"))}})})},popEmote:function(content,isSubmit){var contentStr="",imgSrcLoc="",imgName="",faceHmtl="",remainContent=content,regStr=/http:\/\/comment.news.sohu.com\/upload\/comment4_1\/images\/face\/face_\d{2}\.gif/,regUbbStr=/\[[^\[\]]+\]/g,contentTemp="",faceUbb="",faceUrl="http://comment.news.sohu.com/upload/comment4_1/images/face_0606/",faceArr={"[:D!]":["face_01_s.gif","开心"],"[):(!]":["face_02_s.gif","愤怒"],"[:^!]":["face_03_s.gif","鄙视"],"[:v!]":["face_04_s.gif","给力"],"[:_(!]":["face_05_s.gif","难过"],"[:x!]":["face_06_s.gif","无语"],"[S_G!]":["face_07_s.gif","Strong"],"[U_L!]":["face_08_s.gif","不喜欢"],"[djy!]":["face_09_s.gif","打酱油"],"[G_Z!]":["face_10_s.gif","鼓掌"],"[L_H!]":["face_11_s.gif","流汗"],"[G_M!]":["face_12_s.gif","计划购买"],"[J_Y!]":["face_13_s.gif","加油"],"[S_M!]":["face_14_s.gif","色迷迷"],"[W_S!]":["face_15_s.gif","握手"],"[X_H!]":["face_16_s.gif","喜欢"],"[flo!]":["face_17_s.gif","鲜花"],"[J_J!]":["face_18_s.gif","祭酒"],"[Q_F!]":["face_19_s.gif","祈福"],"[X_flo!]":["face_20_s.gif","献花"],"[S_X!]":["face_21_s.gif","上香"],"[B_M!]":["face_22_s.gif","闭嘴"],"[G_D!]":["face_23_s.gif","感动"],"[J_Ya!]":["face_24_s.gif","惊讶"],"[K_L!]":["face_25_s.gif","可怜"],"[K_B!]":["face_26_s.gif","恐怖"],"[Q_D!]":["face_27_s.gif","期待"],"[S_K!]":["face_28_s.gif","思考"],"[C_K!]":["face_29_s.gif","抓狂"]};if(regStr.test(content)){imgSrcLoc=content.substr(0,content.indexOf("face_"));imgName=content.substr(content.indexOf("face_"),7);contentStr='<img src="'+imgSrcLoc+imgName+'_s.gif" alt="" />'}else{if(regUbbStr.test(content)){faceUbb=content.match(regUbbStr,"").toString();var faceUbbArr=faceUbb.split(",");if(faceUbbArr.length>1){for(var i=0;i<faceUbbArr.length;i++){var f=faceArr[faceUbbArr[i].replace("&#040;","(")];if(typeof f=="undefined"){continue}content=content.replace(faceUbbArr[i],'<img src="'+faceUrl+faceArr[faceUbbArr[i]][0]+'" alt="'+faceArr[faceUbbArr[i]][1]+'" title="'+faceArr[faceUbbArr[i]][1]+'" />');remainContent=remainContent.replace(faceUbbArr[i],"")}contentStr=content}else{var f=faceArr[faceUbb.replace("&#040;","(").replace("&#041;",")")];if(typeof f=="undefined"){return}contentStr=content.replace(regUbbStr,'<img src="'+faceUrl+f[0]+'" alt="'+f[1]+'" title="'+f[1]+'" />');remainContent=remainContent.replace(regUbbStr,"")}}else{return content}}if(remainContent.replace(/\s/g,"")==""&&isSubmit){return"nocomment"}else{return contentStr}}};function emptyContentAlert(a){var b=[255,200,200],bgImg="";if(a.css("backgroundImage")!="none"){bgImg=a.css("backgroundImage");a.css("backgroundImage","none")}a.css("backgroundColor","rgb("+b[0]+","+b[1]+","+b[2]+")");var c=setInterval(function(){b[1]+=10;b[2]+=10;if(b[1]>255){clearInterval(c);if(bgImg!="none"){setTimeout(function(){a.css("backgroundImage",bgImg)},1000)}}a.css("backgroundColor","rgb("+b[0]+","+b[1]+","+b[2]+")")},100)}var openImgUpload=-1;var thecode={commModel:{textstr:function(){var s=new $.Buffers();s.append('<div class="comment-face" style="display:none"><ul><li class="comment-face-now">写评论</li><li>发心情</li></ul></div>');s.append('<div class="remark clear">');s.append('	<div class="l">');s.append('		<div class="rePic">{{#login_rePic}}</div>');s.append('		<div style="margin-top:8px"></div>');s.append('		<div class="reLink">{{#login_reLink}}</div>');s.append("	</div>");s.append('	<div class="r">');s.append('		<div class="nameInfo">{{#comm_nameInfoad}}</div>');s.append('		<div class="form clear">');s.append('			<div class="comInput"><div class="over_txt_msg"></div><textarea class="commtxt comBord">{{#comm_textAD}}</textarea><div class="jiao"></div></div>');s.append('			<div class="faceBtn clear">');s.append('				<div class="comFun" style="position:relative;z-index:500">');s.append("					<ul>");s.append('			<li class="faceDefault">');s.append('							<a href="javascript:void(0);" data_ubb=":D" data_path="base"><img alt="大笑" title="大笑" src="http://js3.pp.sohu.com.cn/ppp/images/emotion/base/spit.gif"></a>');s.append('							<a href="javascript:void(0);" data_path="base" data_ubb="*_*"><img title="发呆" alt="发呆" src="http://js3.pp.sohu.com.cn/ppp/images/emotion/base/muzzy.gif"></a>');s.append('							<a href="javascript:void(0);" data_path="base" data_ubb=":X"><img title="闭嘴" alt="闭嘴" src="http://js3.pp.sohu.com.cn/ppp/images/emotion/base/stopper.gif"></a> ');s.append('							<a href="javascript:void(0);" data_path="base" data_ubb="=:|"><img title="流汗" alt="流汗" src="http://js3.pp.sohu.com.cn/ppp/images/emotion/base/perspire.gif"></a> ');s.append('							<a href="javascript:void(0);" data_path="base" data_ubb="|-)"><img title="犯困" alt="犯困" src="http://js3.pp.sohu.com.cn/ppp/images/emotion/base/yawn.gif"></a> ');s.append('							<a href="javascript:void(0);" data_path="base" data_ubb=":_("><img title="大哭" alt="大哭" src="http://js3.pp.sohu.com.cn/ppp/images/emotion/base/cry.gif"></a> ');s.append('							<a href="javascript:void(0);" data_path="base" data_ubb=":V"><img title="咒骂" alt="咒骂" src="http://js3.pp.sohu.com.cn/ppp/images/emotion/base/curse.gif"></a>  ');s.append('							<a href="javascript:void(0);" data_path="base" data_ubb=":.("><img title="泪奔" alt="泪奔" src="http://js3.pp.sohu.com.cn/ppp/images/emotion/base/weep.gif"></a>  ');s.append("            			</li>");s.append('						<li class="face"><a href="javascript:void(0)" class="" id="emotion_panel_handle"><span class="faceBg"></span>表情</a>');s.append('							<div class="faceFrag emotion-list" style="display:none;"></div>');s.append("						</li>");s.append('						<li class="pk"><a href="javascript:void(0)"><span class="pkBg"></span>辩论</a></li>');s.append('						<li class="img" style="display:none"><a href="javascript:void(0)"><span class="imgBg"></span>图片</a><div class="tips" style="display:none"><a class="k" href="http://zt.pinglun.sohu.com/20121122/n358386716.shtml" target="_blank">传图功能上线啦！</a><span class="c"></span></div></li>');s.append("					</ul>");s.append('				<div class="upload_panel" style="display:none;position:absolute;z-index:999;top:20px;left:90px;"><div class="img_panel img_panel_top"></div><div class="img_panel img_panel_middle"><div class="uploadcontainer"><input accept="image/gif,image/jpeg,image/x-png" type="file" name="imgfile" class="uploadfile" /></div><span href="javascript:void(0)" class="img_upload_btn" >本地上传</span><p class="message">支持5M以内的JPG、GIF、PNG图片文件</p></div><div class="img_panel img_panel_bottom"></div></div>');s.append('				<div class="preview_panel" style="display:none;position:absolute;z-index:999;top:20px;left:90px;"><div class="img_panel img_panel_top"></div><div class="img_panel img_panel_middle preview_panel_middle"><p class="filename"></p><div class="preview"> </div><span class="close">删除</span></div><div class="img_panel img_panel_bottom"></div></div></div>');s.append('				<div class="comBtn"><span class="erInfo red">Ctrl+Enter快捷提交</span><input type="button" class="btn" value="马上发表" attr="comment" /></div>');s.append("			</div>");s.append("		</div>");s.append('<div class="reshipmentShare clear">');s.append('				<div class="comShare clear">');s.append("					<dl>");s.append("						<dt>分享评论到：</dt>");s.append('				<dd title="搜狐微博"><span class="icon t-icon"></span><input type="checkbox" value="3" checked></dd>');s.append('				<dd title="我的搜狐" style="display:none;"><span class="icon isohu-icon"></span><input type="checkbox" value="2" checked ></dd>');s.append("					</dl>");s.append("				</div>");s.append("			</div>");s.append('		<div class="formPK clear" style="display:none">');s.append('			<div class="pkInput"><div class="jiao"></div></div>');s.append('			<h3><span>添加辩论话题</span><a href="#" target="_blank" title="关闭" class="close"></a></h3>');s.append('			<div class="subFrm clear"><span class="pkTt pk_title">辩论主题：</span><input type="text" class="comBord pkBtn" /><span class="pkInfo red"></span></div>');s.append('			<div class="subFrm clear"><span class="pkTt">正方内容：</span><textarea class="pktxtl comBord pkTa"></textarea><span class="pkInfo redTa"></span></div>');s.append('			<div class="subFrm clear"><span class="pkTt">反方内容：</span><textarea class="pktxtr comBord pkTa"></textarea><span class="pkInfo redTa"></span></div>');s.append('			<div class="pkBtn clear"><input type="button" class="btn" value="马上发表" attr="pk" /></div>');s.append("		</div>");s.append("	</div>");s.append("</div>");return s.toString()}(),faceTab:function(){var s=new $.Buffers();s.append('<div class="face-wrapper clear"><div class="face-list">');s.append('</div><div class="no-face-txt"><a href="javascript:void(0);">无语路过&gt;&gt;</a></div></div>');return s.toString()}(),faceCommentTab:function(){var s=new $.Buffers();s.append('<div class="l face-pic"><img src="" width="60" height="60" alt="" title="" /></div>');s.append('<div class="r face-com"><div class="comment-text-wrapper"></div></div>');return s.toString()}(),verifyBox:function(){var s=new $.Buffers();s.append('<div class="vcode-box">');s.append('		<input type="text" name="vcode" id="vcode" class="vcode-input" value="请输入验证码">');s.append('		<input type="hidden" id="vcodeHidden" name="vcodeEn" value="">');s.append('		<div class="chkPic chkPic-talk" id="chkPicDiv">');s.append('			<img width="120" height="33" src="" alt="">');s.append('			<span class="change-vcode"><a href="javascript:void(0)">换一张</a></span>');s.append("		</div>");s.append("</div>");return s.toString()}(),textstrSimple:function(){var s=new $.Buffers();s.append('<div class="remark clear" style="background:none;">');s.append('	<div class="nameInfo"><span class="reLinkSimple">{{#login_reLink}}</span><span class="name">{{#comm_nameInfoad}}</span>{{#comm_suggestion}}</div>');s.append('	<div class="form clear">');s.append('		<div class="comInput"><textarea class="commtxt comBord">{{#comm_textAD}}</textarea></div>');s.append('		<div class="comBtn" style="float:left;"><input type="button"   class="btn btnSimple" attr="comment"><span class="erInfo red" style="padding-left:3px;">[Ctrl+Enter]</span></div>');s.append("	</div>");s.append("</div>");return s.toString()}(),listTap:function(){var s=new $.Buffers();s.append('<div class="comMenu clear">');s.append("	<ul>");s.append("{{#listTap}}");s.append("	</ul>");s.append('<div class="r"></div>');s.append("</div>");return s.toString()}(),myListModel:function(){var s=new $.Buffers();s.append('<div class="mycomList comList clear i-say-scope">');s.append('<div class="icomMenu clear">');s.append("		<ul>");s.append('			<li class="now"><a href="javascript:void(0)">我说的</a><em class="comMenu-j"></em></li>');s.append("		</ul>");s.append('		<div class="r"><span class="i-say-scope-more"><a target="_blank" href={{#Link}}>全部我说的&gt;&gt;</a></span></div>');s.append("	</div>");s.append('<div class="i-say-scope-cont"></div></div>');return s.toString()}(),listModel:function(){var s=new $.Buffers();s.append('<div class="comList allList clear">');s.append('	<div class="comFull"><a href="http://pinglun.sohu.com/s{{#topicId}}.html">已有<span class="red">{{#allCount}}</span>人参与，点击查看更多精彩评论!</a></div>');s.append("</div>");return s.toString()}(),listModelSimple:function(){var s=new $.Buffers();s.append('<div class="comList allList clear">');s.append('	<div class="comFull"><a href="http://pinglun.sohu.com/s{{#topicId}}.html" >已有<span class="red">{{#allCount}}</span>人参与</a></div>');s.append("</div>");return s.toString()}(),commList:function(){var s=new $.Buffers();s.append('<div class="box{{#boxTop}} clear {{#topClass}}" data-commentId="{{#commentId}}" data-baseid="{{#baseid}}" data-commNum="{{#commNum}}" data-from="{{#userFrom}}">');s.append('	<div class="l">');s.append('		<div class="pic"><a href="{{#mylinks}}" target="_blank"><img src="{{#authorimg}}" width="40" height="40" alt="{{#nickname}}" data-card="true" data-card-action="xpt={{#xpt}}" /></a></div>');s.append('		<div class="fun">{{#relation_me}}</div>');s.append("	</div>");s.append('	<div class="r">');s.append('		<h4>{{#commLevel}}<a href="{{#mylinks}}" target="_blank"  class="user-name" data-card="true" data-card-action="xpt={{#xpt}}">{{#nickname}}</a>{{#famous}}{{#LinkHtml}}<span class="medal"></span>{{#iploc}}{{#phone}}{{#elite}}{{#talent}}{{#top}}</h4>');s.append("		<p>{{#content}}</p>{{#image}}");s.append("		{{#debateCode}}");s.append("		{{#original}}");s.append('		<h5><span class="time-from">{{#createTime}} {{#from}}</span><span class="quanzi-from">{{#fromquanzi}}</span><span class="feed-set"><a href="javascript:void(0)">顶</a><font color="red">{{#spCount}}</font> | <a href="javascript:void(0)">回复</a>{{#replyCount}}</span></h5>');s.append("	</div>");s.append('	<div class="comSubList clear" style="display:none"></div>');s.append("</div>");return s.toString()}(),myCommList:function(){var s=new $.Buffers();s.append('<div class="reply"><p>{{#content}}<span class="time-reply">{{#createTime}}</span>');s.append('<span class="time-reply time-myreply">');s.append("{{#link}}");s.append("</span>");s.append("</p>{{#image}}</div>");return s.toString()}(),commListFalse:function(){var s=new $.Buffers();s.append('<div class="box{{#boxTop}} clear {{#topClass}}" data-commentId="{{#commentId}}" data-baseid="{{#baseid}}" data-commNum="{{#commNum}}">');s.append('	<div class="l">');s.append('		<div class="pic"><a href="{{#mylinks}}" target="_blank"><img src="{{#authorimg}}" width="40" height="40" alt="{{#nickname}}" /></a></div>');s.append('		<div class="fun">{{#relation_me}}</div>');s.append("	</div>");s.append('	<div class="r">');s.append('		<h4>{{#commLevel}}<a href="{{#mylinks}}" target="_blank"  class="user-name">{{#nickname}}</a></a></h4>');s.append("		<p>{{#content}}</p>");s.append("		{{#debateCode}}");s.append("		{{#original}}");s.append('		<h5><span class="time-from">{{#createTime}} {{#from}}</span></h5>');s.append("	</div>");s.append('	<div class="comSubList clear" style="display:none"></div>');s.append("</div>");return s.toString()}(),commListMobile:function(){var s=new $.Buffers();s.append('<div class="box{{#boxTop}} clear {{#topClass}}" data-commentId="{{#commentId}}" data-baseid="{{#baseid}}" data-commNum="{{#commNum}}">');s.append('	<div class="l">');s.append('		<div class="pic"><img src="{{#authorimg}}" width="40" height="40" alt="{{#nickname}}" /></div>');s.append("	</div>");s.append('	<div class="r">');s.append('		<h4><em style="margin-right:10px;"  class="user-name">{{#nickname}}</em>{{#iploc}}{{#phone}}{{#elite}}{{#talent}}{{#top}}</h4>');s.append("		<p>{{#content}}</p>{{#image}}");s.append("		{{#debateCode}}");s.append("		{{#original}}");s.append('		<h5><span class="time-from">{{#createTime}} {{#from}}</span><span class="feed-set"><a href="javascript:void(0)">顶</a><font color="red">{{#spCount}}</font> | <a href="javascript:void(0)">回复</a>{{#replyCount}}</span></h5>');s.append("	</div>");s.append('	<div class="comSubList clear" style="display:none"></div>');s.append("</div>");return s.toString()}(),commFalse:function(){var s=new $.Buffers();s.append('<div class="box boxTop clear">');s.append('	<div class="l">');s.append('		<div class="pic"><a href="{{#homeurl}}" target="_blank"><img src="{{#icon}}" width="40" height="40" alt="{{#title}}" /></a></div>');s.append("	</div>");s.append('	<div class="r">');s.append('		<h4>{{#commLevel}}<a href="{{#homeurl}}" class="user-name" target="_blank">{{#nick}}</a><span class="weibo">|<a target="_blank" href="http://comment4.news.sohu.com/direct/cmt_mblog_profile?xpt={{#base64}}&srcid=1002600002">我的微博</a></span></h4>');s.append("		<p>{{#content}}</p>{{#image}}");s.append("		{{#debateCode}}");s.append("		<h5><span>{{#createTime}} {{#from}}</span></h5>");s.append("</div>");s.append("</div>");return s.toString()}(),SubListModel:function(){var s=new $.Buffers();s.append('<div class="box subRemark clear">');s.append('	<div class="l">');s.append('		<div class="pic">{{#login_replyPic}}</div>');s.append("	</div>");s.append('	<div class="r">');s.append('		<div class="reCom"><textarea class="ta comBord"></textarea></div>');s.append('		<div class="faceBtn clear">');s.append('			<div class="comFun">');s.append("				<ul>");s.append('					<li class="face"><a href="javascript:void(0)"><span class="faceBg"></span>表情</a>');s.append('						<div class="faceFrag emotion-list" style="display:none"></div>');s.append("					</li>");s.append("				</ul>");s.append("			</div>");s.append('			<div class="comBtn"><span class="erInfo red">Ctrl+Enter快捷提交</span><input type="button" class="btn" value="马上发表" attr="reply"/></div>');s.append("		</div>");s.append('		<div class="comShare clear">');s.append("			<dl>");s.append("				<dt>分享评论到：</dt>");s.append('				<dd title="搜狐微博"><span class="icon t-icon"></span><input type="checkbox" value="3" checked></dd>');s.append('				<dd title="我的搜狐" style="display:none;"><span class="icon isohu-icon"></span><input type="checkbox" value="2" checked ></dd>');s.append("			</dl>");s.append("		</div>");s.append("	</div>");s.append("</div>");return s.toString()}(),subList:function(){var s=new $.Buffers();s.append('<div class="box clear" data-replyId="{{#replyId}}" data-baseid="{{#baseid}}">');s.append('	<div class="l">');s.append('		<div class="pic"><a href="{{#mylinks}}" target="_blank"><img src="{{#authorimg}}" width="33" height="33" alt="{{#nickname}}" /></a></div>');s.append("	</div>");s.append('	<div class="r">');s.append('		<h4>{{#commLevel}}<a href="{{#mylinks}}" target="_blank"  class="user-name">{{#nickname}}</a>{{#iploc}}{{#phone}}</h4>');s.append("		<p>{{#content}}</p>");s.append('		<h5><span>{{#createTime}}</span><a href="javascript:void(0)">顶</a> | <a href="javascript:void(0)">回复</a></h5>');s.append("	</div>");s.append("</div>");s.append('<div class="line"></div>');return s.toString()}(),subListMobile:function(){var s=new $.Buffers();s.append('<div class="box clear" data-replyId="{{#replyId}}" data-baseid="{{#baseid}}">');s.append('	<div class="l">');s.append('		<div class="pic"><img src="{{#authorimg}}" width="33" height="33" alt="{{#nickname}}" /></div>');s.append("	</div>");s.append('	<div class="r">');s.append('		<h4><em class="nick_sj">{{#nickname}}</em>{{#iploc}}{{#phone}}</h4>');s.append("		<p>{{#content}}</p>");s.append('		<h5><span>{{#createTime}}</span><a href="javascript:void(0)">顶</a> | <a href="javascript:void(0)">回复</a></h5>');s.append("	</div>");s.append("</div>");s.append('<div class="line"></div>');return s.toString()}(),subFalse:function(){var s=new $.Buffers();s.append('<div class="line"></div>');s.append('<div class="box clear">');s.append('	<div class="l">');s.append('		<div class="pic"><a href="{{#homeurl}}" target="_blank"><img src="{{#icon}}" width="33" height="33" alt="{{#title}}" /></a></div>');s.append("	</div>");s.append('	<div class="r">');s.append('		<h4>{{#commLevel}}<a href="{{#homeurl}}" target="_blank">{{#nick}}</a></h4>');s.append("		<p>{{#content}}</p>");s.append("		<h5><span>{{#createTime}}</span></h5>");s.append("	</div>");s.append("</div>");return s.toString()}(),floorListModel:function(){var s=new $.Buffers();s.append('<div class="floor-bord" data-commentId="{{#commentId}}" data-floorNum="{{#floorNum}}">');s.append('	<h4>{{#commLevel}}<em class="num">{{#num}}</em><a href="{{#mylinks}}" target="_blank"  class="user-name" data-card="true" data-card-action="xpt={{#xpt}}" >{{#nickname}}</a>{{#famous}}{{#iploc}}{{#phone}}</h4>');s.append("	<p>{{#content}}</p>");s.append("		{{#debateCode}}{{#image}}");s.append('	<h5 class="hide"><span class="feed-set"><a href="javascript:void(0)">顶</a><font color="red">(<em>{{#spCount}}</em>)</font> | <a href="javascript:void(0)">回复</a></span></h5>');s.append('	<div class="comm-floor-replay" style="display:none"></div>');s.append("</div>");return s.toString()}(),floorReplayModel:function(){var s=new $.Buffers();s.append('	<div class="reCom"><textarea class="ta comBord"></textarea><em class="corner"></em></div>');s.append('	<div class="faceBtn clear">');s.append('		<div class="comFun">');s.append("			<ul>");s.append('				<li class="face"><a href="javascript:void(0)"><span class="faceBg"></span>表情</a>');s.append('					<div class="faceFrag emotion-list" style="display:none"></div>');s.append("				</li>");s.append("			</ul>");s.append("		</div>");s.append('		<div class="comBtn"><span class="erInfo red">Ctrl+Enter快捷提交</span><input type="button" class="btn" value="马上发表" /></div>');s.append("	</div>");s.append('		<div class="comShare clear">');s.append("			<dl>");s.append("				<dt>分享评论到：</dt>");s.append('				<dd title="搜狐微博"><span class="icon t-icon"></span><input type="checkbox" value="3" checked></dd>');s.append('				<dd title="我的搜狐" style="display:none;"><span class="icon isohu-icon"></span><input type="checkbox" value="2" checked ></dd>');s.append("			</dl>");s.append("		</div>");return s.toString()},medalLayerA:function(){var s=new $.Buffers();s.append('<div class="medal-wrapper" id="medal-wrapper01">');s.append('<div class="medal-area">');s.append('<div class="close-wrapper">');s.append('<a title="关闭窗口" href="javascript:void(0)"><span class="login-icon pannel-close"></span></a></div>');s.append('<div class="medal-low"><div class="medal-big"><span class="medal-pic-shadow medal-level4{{#rankImgCode}}"></span></div>');s.append('<div class="medal-low-info">');s.append("<h4>恭喜！</h4>");s.append("<p>{{#info}}</p>");s.append('<h5><a target="_blank" href="http://i.sohu.com/scomment/medal.html#level">勋章等级说明 &gt;&gt;</a></h5></div></div></div></div>');return s.toString()}(),medalLayerB:function(){var s=new $.Buffers();s.append('<div class="medal-wrapper" id="medal-wrapper03">');s.append('<div class="medal-area">');s.append('<div class="close-wrapper">');s.append('<a title="关闭窗口" href="javascript:void(0)"><span class="login-icon pannel-close"></span></a></div>');s.append('<div class="medal-high"><div class="medal-big"><span class="medal-pic-shadow medal-level4{{#rankImgCode}}"></span><a class="medal-level-say" href="http://i.sohu.com/scomment/medal.html#level">[勋章等级说明]</a></div>');s.append('<div class="medal-high-info"><h4>恭喜！</h4>');s.append("<p>{{#info}}</p>");s.append('<div class="medal-textArea"><textarea readonly="readonly" class="medal-text">我刚刚在说两句里升到{{#rank}}级，获得我来说两句“{{#medalName}}”勋章！</textarea></div>');s.append('<div class="share-sohu"><a href="javascript:void(0);"><input type="button" value="分享到我的搜狐" class="medal-btn btn-share"></a></div><div class="suc-share">已成功分享到我的搜狐！</div></div></div></div></div>');return s.toString()}(),medalActionLayer:function(){var s=new $.Buffers();s.append('<div style="" class="medal-wrapper" id="medal-wrapper02">');s.append('<div class="medal-area">');s.append('<div class="close-wrapper"><a title="关闭窗口" href="javascript:void(0)"><span class="login-icon pannel-close"></span></a></div>');s.append('<div class="medal-amend-info">');s.append('<h4><strong><a href="javascript:void(0);">升级提醒：</a></strong>您的说两句经验值已达到<span class="red"><a href="javascript:void(0);">{{#exp}}</a></span></h4>');s.append('<div class="remind-info"><span class="angle"></span>您需要更新头像才能升到<span class="red"><a href="javascript:void(0);">{{#rank}}级</a></span>，并获得"{{#medalName}}"勋章。</div>');s.append('<div class="amend-explain"><span class="amend-head"><a target="_blank" href="http://i.sohu.com/profile/home/swfUploadIcon.htm"><span class="medal-btn btn-amend-head">马上更新头像</span></a></span><a target="_blank" href="http://i.sohu.com/scomment/medal.html#level">勋章等级说明 &gt;&gt;</a></div>');s.append("</div></div></div>");return s.toString()}(),PKLayer:function(){var s=new $.Buffers();s.append('<div class="argue-wrapper clear" topicid="{{#topicId}}">');s.append('				<div class="argue-title"><a href="{{#debateUrl}}" target="_blank">{{#title}}</a></div>');s.append('				<div class="pubStyle pk-cont-left">');s.append('					<div class="pk-cont-tit"><strong>正方</strong>&nbsp;[<strong><a href="{{#debateUrl}}" target="_blank">{{#spCount}}</a></strong>人]</div>');s.append("					<p>{{#supportContent}}</p>");s.append('					<div class="pk-cont-btn"><a href="javascript:void(0);"><input type="button" class="Fbtn" value="支持正方"></a></div>');s.append("				</div>");s.append('				<div class="pk-cont-center">');s.append('					<div class="people-sum">');s.append('						<p><a href="{{#debateUrl}}" target="_blank" class="pk_bg"></a><a href="{{#debateUrl}}" target="_blank"><span>{{#totalCount}}</span></a>人参与</p>');s.append("					</div>");s.append("				</div>");s.append('				<div class="pubStyle pk-cont-right">');s.append('					<div class="pk-cont-tit"><strong>反方</strong>&nbsp;[<strong><a href="{{#debateUrl}}" target="_blank">{{#opCount}}</a></strong>人]</div>');s.append("					<p>{{#opposeContent}}</p>");s.append('					<div class="pk-cont-btn"><a href="javascript:void(0);"><input type="button" class="Fbtn" value="支持反方"></a></div>');s.append("				</div>");s.append("			</div>");return s.toString()}(),PicSimpleSubmit:function(){var s=new $.Buffers();s.append('<span class="review-num"><a href="http://pinglun.sohu.com/s{{#topicId}}.html" target="_blank" title="评论数" hideFocus="true" style="outline:none">(<em>{{#valueCount}}</em>)</a></span>');s.append('<span class="review-btn"><a href="javascript:void(0)" title="我来说两句" hideFocus="true" style="outline:none"></a></span>');s.append('<div class="review-layer">');s.append('    <div class="review-layer-in"><textarea>{{#inputValue}}</textarea></div>');s.append('    <div class="review-layer-btn"><input class="re-appear" type="button" value="马上发表" /><a class="re-cancel" href="javascript:void(0)" hideFocus="true" style="outline:none">取消</a></div>');s.append("</div>");return s.toString()}(),CommentForceFace:function(){var s=new $.Buffers();s.append('<div id="forceEmote">');s.append('	<div class="emoteLayer">');s.append('		<div class="posBlock">');s.append('			<div class="emoteBack">');s.append('				<div class="emoteClose" pvtype="forcefaceclose"><img width="70" height="70" title="打酱油" alt="" src="http://comment.news.sohu.com/upload/comment4_1/images/face_0606/face_09.gif" data_ubb="[djy!]" id="79" style="display:none"></div>');s.append('				<div class="emoteList">');s.append("					<ul>");s.append("					</ul>");s.append("				</div>");s.append("			</div>");s.append("		</div>");s.append("	</div>");s.append('	<div class="coverLayer"></div>	');s.append("</div>");return s.toString()}()}};$.fn.commMain=function(opts){opts=$.extend($.fn.commMain.defaults,opts,{thecode:thecode});return this.each(function(){p.comments[opts.modelName]=new p[opts.modelName]($(this),opts)})};$.fn.commMain.defaults={showList:true,topicId:0,domain:"",pageList:false,fhost:"http://comment.news.sohu.com/upload/comment4_1/",lhost:"http://comment2.news.sohu.com/",dhost:"comment4.news.sohu.com",maxInput:1000,maxPKtitle:20,maxInputPK:500,required:"评论内容不能为空",faceNoCom:"再说两句话吧",PKtitleReq:"请填写辩论标题",PKtitleOSP:"请填写您的观点",debatePart:"参与辩论",debateWait:"等待审核",$comm_nameInfoad:'<span class="name">发表给力评论！看新闻，说两句。</span>{{#inputbox_topright_adver}}{{#inputbox_topright_adver2}}',comm_textAD:"我来说两句用户等级上线啦，发跟帖赢勋章，权利地位非你莫属，快来体验吧！",comm_text:"看完新闻，说两句吧！",commFulltxt:"快来说两句，发表您的见解！",nameCode:10,$MaxInputTxt:"超出{{#maxInputLen}}字",$login_rePic:'<a href="{{#homeurl}}" target="_blank"><img src="{{#icon}}" width="50" height="50" alt=""/></a>',$login_replyPic:'<a href="{{#url}}" target="_blank"><img src="{{#icon}}" width="33" height="33" alt="" /></a>',$icon:"http://js2.pp.sohu.com.cn/ppp/blog/images/common/nobody.gif",$url:"javascript:void(0)",$setUrl:"http://i.sohu.com/profile/home/swfUploadIcon.htm",$login_reLink:'<a href="javascript:void(0)">登录</a>/<a href="javascript:void(0)">注册</a>',$comm_setInfo:'<a href="{{#setUrl}}" title="修改头像" class="setPic" target="_blank">修改头像</a><a href="javascript:void(0)" title="修改密码" class="setPass">修改密码</a>',$comm_newmsg:'<a href="#" target="_blank" style="display:none">您有<span class="red">{{#msgnum}}</span>个新回复</a>',$comm_getName:"登录抢注名字，",$comm_getNamed:"抢注名字，",$comm_getNameUrl:"http://i.sohu.com/login/logon.do?bru=http://i.sohu.com/profile/home/basic.htm?from=self",$comm_getNamedUrl:"http://i.sohu.com/profile/home/basic.htm?form=self",$comm_nameInfo:'<span class="name"><a href="{{#homeurl}}scomment/index.htm" target="_blank" data-card="true" data-card-action="xpt={{#xpt}}">{{#nick}}</a></span><span class="set-nickname">[<a href="javascript:void(0)">修改昵称</a>]</span><span class="medal"></span><span class="weibo"><a target="_blank" href="http://comment4.news.sohu.com/direct/cmt_mblog_profile?xpt={{#base64}}&srcid=1002600001">我的微博</a></span><span class="comm-jifen">|<a href="http://i.sohu.com/app/score/" target="_blank">金币<em class="red">?</em>枚</a></span><span class="newReply">|&nbsp;<a href="http://i.sohu.com/scomment/home/all/#replyme" target="_blank">最新回复<em class="red">0</em></a><a id="my_comment" href="http://i.sohu.com/scomment/home/all/#mypost" target="_blank">|&nbsp;我的评论<em class="red">0</em></a></span>{{#inputbox_topright_adver}}{{#inputbox_topright_adver2}}',$inputbox_topright_adver:"",$inputbox_topright_adver2:'<a target="_blank" href="http://pinglun.sohu.com/">说两句广场>></a>',$comm_nameInfoSimple:'<span class="name"><span style="float:left;">欢迎：</span><a href="{{#url}}" target="_blank">{{#title}}</a><a class="logOut"> 退出</a></span>',$complete:'<div class="complete"></div>',$PicComplete:'<div class="complete"></div>',$follow:"http://{{#host}}/direct/add_friend?passport={{#base64}}",$replyNum:'<div class="line"></div><div class="comSubFull"></div>',$replyUrl:"",$debateCode:'<div class="partPK"><a href="{{#debateUrl}}"{{#detateTarget}}><em>{{#detateText}}</em></a></div>',$original:'<div class="ot">原文：<a href="{{#topicUrl}}" target="_blank">{{#topicTitle}}</a></div>',$commsubmit:"http://{{#host}}/post/comment/",$valueCountTitle:'<div class="reTitle" style="padding-bottom:0px;height:22px;"><a style="float:left;" href="http://pinglun.sohu.com/s{{#topicId}}.html"><strong class="tt">我来说两句</strong>(<span class="red">{{#allCount}}</span>人参与)</a>{{#titleright_adver}}</div>',$titleright_adver:'<span class="titleright_adver" style="float:left"></span>',$valueCommentCount:'(<span class="red">{{#allCount}}</span>人参与/<span class="red">{{#valueCount}}</span>条评论)',$valueCount:'<li class="wB"><a href="http://pinglun.sohu.com/s{{#topicId}}.html">我来说两句<span class="f12">(<span class="red">{{#allCount}}</span>人参与)</span></a></li>',$subjectValueCount:'<li class="wC"><a href="http://pinglun.sohu.com/s{{#subjectId}}.html?id={{#topicId}}">相关说两句<span class="f12">(<span class="red">{{#subjectAllCount}}</span>人参与)</span></a></li>',$listTap:[{listTap:'<li><a href="javascript:void(0);">最新</a><em class="comMenu-j"></em></li><li class="now"><a href="javascript:void(0);">最热</a><em class="comMenu-j"></em></li>'}],$commFulltxt:'<a href="http://pinglun.sohu.com/s{{#topicId}}.html">快来说两句，发表您的见解！</a>',$floorWrapper:'<div class="comm-floor-wrapper"></div>',$floorBordNoupWrapper:'<div class="floor-bord-noup-wrapper" style="display:none"></div>',$floorHide:'<div class="comm-floor-show">楼高<em>{{#floorsCount}}</em>层，查看更多楼层<a href="javascript:void(0)">【点击展开】</a></div>',$commLoading:'<div class="comm-loading"></div>',$comm_suggestion:'<span ><a href="http://q.sohu.com/forum/21/topic/53880429" target="_blank">功能建议</a></span>',$comm_jifen:'<a href="http://gift.sohu.com/gift/pinglun" target="_blank">金币商城</a>',$comm_add_jifen:'<div class="add-jifen"><span class="jifen-icon">+1</span>金币，发跟帖<a href="http://gift.sohu.com/gift/pinglun" target="_blank">去商城抢百元手机充值卡</a></div>',$comm_add_jifen_exp:'<div class="add-jifen"><span class="jifen-icon">+jifenNum</span>金币<br/><span class="exp-icon">+jifenNum</span>经验</div>',$pic_comm_add_jifen_exp:'<div class="add-jifen"><font style="color:red">+jifenNum</font>金币<br/><font style="color:red">+jifenNum</font>经验</div>',$comm_qtalk_info:'<div class="time-prompt-box"><div class="time-prompt"><span class="time-icon icon-prompt"></span>您的密码【<span>{{#password}}</span>】即将过期，请及时<a href="http://passport.sohu.com/web/updateInfo.action?modifyType=password&ru={{#thisUrl}}" target="_blank">修改</a><span class="time-icon icon-decorate"></span><span class="time-icon info-close" title="关闭"></span></div></div>',$comm_level:'<em class="medal-icon medal-level1{{#level}}" title="{{#code}}级 {{#levelMedalName}}"></em>',rePic:"#SOHUcomment .remark .rePic",reLink:"#SOHUcomment .remark .reLink",reLinkSimple:"#SOHUcomment .remark .nameInfo .reLinkSimple",nameInfo:"#SOHUcomment .remark .nameInfo",name:"#SOHUcomment .remark .nameInfo .name",name_set:"#SOHUcomment .remark .nameInfo .set",newmsg:"#SOHUcomment .remark .nameInfo .red",form:"#SOHUcomment .remark .form",comInput:"#SOHUcomment .remark .comInput",comBord:"#SOHUcomment .remark .commtxt",faceFrag:"#emotion_panel_handle",faceDiv:"#SOHUcomment .remark .form .comFun .face",commtopk:"#SOHUcomment .remark .form .comFun .pk",erInfo:"#SOHUcomment .remark .form .comBtn .erInfo",substr:"#SOHUcomment .remark .form .comBtn .btn",formPK:"#SOHUcomment .remark .formPK",closePK:"#SOHUcomment .remark .formPK .close",pkTt:"#SOHUcomment .remark .formPK .subFrm .pkBtn",pkOp:"#SOHUcomment .remark .formPK .subFrm .pktxtl",pkSp:"#SOHUcomment .remark .formPK .subFrm .pktxtr",pkbtn:"#SOHUcomment .remark .formPK .pkBtn .btn",comMenu:"#SOHUcomment .comMenu",comList:"#SOHUcomment .allList",myComList:"#SOHUcomment .mycomList .i-say-scope-cont",comFull:"#SOHUcomment .comList .comFull",dingReply:"#SOHUcomment .comList .box h5 span.feed-set",follow:"#SOHUcomment .comList .box .fun",comm_temp:"",logOut:"#SOHUcomment .remark .nameInfo .name .logOut",commLoading:"#SOHUcomment .comm-loading",floorBordBox:"#SOHUcomment .comm-floor-wrapper .floor-bord",floorBordBoxExt:"#SOHUcomment .comm-floor-wrapper .floor-bord-noup",commJifen:"#SOHUcomment .remark .nameInfo .comm-jifen",newReply:"#SOHUcomment .remark .nameInfo .newReply",commMedal:"#SOHUcomment .remark .nameInfo .medal",comShare:"#SOHUcomment .remark .reshipmentShare",comPromptBox:"#SOHUcomment .remark .time-prompt-box",comPromptClose:"#SOHUcomment .remark .info-close"};$.fn.commMain.ParseTpl=function(str,data,changes){var result;var patt=new RegExp("{{#([a-zA-z0-9]+)}}");while((result=patt.exec(str))!=null){var v=data[result[1]]===0?"0":data[result[1]]||"";if(changes){v=$.fn.commMain.change(v,result[1])}str=str.replace(new RegExp(result[0],"g"),v)}return str};$.fn.commMain.RdStr=function(size,plusTimeStamp){var size0=8;var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";size=size||size0;size=size<1?size0:size;size=size>chars.length?size0:size;var s="";for(var i=0;i<size;i++){var rnum=Math.floor(Math.random()*chars.length);s+=chars.substring(rnum,rnum+1)}if(plusTimeStamp){s+=new Date().getTime()}return s};$.fn.commMain.len=function(r,t){if(!t){return Math.ceil(r.replace(/[^\x00-\xff]/g,"xx").length/2)}else{return r.length}};$.fn.commMain.encode=function(s){return s.replace(/<|%3C/gi,"&lt;").replace(/>|%3E/gi,"&gt;").replace(/"|%22/g,"&quot;")};$.fn.commMain.decode=function(s){return s.replace(/&amp;/g,"&").replace(/&quot;/g,"")};$.fn.commMain.change=function(str,v){var result=str,p="",s=new Array();result=unescape(result);s["&#040;"]="(";s["&#041;"]=")";s["{{#content}}"]="content";for(var n in s){p+=n+"|"}p=p.substring(0,p.length-1);var regn=new RegExp("("+p+")","gi");if(v=="content"){result=result.replace(regn,function($1){return s[$1]});result=result.replace(/\$(&|`|')/g,"$$$$$1");result=result.replace(/http:\/\/pl\.sohu\.com\/[0-9a-zA-Z]+/g,"<a href='$&' target='_blank'>$&</a>");result=EmoteComm.parseBlogEmote(result)}return result};$.fn.commMain.Base64Replace=function(b64){return b64.replace(/\+/g,"-").replace(/\//g,"_")};$.fn.commMain.base64=function(pp){return $.fn.commMain.Base64Replace(Base64.encode(pp))};$.fn.commMain.bindemote=function(o,e){o.unbind("click");o.bind("click",function(){if(typeof EmoteComm=="object"){var offsetX=$(this).parent().position().left;var offsetY=$(this).parent().position().top;var editor=$(this).closest(".form").find("textarea");editor=editor.length==0?e:editor;EmoteComm.show($(this).next(),editor,offsetX,offsetY);$(this).addClass("now")}return false})};$.fn.commMain.replysubmit=function(e){window.SubmitSource=true;var $opts=$.fn.commMain.defaults,_i=this,$layout=$(_i).closest(".box,.comm-floor-replay");var topicId=$opts.topicId,content=$layout.find("textarea").val(),share="";replyToId=$layout.closest(".box:not(.subRemark)").attr("data-replyid"),dataFrom=$layout.closest(".box:not(.subRemark)").attr("data-from");var _floorData;var buffer=new $.Buffers();var _max=($opts.maxInput);var _len=$.fn.commMain.len($.trim(content));var $textArea=$layout.find("textarea");var commentValue=$textArea.val();if(_len>_max){emptyContentAlert($textArea);return}if($(_i).closest(".subRemark").length>0){$(_i).closest(".subRemark").find(".comShare:visible input").each(function(i){if($(this).attr("checked")){share=share+$(this).val()+","}})}else{if($(_i).closest(".comm-floor-replay").length>0){$(_i).closest(".comm-floor-replay").find(".comShare:visible input").each(function(i){if($(this).attr("checked")){share=share+$(this).val()+","}})}}$opts.$commpost=$.fn.commMain.ParseTpl($opts.$commsubmit,$opts);if(commentValue.length==0||commentValue.replace(/\s/g,"").length==0){$layout.find(".erInfo").html($opts.required).show();$.alertMsg($layout.find(".erInfo"));$textArea.focus();return}if(!$opts.login){$opts.submitarr={me:_i};$.CommentLogin.commnetLoginInit(SohuComment.submit);return}$(_i).unbind("click").val("").removeClass("over").addClass("btnLoad").parent().append('<em class="subloding"></em>').find("em").css({top:($(_i).offset().top+$(_i).height()/2-8),left:($(_i).offset().left+$(_i).width()/2-8)});content=$.fn.commMain.encode(content);buffer.append('<input type="hidden" name="replyToId" value="'+replyToId+'" />');buffer.append('<input type="hidden" name="topicId" value="'+topicId+'" />');buffer.append('<input type="hidden" name="cmt_from" value="0" />');buffer.append('<input type="hidden" name="refer" value="'+$.returnRefer()+'" />');buffer.append('<input type="hidden" name="content" value="'+content+'" />');buffer.append('<input type="hidden" name="share" value="'+share+'" />');buffer.append('<input type="submit" name="submitOK" value="马上发表" />');s=buffer.toString();var _floorDataFalse=function(){var floorDataFalse={},commNum=$layout.closest(".box:not(.subRemark)").attr("data-commnum"),floorNum=$layout.closest(".box:not(.subRemark)").attr("data-floornum"),floorData={},floorTop={},floorTempData,commListTempData={},htmlWrapperObj;floorDataFalse=$.extend(true,floorData,$opts.data.commentList[commNum]);floorDataFalse.floors=[];floorTempData=$opts.data.commentList[commNum].floors;if(floorNum==undefined){floorNum=floorTempData.length;commListTempData=$.extend(true,floorTop,$opts.data.commentList[commNum],{from:dataFrom});commListTempData.floors=[]}floorDataFalse.floors=floorTempData.slice(0,parseInt(floorNum)+1);if(commListTempData.commentId!=undefined){floorDataFalse.floors.push(commListTempData)}return(floorDataFalse.floors)};if($opts.floorList){_floorData=_floorDataFalse();if(_floorData.length>=50){$layout.find(".erInfo").html("楼最高50层，不能再盖了！");$(_i).val("马上发表").removeClass("btnload").bind("click",$.fn.commMain.replysubmit);return false}}var submitover=function(){$layout.find("textarea").val("");$layout.parents(".box").find("h5 em").eq(1).text(parseInt($layout.parents(".box").find("h5 em").eq(1).text())+1);$(_i).val("马上发表").removeClass("btnload").bind("click",$.fn.commMain.replysubmit).next("em").remove();content=$.fn.commMain.encode(content);if($opts.floorList){var replayFloor=_floorData[_floorData.length-1];var nickname=unescape(replayFloor.nickname);htmlWrapperObj='<p><em class="reply">回复<a target="_blank" href="'+unescape(replayFloor.mylinks)+'">'+nickname+"</a></em>:"+content+'<span class="time-reply">刚刚</span><span class="time-reply time-myreply"><a href="http://i.sohu.com/scomment/home/all/#mypost" target="_blank">顶0 回复0</a></span></p>'}else{$layout.after($.fn.commMain.ParseTpl(thecode.commModel.subFalse,$.extend(true,{},$opts.pp,{content:content.replace(/\n/g,"<br/>"),fansCount:$opts.relation.fansCount,commLevel:$opts.$comm_level,commentsCount:$opts.relation.commentsCount,createTime:$.fn.commMain.time.friendly(new Date().getTime())}),true));if(/回复\s.+\[.+\]/.test(content)){content=content.replace(/\[.*?\]/,function(){return""})}else{var $user=$layout.closest(".comSubList").closest(".box").find(".r h4 a");var name=$user.html();var link=$user.attr("href");content="回复&nbsp;<a href='"+link+"' target='_blank'>"+name+"</a>:"+content}htmlWrapperObj='<p>{{#content}}<span class="time-reply">刚刚</span><span class="time-reply time-myreply"><a href="http://i.sohu.com/scomment/home/all/#mypost" target="_blank">顶0 回复0</a></span></p>';htmlWrapperObj=$.fn.commMain.ParseTpl(htmlWrapperObj,{content:content},true)}if(_floorData){var floorDataLength=_floorData.length;if(floorDataLength>0&&floorDataLength<9){var plusNumArr=[2]}else{if(floorDataLength==9){var plusNumArr=[2,3]}else{if(_floorData.length<50){var plusNumArr=[2,4]}}}}else{var plusNumArr=[2]}var _commJifen=$.fn.commMain.commJifen.jifenRequest(plusNumArr);var ic=$layout.find(".reCom"),ip=ic;$(document).unbind("showReplayJifenMsg").bind("showReplayJifenMsg",function(e,gold){var addHtml="";var findClass="";if(gold){addHtml=$opts.$comm_add_jifen_exp.replace(/jifenNum/g,gold);findClass=".add-jifen"}else{addHtml=$opts.$complete;findClass=".complete"}$(addHtml).appendTo(ic).css({top:parseInt(ip.height()/2)-17}).fadeIn("fast",function(e){window.setTimeout(function(){$(ic).find(findClass).fadeOut(500,function(){$(this).remove();var $myComment=$("#SOHUcomment .mycomList .i-say-scope-cont");if($myComment.find(".no_comment").length){$myComment.css({"margin-top":"",height:""});$myComment.find(".no_comment").remove()}$myComment.closest(".mycomList").show();var p_length=$myComment.find("div.reply").length;if(p_length>2){$myComment.find("div.reply:eq(2)").remove()}$myComment.prepend(htmlWrapperObj);$(document).scrollTop($myComment.position().top-60);$opts.afterReply&&$opts.afterReply($myComment.position().top-60)})},1000)})})};if($("#divtarget").size()>0){$("#divtarget").remove()}$("<div/>").appendTo("body").css({top:"-5000px",left:"-1000px",position:"absolute"}).attr("id","divtarget").append('<iframe name="replytarget" id="replytarget"></iframe>');$("#replytarget").bind("load",submitover);$("<form/>").appendTo("#divtarget").attr("id","commform").attr("method","post").attr("accept-charset","gbk").attr("action",$opts.$commpost).attr("target","replytarget").append(s);$("#commform").bind("submit",function(){if($.browser.msie){document.charset="gbk"}}).submit();$opts.submitarr=null;$.fn.commMain.commJifen.getUpgradeInfo();return false};$.fn.commMain.from=function(from){from=parseInt(from)||0;var f=["",'来自<a href="http://club.sohu.com" target="_blank">搜狐社区</a>','<a href="http://i.sohu.com/scomment/home/all/" target="_blank">来自我的搜狐</a>','来自<a href="http://t.sohu.com" target="_blank">搜狐微博</a>','<a href="http://wap.sohu.com" target="_blank">来自手机搜狐网</a>',"","",""];return f[from]};$.fn.commMain.relation=function(n){n=parseInt(n)||0;var arr=['<a class="bA follow" href="javascript:void(0)" attr="'+n+'">留言</a>',"",'<a class="bB" href="javascript:void(0)" attr="'+n+'">留言</a>','<a class="bC" href="javascript:void(0)" attr="'+n+'">留言</a>','<a class="bA follow" href="javascript:void(0)" attr="'+n+'">留言</a>'];return arr[n]};$.fn.commMain.time={now:function(){return(new Date()).getTime()},getDateStr:function(time,splitStr){splitStr=typeof(splitStr)=="string"?splitStr:"-";var date=new Date();date.setTime(time);var str=date.getFullYear()+splitStr+(date.getMonth()+1)+splitStr+date.getDate();return str},friendly:function(time){var tip="",second=1000,minute=second*60,hour=minute*60,now_time=($.fn.commMain.defaults.data&&$.fn.commMain.defaults.data.now)||+new Date,now=new Date(),now_year=now.getFullYear(),now_month=now.getMonth(),now_date=now.getDate(),now_midnight=new Date(now_year,now_month,now_date),midnight_time=now_midnight.getTime(),diff=now_time-time;if(diff<0){tip=""}else{if(diff<=minute*5){tip="刚刚"}else{if(diff<hour){var m=Math.floor(diff/minute);tip=m+"分钟前"}else{if(diff<now_time-midnight_time){var t=new Date(time),hh=t.getHours(),mm=t.getMinutes();if(hh<10){hh="0"+hh}if(mm<10){mm="0"+mm}tip="今日 "+hh+":"+mm}else{var t=new Date(time),MM=t.getMonth()+1,DD=t.getDate(),hh=t.getHours(),mm=t.getMinutes();if(MM<10){MM="0"+MM}if(DD<10){DD="0"+DD}if(hh<10){hh="0"+hh}if(mm<10){mm="0"+mm}tip=MM+"月"+DD+"日 "+hh+":"+mm}}}}return tip}};$.fn.commMain.commJifen={getUserInfo:function(){var $opts=p.me.opts,score=0,userBaseID=$opts.pp.base64,fansUrl="/direct/cmt_user_fanscount?xpt="+userBaseID,cmtUrl="/static/cmt_user_count/"+userBaseID+"/",jifenUrl="/proxy_isur/sur/bonus.json?xpt="+userBaseID+"&callback=jQuery.fn.commMain.commJifen.getJifenRequest_suc",expUrl="/proxy_cmtexp/api/uinfo?aid=cmt&uid="+userBaseID+"&callback=jQuery.fn.commMain.commJifen.getCommentExp_suc",infoUrlCom="http://comment4.news.sohu.com/mixreq?q="+escape(fansUrl)+"&q="+escape(cmtUrl)+"&q="+escape(jifenUrl)+"&q="+escape(expUrl);var $userInfo=$("#container .user-info .info-box");if($userInfo.length>0){$userInfo.find(".nickname a").html($opts.pp.nick);$userInfo.find(".nickname a").attr("href",$opts.pp.homeurl+"scomment/index.htm");$userInfo.find(".set-nickname").hide()}$.ajax({type:"GET",dataType:"script",scriptCharset:"utf-8",url:infoUrlCom,success:function(){var $userInfo=$("#container .info-box");if(window.fansCount){var fansNum=window.fansCount.fansCount?window.fansCount.fansCount:0;if($userInfo.length>0){$userInfo.find("a#fansCount").html(fansNum+"个")}}if(window.userCount){if($userInfo.length>0){$userInfo.find(".comm_reply a").html(window.userCount.unreadCount+"条");$userInfo.find(".comm_commcount a").html(window.userCount.commentsCount+"条")}$("#SOHUcomment .r .newReply a:eq(0) em").html(window.userCount.unreadCount);$("#SOHUcomment .r .newReply a:eq(1) em").html(window.userCount.commentsCount)}}})},getJifenRequest_suc:function(data){var $opts=p.me.opts,score=data.score,$userInfo=$("#container .user-info");if($userInfo.length>0){$userInfo.find(".comm_money em").html(score)}$("#SOHUcomment .r .comm-jifen a em").html(score)},getCommentExp_suc:function(data){if(data==null){return}if(!data.currentRank){return}var $opts=p.me.opts,maxExp=parseInt(data.currentRank.maxExp),minExp=parseInt(data.currentRank.minExp),todayRank=data.todayRank,yesterdayRank=data.yesterdayRank,exp=data.exp,code=data.currentRank.code,levelBarPer=parseInt(((exp-minExp)/(maxExp+1-minExp))*100),level=code<10?"0"+code:code,levelMedalName=data.currentRank.task.name,levelMedalMemo=data.currentRank.task.memo;levelBarPer=levelBarPer>100?100+"%":levelBarPer+"%";$opts.pp.level=level;$opts.pp.levelMedalName=levelMedalName;var $userInfo=$("#container .user-info");if($userInfo.length>0){$userInfo.find("dl .grade a").html(code+"级");$userInfo.find("dl .plan .experience").html(exp+"/"+(maxExp+1));if((maxExp-exp+1)>0){$userInfo.find("dl .plan").attr("title","还需要"+(maxExp-exp+1)+"个经验值才可升级")}$userInfo.find("dl .plan img").css("width",levelBarPer);$userInfo.find("h3 .medal-icon").attr({name:levelMedalName,memo:levelMedalMemo,level:level});$userInfo.find("h3 .medal-icon").addClass("medal-icon medal-level1"+level)}if(todayRank>0){$userInfo.find("dt.rank a").html(todayRank+"名");if(todayRank>yesterdayRank){$userInfo.find("dd.rank_compare em img").attr("src","http://comment.news.sohu.com/upload/comment4_1/images/downTip.gif");$userInfo.find("dd.rank_compare a").html((todayRank-yesterdayRank)+"名")}else{$userInfo.find("dd.rank_compare em img").attr("src","http://comment.news.sohu.com/upload/comment4_1/images/upTip.gif");$userInfo.find("dd.rank_compare a").html((yesterdayRank-todayRank)+"名")}}$("#SOHUcomment .r .nameInfo .medal").html('<em class="medal-icon medal-level1'+level+'" title="'+code+"级 "+levelMedalName+'"></em>');for(var i=0;i<data.finishedTasks.length;i++){var medalData=data.finishedTasks[i];$("#container .user-info .info-box h3 em:eq(0)").after("<em class='medal-icon medal-level1"+medalData.code+"_honor' name='"+medalData.name+"' level='"+medalData.code+"' memo='"+medalData.memo+"' medal_type='honor'></em>");if(i==1){$("#container .user-info .info-box .medal-icon").css("margin-left","2px")}}$(function(){var medal=$("#container .user-info h3 em");var medal_layer=$("#container .user-info h3 .medal-layer");$.each(medal,function(i,el){var $el=$(el);$el.hover(function(){var $this=$(this);var medalName=$this.attr("name");var level=$this.attr("level");var memo=$this.attr("memo");if($this.attr("medal_type")=="honor"){medal_layer.find(".medal-big span").attr("class","medal-pic-shadow medal-level4"+level+"_honor")}else{medal_layer.find(".medal-big span").attr("class","medal-pic-shadow medal-level4"+level)}medal_layer.find(".medal-info h4 a").html(medalName);if(memo){medal_layer.find(".medal-info p").html(memo)}medal_layer.css("left",$this.position().left-194);medal_layer.show()},function(){medal_layer.hide()})});medal_layer.hover(function(){$(this).show()},function(){$(this).hide()})})},getUpgradeInfo:function(){var $opts=p.me.opts,userID=$opts.pp.base64,upgradeInfoUrl="http://sur.pinglun.sohu.com/api/check?aid=cmt&uid="+userID+"&callback=?";$.ajax({type:"GET",url:upgradeInfoUrl,dataType:"jsonp",scriptCharset:"utf-8",success:function(data){if(!data){return}var exp=data.exp,infoId=data.infoId;function layerPos($obj){var top=((window.innerHeight?window.innerHeight/2:document.documentElement.clientHeight/2)-100);var left=((window.innerWidth?window.innerWidth/2:document.documentElement.clientWidth/2)-208);if($.browser.msie&&($.browser.version=="6.0")){$obj.css({display:"block",position:"absolute",top:top,left:left});$(window).scroll(function(){var height=document.documentElement.scrollTop+top;$obj.css({top:height})})}else{$obj.css({display:"block",position:"fixed",top:top,left:left})}}function addEvt($el,infoId){$el.find(".close-wrapper").click(function(){$el.hide();if(infoId){var infoIdUrl="http://sur.pinglun.sohu.com/api/confirm?aid=cmt&id="+infoId;$.getScript(infoIdUrl)}})}if(data.rank){var rankCode=data.rank.code,level=rankCode<10?"0"+rankCode:rankCode,medalName=data.rank.task.name,medalLayer=null,medalData={};medalData.exp=data.exp;medalData.rank=data.rank.code;medalData.rankImgCode=data.rank.task.code;medalData.medalName=data.rank.task.name;medalData.info=data.rank.task.info;medalData.feedHtml=data.rank.task.feedHtml;if(data.actions.length){$("body").append($.fn.commMain.ParseTpl(thecode.commModel.medalActionLayer,medalData));medalLayer=$("body > .medal-wrapper");layerPos(medalLayer);addEvt(medalLayer);setTimeout(function(){$("#container .user-info dt.grade span").attr("title","需要有头像才可升级")},500)}else{if(level>4){$("body").append($.fn.commMain.ParseTpl(thecode.commModel.medalLayerA,medalData))}else{$("body").append($.fn.commMain.ParseTpl(thecode.commModel.medalLayerB,medalData));$("#medal-wrapper03 .share-sohu a").click(function(){var content=$("#medal-wrapper03 .medal-textArea textarea").val();$.getScript("http://comment4.news.sohu.com/direct/cmt_share?content="+escape(content)+"&url=http://comment.news.sohu.com/upload/comment4_1/images/medal/medal_level4"+level+"_w24.png&type=1");$(this).hide();$("#medal-wrapper03 .medal-textArea").hide();$("#medal-wrapper03 .suc-share").show()})}medalLayer=$("body > .medal-wrapper");layerPos(medalLayer);addEvt(medalLayer,data.infoId)}}}})},jifenRequest:function(arr){var $opts=p.me.opts,myUserId=$opts.pp.base64,medalUrl="http://sur.pinglun.sohu.com/api/uinfo?aid=cmt&uid="+myUserId+"&callback=?",maxExpArr=[5,3,5,6,4],getGoldArr=[1,1,1,2,1],getGold=0;$.ajax({type:"GET",url:medalUrl,dataType:"jsonp",scriptCharset:"utf-8",success:function(data){var expArr=[];if(data){expArr.push(data.todayPostExp);expArr.push(data.todayFirstCommentExp);expArr.push(data.todayCommentExp);expArr.push(data.todayCommentFloor10Exp);expArr.push(data.todayCommentFloor11Exp)}else{expArr=[0,0,0,0,0]}for(var i=0;i<arr.length;i++){var j=arr[i];if(expArr[j]<maxExpArr[j]){getGold+=getGoldArr[j]}}if(arr[0]==0){if(getGold>0){$(document).trigger("showJifenMsg",[getGold])}else{$(document).trigger("showCommentMsg")}}else{if(getGold>0){$(document).trigger("showReplayJifenMsg",[getGold])}else{$(document).trigger("showReplayJifenMsg")}}}})},getJifenRequest:function(){var _t=p.me,$opts=_t.opts,score=0;var jifenUrl="http://api.ums.sohu.com/sur/summary.json?xpt="+$opts.pp.base64+"&callback=?";var medalImg="";$.ajax({type:"GET",url:jifenUrl,dataType:"jsonp",scriptCharset:"utf-8",success:function(data){score=data.data.score;$($opts.commJifen).find("em.red").html(score);$.fn.commMain.defaults.money=score;$(function(){$(document).trigger("moneyLoaded")});var medals=data.data.medal;for(var i=0;i<medals.length;i++){if(medals[i].code=="comment_02"){medalImg=medals[i].img;$($opts.commMedal).html('<img height="20" width="20" alt="我来说两句勋章" title="我来说两句勋章" src="'+medalImg+'">')}}}})},getMedalRequest:function(){var doMainArr=["pinglun"],hostName=location.hostname.split("."),thisDoMain=hostName[0];if($.inArray(thisDoMain,doMainArr)==-1){return}var _t=p.me,$opts=_t.opts,score=0;var medalUrl="http://api.ums.sohu.com/change-activity/"+$opts.pp.userId+"/comment";$.ajax({type:"GET",url:medalUrl,dataType:"jsonp",jsonpCallback:"surChangeActivityCallback",success:function(data){}})},showMedalRequest:function(layout){var xpt=$(layout).attr("data-baseid");var jifenUrl="http://api.ums.sohu.com/sur/summary.json?xpt="+xpt+"&callback=?";var medalImg="";$.ajax({type:"GET",url:jifenUrl,dataType:"jsonp",scriptCharset:"utf-8",success:function(data){var medals=data.data.medal;for(var i=0;i<medals.length;i++){if(medals[i].code=="comment_02"){medalImg=medals[i].img;$(layout).find(".r h4 .medal").html('<img height="20" width="20" alt="" src="'+medalImg+'">')}}}})}};$.fn.commMain.commCount={getReplyRequest:function(){var _t=p.me,$opts=_t.opts;var user=$opts.pp.userId;var replayUrl="http://comment4.news.sohu.com/direct/cmt_user_count?passport="+user;$.getScript(replayUrl,function(){$($opts.newReply).find("em.red").html(userCount.unreadCount);$.fn.commMain.defaults.newCommReply=userCount.unreadCount;$.fn.commMain.defaults.myCommCount=userCount.commentsCount;$(function(){$(document).trigger("commentLoaded")})})},renewReplay:function(){var _t=p.me,$opts=_t.opts;var user=$opts.pp.base64;var renewUrl="http://comment4.news.sohu.com/direct/cmt_user_clear_unread_count?xpt="+user;$.getScript(renewUrl,function(){var $commReplyNodeA=$($opts.newReply);var $commReplyNodeB=$("#container .user-info dt.comm_reply a");if($commReplyNodeA.length>0){$commReplyNodeA.find("em.red:eq(0)").html("0")}if($commReplyNodeB.length>0){$commReplyNodeB.html("0条")}})}};$.fn.commMain.getMyComment=function(callback){var _t=p.me,$opts=_t.opts;var mytopicUrlData="http://"+$opts.host+"/static/cmt_user_topic_allcomment/"+$opts.pp.base64+"/"+$opts.topicId+"/1/3/?"+Math.random();if(typeof $opts.pp.base64==="undefined"){return}if(!window.cmt_user_topic_allcomment||!window.cmt_user_topic_allcomment.commentList.length){$.getScript(mytopicUrlData,function(){window.cmt_user_topic_allcomment=eval(cmt_user_topic_allcomment)||null;SohuComment.GetModule("commList").preLoad(window.cmt_user_topic_allcomment,"mine");callback&&callback()},{cache:true})}};$.fn.commMain.setCaretPosition=function(ctrl,pos){if(ctrl.setSelectionRange){ctrl.focus();ctrl.setSelectionRange(pos,pos)}else{if(ctrl.createTextRange){var range=ctrl.createTextRange();range.collapse(true);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}}};$.fn.shareToQuanzi={checkShared:function(fn){var quanZhuList=[];function callfn(){var passport=PassportSC.cookieHandle();for(var i=0;i<quanZhuList.length;i++){if(passport==quanZhuList[i]){fn();break}}}if(quanZhuList.length>0){callfn();return}$.getScript("http://q.sohu.com/groupAdmin.js",function(){quanZhuList=groupAdmin||[];callfn()})},readData:function(url,fn){var _self=this;var url="http://q.sohu.com/channel/group/detail?callback=?";$.ajax({type:"get",url:url,dataType:"jsonp",scriptCharset:"utf-8",data:{passport:PassportSC.cookieHandle(),topicId:this.opts.topicId},success:function(jsonData){if(jsonData&&jsonData.status===1){var data=[];for(var i=0;i<jsonData.groupList.length;i++){if($.cookie("sharedQuanzi")){if(new RegExp(jsonData.groupList[i].groupId+"_"+_self.opts.topicId).test($.cookie("sharedQuanzi"))){continue}}data.push({quanziId:jsonData.groupList[i].groupId,quanziTitle:jsonData.groupList[i].groupName})}_self.data=data;fn(data)}}})},init:function(opts){if(!PassportSC.cookieHandle()){return}this.inUse=true;var _self=this;this.opts=opts;this.checkShared(function(){_self.readData("",function(d){$(opts.container).prepend(_self.buildHTML(d));_self.$Element=$(opts.container).find(".comReshipment");_self.initEvent()})})},reinit:function(){if(!this.inUse){return}$(this.opts.container).find(".comReshipment").remove();$(this.opts.container).prepend(this.buildHTML(this.data));this.$Element=$(this.opts.container).find(".comReshipment");this.initEvent()},buildHTML:function(data){if(!this.inUse){return""}function cutStr(str){if(str.length>10){return str.substring(0,10)+"..."}return str}if(!data||data.length<=0){return""}var first=data[0];var s=new $.Buffers();s.append('<div class="comReshipment clear">');s.append("					<dl>");s.append("						<dt>转载评论及文章到：</dt>");s.append('						<dd class="siteSelect clear"><input type="checkbox" value="'+first.quanziId+'" /><span title="'+first.quanziTitle+'圈" style="'+(data.length>1?"":"cursor:default;")+'">'+cutStr(first.quanziTitle)+"圈</span>"+(data.length>1?"<em></em>":""));if(data.length>1){s.append('								<div class="siteSelectMenu clear">');s.append("									<ul>");for(var i=1;i<data.length;i++){var q=data[i];s.append('										<li class="clear"><input type="checkbox" value="'+q.quanziId+'" /><span title="'+q.quanziTitle+'圈">'+cutStr(q.quanziTitle)+"圈</span></li>")}s.append("									</ul>");s.append("								</div>")}s.append("						</dd>");s.append("					</dl>");s.append("				</div>");return s.toString()},initEvent:function(){if(!this.inUse){return}var _self=this;_self.$Element.find(".siteSelect em,.siteSelect span:eq(0)").unbind("click").click(function(e){var el=$(e.target).parents(".comReshipment");el.find(".siteSelectMenu").width(el.find(".siteSelect").width());el.find(".siteSelectMenu").toggle()})},SelectedValue:function(el){if(!this.inUse){return""}var val=[];el.find("input:checked").each(function(i){val.push(this.value)});return val.join(",")},RemoveShared:function(sharedIds){if(!this.inUse){return}var ids=sharedIds.split(",");for(var i=0;i<ids.length;i++){for(var j=0;j<this.data.length;j++){if(this.data[j].quanziId==ids[i]){this.data.splice(j,1);ids.splice(i,1);i--;j--}}}this.reinit()},GetQuanziInfo:function(Ids){if(!this.inUse){return""}var ids=Ids.split(",");var quanzi=[];for(var i=0;i<ids.length;i++){for(var j=0;j<this.data.length;j++){if(this.data[j].quanziId==ids[i]){quanzi.push(this.data[j]);continue}}}return quanzi},GetSharedAdver:function(topicId,fn){$.ajax({type:"get",url:"http://q.sohu.com/group/newscomment/getNewsAssociateGroups?fn=?",dataType:"jsonp",scriptCharset:"utf-8",data:{newsId:topicId},success:function(jsonData){if(jsonData&&jsonData.groupId&&jsonData.title){var str='<span>该文章已被转载至 <a class="quanzi" href="http://q.sohu.com/group/'+jsonData.groupId+'" target="_blank">'+jsonData.title+'</a>(<span style="color:red">'+jsonData.memberCount+"</span>人)</span>";fn(str)}}})}};$.fn.picFace={handle:{init:function(){var openPicFace=(/pic\.(\S+)\.sohu\.com/ig.test(window.location.host)&&$("#adsFrame").size()>0&&!$.cookie("pic_facetoshow"));if(!openPicFace){return}var _t=this,_me=p.me,$opts=_me.opts;$("#adsFrame").append("<div class='picFace'><div class='picFaceContainer'><div class='picFaceTips'>浏览新闻图片，心情一点即发!<a class='picFaceSay' href='javascript:void(0)'>我要评论&gt;&gt;</a><span class='close'></span></div><div class='emoteList'><ul></ul></div></div></div>");$opts.faceUrl=$opts.faceUrl||"http://{{#host}}/direct/topic/detail/face/{{#topicId}}";faceUrl=$.fn.commMain.ParseTpl($opts.faceUrl,$.extend({},$opts));var showFaceImg=function(d,qingComm){var faceListData=d.faceList,faceListStr="",faceCount=d.faceCount;$.each(faceListData,function(i){var face_count=faceCount[faceListData[i].id];var count=face_count==undefined?0:face_count;faceListStr=faceListStr+'<li pvtype="forcefaceposition'+i+'"><img id="'+faceListData[i].id+'" data_ubb="'+unescape(faceListData[i].faceCode)+'"  src="'+unescape(faceListData[i].url).replace(/.gif/g,"_a.gif")+'" width="70" height="70" alt="" title="'+unescape(faceListData[i].name)+'" /><span>'+unescape(faceListData[i].name)+"<br><strong>"+count+"</strong></span></li>"});$("#adsFrame .emoteList ul").append(faceListStr);_t.bindEvent()};$.ajax({type:"get",url:faceUrl,dataType:"script",scriptCharset:"utf-8",success:function(){var mode=facelist.mode;if(mode!=4){$opts.showFace=true;showFaceImg(facelist)}}})},bindEvent:function(){var _t=this,_me=p.me,$opts=_me.opts,clickFlag=true;var setCookie=function(){var expdate=new Date();var expdate2=new Date();expdate2.setHours(23,59,59);expdate.setTime(expdate2.getTime());$.cookie("pic_facetoshow",true,{expires:expdate,path:"/",domain:"sohu.com"})};var _faceLiEvt=function(e){setCookie();$("#SOHUcomment .comment-face ul li:eq(0)").click();var $this=$(this);if(!clickFlag){return}$.regMonitor($this.attr("pvtype"));clickFlag=false;var imgSrcA=$this.find("img").attr("src"),imgSrc=imgSrcA.replace(/_a.gif|.gif/g,"_b.gif"),ubb=$this.find("img").attr("data_ubb"),$num=$this.find("strong");var showImgCom=function(){var $textArea=$("#SOHUcomment .remark:eq(0) .r .form textarea");$textArea.focus();var $subbtn=$("#SOHUcomment .remark:eq(0) .r .comBtn .btn");$subbtn.unbind("click").bind("click",_me.submitComm);$textArea.val(ubb);$.fn.commMain.setCaretPosition($textArea.get(0),$textArea.val().length);$this.unbind("click",_faceLiEvt);clickFlag=true;$("#adsFrame .picFace").remove();setTimeout(function(){$("#SOHUcomment .remark:eq(0) .r .comBtn .btn").click()},50)};var faceId=$this.find("img").attr("id");var dingUrl="http://{{#host}}/post/quickcomment?topicId={{#topicId}}&quickId={{#faceId}}&cmt_from=7";$.getScript($.fn.commMain.ParseTpl(dingUrl,$.extend({},$opts,{faceId:faceId})),function(){},{cache:false});$this.unbind("click",_faceLiEvt);$opts.forceface2show=true;$.fn.commMain.defaults.ForceFaceSend=true;showImgCom()};$("#adsFrame .emoteList ul li").unbind("mouseover").unbind("mouseout").bind("mouseover",function(){$(this).addClass("current")}).bind("mouseout",function(){$(this).removeClass("current");return}).bind("click",_faceLiEvt);$("#adsFrame .picFace a.picFaceSay").bind("click",function(){$("#SOHUcomment .comment-face ul li:eq(0)").click();setCookie();var $textArea=$("#SOHUcomment .remark:eq(0) .r .form textarea");$textArea.focus();$("#adsFrame .picFace").remove();window.scrollTo(0,$textArea.offset().top-100)});$("#adsFrame .close").click(function(){setCookie();$(this).parents(".picFace").remove()})}}};$.fn.commForceFace={handle:{init:function(){var _t=this,_me=p.me,$opts=_me.opts;$opts.faceUrl=$opts.faceUrl||"http://{{#host}}/direct/topic/detail/face/{{#topicId}}";faceUrl=$.fn.commMain.ParseTpl($opts.faceUrl,$.extend({},$opts));var showFaceImg=function(d,qingComm){$("html,body").css({overflow:"hidden"});var initPosition=function(){var wid=$("html,body").width();var upH=$("html,body").height();if(upH<530){upH=530}$("#forceEmote .coverLayer").height(upH);$("#forceEmote .coverLayer").width(wid);$("#forceEmote .emoteLayer").width(wid)};$(window).bind("resize",function(){initPosition()});var faceListData=d.faceList,faceListStr="",faceCount=d.faceCount;$.each(faceListData,function(i){var face_count=faceCount[faceListData[i].id];var count=face_count==undefined?0:face_count;faceListStr=faceListStr+'<li pvtype="forcefaceposition'+i+'"><img id="'+faceListData[i].id+'" data_ubb="'+unescape(faceListData[i].faceCode)+'"  src="'+unescape(faceListData[i].url).replace(/.gif/g,"_a.gif")+'" width="70" height="70" alt="" title="'+unescape(faceListData[i].name)+'" /><span>'+unescape(faceListData[i].name)+"<br><strong>"+count+"</strong></span></li>"});$("#forceEmote .emoteList ul").append(faceListStr);initPosition();var _Set=function(k,v,e,p){var _D=new Date();var day=new Array(31,28,31,30,31,30,31,31,30,31,30,31);var y=_D.getFullYear();day[1]=(0==y%4&&(y%100!=0||y%400==0))?29:28;var m=_D.getMonth();var d=_D.getDate();if(d>=day[m]){if(m>=11){y++;m=0;d=1}else{m++;d=1}}else{d++}var time=new Date(y,m,d,0,0,0,0);_D.setTime(time.getTime());document.cookie=k+"="+v+"; "+(!e?"":"; expires="+_D.toUTCString())+(!p?"":"; path="+p+";domain=sohu.com;")};_Set("facetoshow","true",1,"/");_t.bindEvent()};$.ajax({type:"get",url:faceUrl,dataType:"script",scriptCharset:"utf-8",success:function(){var mode=facelist.mode;if(mode!=4){$("body").append(thecode.commModel.CommentForceFace);$opts.showFace=true;showFaceImg(facelist)}}})},bindEvent:function(){var _t=this,_me=p.me,$opts=_me.opts,clickFlag=true;$emoteBack=$("#forceEmote .emoteLayer .emoteBack");$emoteBack.unbind("mouseover").unbind("mouseout").bind("mouseover",function(){$(this).find(".emoteClose").show()}).bind("mouseout",function(){if($.browser.msie){var moevt=window.event;var clname=moevt.srcElement.className;if(clname!=="emoteBack"){moevt.cancelBubble=true;return}else{$(this).find(".emoteClose").hide()}}else{$(this).find(".emoteClose").hide()}});var _faceLiEvt=function(e){var $this=$(this);if(!clickFlag){return}$.regMonitor($this.attr("pvtype"));clickFlag=false;var imgSrcA=$this.find("img").attr("src"),imgSrc=imgSrcA.replace(/_a.gif|.gif/g,"_b.gif"),ubb=$this.find("img").attr("data_ubb"),$num=$this.find("strong");var showImgCom=function(){var $textArea=$("#SOHUcomment .remark:eq(0) .r .form textarea");$textArea.focus();var $subbtn=$("#SOHUcomment .remark:eq(0) .r .comBtn .btn");$subbtn.unbind("click").bind("click",_me.submitComm);$textArea.val(ubb);$.fn.commMain.setCaretPosition($textArea.get(0),$textArea.val().length);$this.bind("click",_faceLiEvt);clickFlag=true;$("#forceEmote").remove();setTimeout(function(){$("#SOHUcomment .remark:eq(0) .r .comBtn .btn").click()},50);$("html,body").removeAttr("style");$("html,body").attr("style","")};var faceId=$this.find("img").attr("id");var dingUrl="http://{{#host}}/post/quickcomment?topicId={{#topicId}}&quickId={{#faceId}}&cmt_from=7";$.getScript($.fn.commMain.ParseTpl(dingUrl,$.extend({},$opts,{faceId:faceId})),function(){},{cache:false});$this.unbind("click",_faceLiEvt);$opts.forceface2show=true;$.fn.commMain.defaults.ForceFaceSend=true;showImgCom()};var $supportRotate=($.browser.msie&&($.browser.version=="5.0"||"5.5"||"6.0"||"7.0"||"8.0"));$emoteBack.find(".emoteClose").unbind("mouseover").unbind("mouseout").bind("mouseover",function(){if(!$supportRotate){$(this).addClass("emoteCloseHover")}}).bind("mouseout",function(){if(!$supportRotate){$(this).removeClass("emoteCloseHover")}}).bind("click",_faceLiEvt);$("#forceEmote .emoteLayer .emoteBack .emoteList ul li").unbind("mouseover").unbind("mouseout").bind("mouseover",function(){$(this).addClass("current")}).bind("mouseout",function(){$(this).removeClass("current");return}).bind("click",_faceLiEvt)}}}})(jQuery);(function($){var p={modules:{}},pub={version:"12.01.14.18:00",opts:{}};pub.userInfo={icon:$.fn.commMain.defaults.$icon};pub.commentGetUserInfo=function(opts){var _t=this;var userId=PassportSC.cookieHandle();userId=$.fn.commMain.Base64Replace(Base64.encode(userId));var accountUrl="http://hs.i.sohu.com/account/accountinfo/?xpts="+userId+"&from=comment&cb=?";$.ajax({type:"get",url:accountUrl,dataType:"jsonp",success:function(jsonData){$.extend(SohuComment.userInfo,jsonData.data[userId]||{},{base64:userId,userId:PassportSC.cookieHandle()});_t.Onload(opts);return}});return};pub.login=function(){var $opts=$.fn.commMain.defaults;$.extend($opts,{login:true,pp:SohuComment.userInfo});if($opts.pp.icon==""){$opts.pp.icon=$opts.$icon}$($opts.rePic).find("a").attr("href",$opts.pp.homeurl);$($opts.rePic).find("a").attr("target","_blank");$($opts.rePic).find("img").attr("src",$opts.pp.icon);$($opts.nameInfo).html($.fn.commMain.ParseTpl($opts.$comm_nameInfo,$.extend($opts.pp,{setUrl:$opts.$setUrl,inputbox_topright_adver:$opts.$inputbox_topright_adver,inputbox_topright_adver2:$opts.$inputbox_topright_adver2})));$($opts.comBord).addClass("opinion");$($opts.logOut).unbind("click").bind("click",function(){jQuery.CommentLogin.doLogout()});$.fn.commMain.commJifen.getUserInfo();$.fn.commMain.commJifen.getUpgradeInfo();$($opts.reLink).html($.fn.commMain.ParseTpl($opts.$comm_setInfo,$.extend($opts.pp,{setUrl:$opts.$setUrl})));if($opts.pp.icon.indexOf("nobody.gif")==-1){$($opts.reLink).find(".setPic").remove()}else{$($opts.reLink).find(".setPic").show()}if($opts.pp.userId.indexOf("sohuh")==-1){$($opts.reLink).find(".setPass").remove();$($opts.nameInfo).find(".set-nickname").hide()}else{}if($opts.showList){$("#SOHUcomment .comList .box").relation();if($opts.pageList){$("#recommend_follower .box").relation("recommend")}}$(document).trigger("moneyLoaded");$(document).trigger("commentLoaded");if($("#container .user-info").length>0){$("#container .user-info .info-box").show();$("#container .user-info h2 span").text("我的信息")}if($opts.pageList){$($opts.nameInfo).find(".comm-jifen").hide();$($opts.nameInfo).find(".newReply").hide()}else{$($opts.nameInfo).find(".comm-jifen").show();$($opts.nameInfo).find(".newReply").show()}$($opts.nameInfo).find(".set-nickname a").add($($opts.reLink).find(".setPass")).click(function(){var password=$opts.pp.userId.substr(4,8);var data={extend:{nickname:escape($opts.pp.nick),passport:escape($opts.pp.userId),password:password,seq:password},msg:"execute success",status:0};$.CommentLogin.commnetDialog();$.CommentLogin.commnetDialogPosition();$.CommentLogin.commentTalkSuccess(data);$("#diglog_wrapper .talk-success-content .talk-title").html('<span class="login-icon talk-set-nick"></span>修改密码或昵称！');$.CommentLogin.commentSetPassStatus();return false});if($("#diglog_wrapper .quick-talk-success--wrapper").length==0){$.regMonitor("normalloginsuccess")}pub.setCommUser();return};pub.submit=function(){$("#diglog_wrapper").show();var $opts=$.fn.commMain.defaults;var mytopicUrlData="http://"+$opts.host+"/static/cmt_user_topic_allcomment/"+$opts.pp.base64+"/"+$opts.topicId+"/1/2/";if(!window.cmt_user_topic_allcomment||!window.cmt_user_topic_allcomment.commentList.length){$.getScript(mytopicUrlData,function(){window.cmt_user_topic_allcomment=eval(cmt_user_topic_allcomment)||null;SohuComment.GetModule("commList").preLoad(window.cmt_user_topic_allcomment,"mine",false);SohuComment.login();if($("#diglog_wrapper:visible").length==0){var cntBtn="#contentA .control .btn ",$cntQikBtn=$(cntBtn+".review-btn"),$cntQikLay=$(cntBtn+".review-layer");var result=location.href.toString().match(/^http\:\/\/([a-z\.]+)\/[a-z0-9\.\/]+/);if($cntQikLay.length>0){window.setTimeout(function(){$cntQikLay.hide("fast");$cntQikLay.children("textarea").blur();$cntQikLay.children("input").blur();$(cntBtn).children("span").blur();$cntQikBtn.removeClass("review-btn-clk");window.setTimeout(function(){var $isay=$("#SOHUcomment .i-say-scope-cont");var top=$isay.offset().top-30;$("body,html").animate({scrollTop:top},1000)},2000)},1000)}else{if(result!=null&&result[1]!=="pinglun.sohu.com"){var theUrl="http://pinglun.sohu.com/s"+$opts.topicId+".html";window.setTimeout(function(){if(location.href!=theUrl){location.href=theUrl}},2000)}}}try{if($opts.submitarr&&$opts.submitarr.me){$($opts.submitarr.me).trigger("click")}}catch(e){}},{cache:true})}return};pub.Init=function(opts){var defaultLayout={width:0,hideUserIcon:false,hideUserInfo:false,hideFace:false,hidePK:false,hideComShare:false,simpleTemplet:false};var opts=opts||{};opts.dhost=opts.host||"comment4.news.sohu.com";opts.host=opts.dhost.toUpperCase();opts.fhost="http://comment.news.sohu.com/upload/comment4_1/";opts.showList=opts.showList==undefined?true:opts.showList;opts.pageList=opts.pageList==undefined?false:opts.pageList;opts.editor=opts.editor==undefined?true:opts.editor;opts.qingComm=opts.qingComm==undefined?false:opts.qingComm;opts.simpleMode=opts.simpleMode==undefined?false:opts.simpleMode;opts.floorList=opts.floorList==undefined?false:opts.floorList;opts.loading=opts.loading==undefined?-1:opts.loading;opts.urlChange=opts.urlChange==undefined?true:opts.urlChange;opts.backTop=opts.backTop==undefined?false:opts.backTop;opts.showFace=opts.showFace==undefined?true:opts.showFace;opts.forbidFace=opts.forbidFace==undefined?true:opts.forbidFace;opts.jumpCommentPage=opts.jumpCommentPage==undefined?true:opts.jumpCommentPage;opts.onAfterDataShow=opts.onAfterDataShow;opts.$inputbox_topright_adver2=opts.$inputbox_topright_adver2||$.fn.commMain.defaults.$inputbox_topright_adver2;opts.layout=$.extend(defaultLayout,opts.layout);if(opts.openSharedQuanzi==undefined){opts.openSharedQuanzi=(function(){var hostAry=["arts.cul","fund","money","cul","book","baobao","business","stock"];var regx=new RegExp("^"+hostAry.join("|")+".sohu.com$","i");if(regx.test(window.location.host)){return true}if($(".location a:eq(2)").attr("href")){var host=$(".location a:eq(2)").attr("href").replace("http://","");host=host.substring(0,host.indexOf("/"));return regx.test(host)}})()}opts.canShareToQuanzi=(function(){var hostAry=["arts.cul","fund","money","cul","book","baobao","business","stock"];var regx=new RegExp("^"+hostAry.join("|")+".sohu.com$","i");if(regx.test(window.location.host)){return true}if($(".location a:eq(2)").attr("href")){var host=$(".location a:eq(2)").attr("href").replace("http://","");host=host.substring(0,host.indexOf("/"));return regx.test(host)}})();this.opts.urlChange=opts.urlChange;if(opts.simpleMode){opts.showList=false;opts.pageList=false;opts.frameWidth=opts.frameWidth==undefined?500:opts.frameWidth;if(opts.frameWidth<100){opts.frameWidth=100}}var faceUrl="http://"+opts.host+"/direct/topic/image/"+opts.topicId;var serverChecked=false;$.ajax({type:"get",url:faceUrl,async:true,dataType:"script",success:function(){if(topicImage){$.fn.commMain.defaults.openImage=opts.openImage=topicImage?parseInt(topicImage.status):-1;if(topicImage.frame_text&&topicImage.frame_text.length>1){$.fn.commMain.defaults.comm_textAD=opts.comm_textAD=topicImage.frame_text}}serverChecked=true}});if(!opts.floorList){opts.tab_file="topicp_all_"+opts.topicId;opts.tab_file_n="topic_all_"+opts.topicId}else{opts.tab_file="floorp_all_"+opts.topicId;opts.tab_file_n="floor_all_"+opts.topicId}if(opts.floorList){$("#commentTab").after("<div class='before_loading'></div>")}var tab_url="http://"+opts.host+"/static/cmt_"+opts.tab_file+"_1_30.json";var _t=this,init=function(){$.getScript(opts.fhost+"javascript/comm.login.v2013040210.js",function(){if($.cookie("ppinf")){SohuComment.commentGetUserInfo(opts);return}else{if(serverChecked){_t.Onload(opts)}else{setTimeout(function(){_t.Onload(opts)},100)}}});return};if(opts.pretendShow){var userId=PassportSC.cookieHandle();userId=$.fn.commMain.Base64Replace(Base64.encode(userId));var temp_url="http://"+opts.host+"/static/cmt_tmp_"+opts.topicId+"_"+userId+".json";$.getScript(temp_url,function(){})}$.getScript(tab_url,function(){var theFile={allCount:0,valueCount:0};if(window[opts.tab_file_n]){theFile=eval(opts.tab_file_n)}if(!opts.floorList){$("#commentTab li").eq(1).find("span.f12").html('(<span class="red">'+theFile.allCount+"</span>人参与)")}else{$("#commentTab li").eq(1).find("span.f12").html('(<span class="red">'+theFile.allCount+'</span>人参与/<span class="red">'+theFile.valueCount+"</span>条评论)")}});var commCss,commCss_Default="comment2.v2013032608.css",commCss_pic="comment2.pic.v2013032608.css",commCss_medal="medal.v2012052801.css";if(!opts.picComm){commCss=commCss_Default}else{commCss=commCss_pic}$.getCss(opts.fhost+commCss);$.getCss(opts.fhost+commCss_medal);$.getScript(opts.fhost+"javascript/comm.emote.v2012120713.js",function(){if(!window.PassportSC){$.getScript("http://js.sohu.com/library/passport.min.js",function(){if(!window.Base64){$.getScript("http://js.sohu.com/library/base64.min.js",function(){init()})}else{init()}})}else{if(!window.Base64){$.getScript("http://js.sohu.com/library/base64.min.js",function(){init()})}else{init()}}})};pub.Onload=function(opts){login=$.cookie("ppinf")?true:false;$.extend(opts,{pp:SohuComment.userInfo,login:login});for(var m in p.modules){if(p.modules[m]&&p.modules[m].Init){p.modules[m].Init(opts)}}$(document).ready(function(){for(var m in p.modules){if(p.modules[m]&&p.modules[m].OnLoad){p.modules[m].OnLoad(p)}}var result=location.href.toString().match(/^http\:\/\/([a-z\.]+)\/s[0-9\.\/]+\.html/);if(result!=null&&result[1]==="pinglun.sohu.com"&&!$.cookie("ppinf")&&!$.cookie("facetoshow")){if(opts.forbidFace){$.regMonitor("forceface2show");$.fn.commForceFace.handle.init()}}if(window.BeginStaticTime){var date=new Date();if(date.getTime()%10000===0){var m=date.getTime()-window.BeginStaticTime;var url="http://pv.mini.sohu.com/cmt.js?type=opentime&time="+m;$.getScript(url)}window.BeginStaticTime=null}});pub.setCommUser()};pub.AddModule=function(key,module){if(p.modules[key]){alert("模块"+key+"已经存在！");return}p.modules[key]=module};pub.GetModule=function(key){return p.modules[key]};pub.setUserName=function(){if($.cookie("usr_name")!=null){return}var _userAccess=$.cookie("client_ip");if(_userAccess==null){return}var _numArry=_userAccess.split(".");$.each(_numArry,function(i,n){if(n==0){_numArry[i]="1"}});var _userName=hex_md5((parseInt(_numArry[0])+parseInt(_numArry[1])-parseInt(_numArry[2])*parseInt(_numArry[3])).toString());var expdate=new Date();expdate.setTime(expdate.getTime()+1000*60*10);$.cookie("usr_name",_userName,{expires:expdate,path:"/",domain:"sohu.com",secure:false})};pub.setCommUser=function(){if(PassportCardList.length==0&&!$.cookie("ppinf")&&!$.cookie("cusr")){return false}var self=this,defaultValue="",userID,commUser=$.cookie("cusr"),expdate=new Date(),cdate="";if($.cookie("ppinf")){userID=PassportSC.cookieHandle()}else{if(PassportCardList.length>0){userID=PassportCardList[0].emailPostfix[0]}}if(commUser&&(typeof userID!="undefined"&&userID.indexOf("@")==-1)){userID=commUser.split("|")[1]}if(typeof(userID)=="string"&&userID.indexOf("@")>-1){if(userID.indexOf("sohuh")>-1&&commUser!=null){self.checkCommUser(userID)}else{if(userID.indexOf("sohuh")>-1&&commUser==null){expdate.setTime(expdate.getTime()+1000*60*60*24*365);cdate=Date.parse(expdate);$.cookie("cusr",cdate+"|"+userID,{expires:expdate,path:"/",domain:"sohu.com",secure:false});self.checkCommUser(userID)}}}else{if(commUser==null||!userID||userID.indexOf("sohuh")==-1){return}self.checkCommUser(userID)}};pub.checkCommUser=function(userID){var self=this,$opts=$.fn.commMain.defaults,overdueTime=$.cookie("lastdomain")!=null?$.cookie("lastdomain").split("|")[0]:null,passport=userID.substr(0,userID.indexOf("@")),password=passport.substr(4);var updataPassStatusUrl="http://comment4.news.sohu.com/direct/pwmod";$.ajax({type:"GET",url:updataPassStatusUrl,dataType:"script",cache:false,scriptCharset:"gbk",data:{passport:passport},success:function(data){if(typeof userpwmod!="object"){$($opts.reLink).find(".setPass").show();if(overdueTime!=null){checkUsr()}else{$.CommentLogin.commnetLoginInit(SohuComment.login);$("#diglog_wrapper #email").val(userID);$("#diglog_wrapper #password").val(password);$("#diglog_wrapper .btn-login").submit();self.commInfo(password)}}else{userpwmod=undefined}}});function checkUsr(){var date=new Date(),ndate=new Date();date.setTime(0);date.setMilliseconds(overdueTime+"000");var dayStr=new Date(date.getFullYear(),date.getMonth(),date.getDate());var daynStr=new Date(ndate.getFullYear(),ndate.getMonth(),ndate.getDate());var datas=parseInt(Math.abs(dayStr-daynStr)/1000/60/60/24);if(dayStr-daynStr>0&&datas<=4){self.commInfo(password)}else{if(dayStr-daynStr<0){self.commInfo(password)}else{}}}};pub.commInfo=function(ppword){if(!$.cookie("ppinf")){return false}var $opts=$.fn.commMain.defaults,thisUrl=window.location;var qtalkInfo=$.fn.commMain.ParseTpl($opts.$comm_qtalk_info,$.extend({},{password:ppword,thisUrl:thisUrl}));$($opts.reLink).append(qtalkInfo);$($opts.comPromptClose).click(function(){$($opts.comPromptBox).remove()})};pub.upDataUsrInfo=function(data){var $opts=$.fn.commMain.defaults;$.extend(pub.userInfo,{nick:data.nick});$($opts.name).find("a").attr("nick",data.nick).html(data.nick)};pub.loadPageTime=new Date().getTime();window.SohuComment=pub})(jQuery);(function(a){a.fn.extend({sequences:function(c){var d=this,b=c}})})(jQuery);(function(a){SohuComment.AddModule("commMain",{Init:function(d){var e=this,b=0;this.opt=d;if(!d.topicId){return false}a("#SOHUcomment").commMain(a.extend(e.opt,{modelName:"Model",pp:SohuComment.userInfo}));if(d.layout){var c={};if(d.layout.width){a("#SOHUcomment").width(d.layout.width);c={".comment .comList .box .r":"width:"+(d.layout.width-58)+"px",".comment .remark":"width:"+(d.layout.width-18)+"px",".comment .remark .r":"width:"+(d.layout.width-88)+"px",".comment .remark .r":"width:"+(d.layout.width-80)+"px",".comment .remark .form .comInput .comBord":"width:"+(d.layout.width-95)+'px; background:url("http://comment.news.sohu.com/upload/comment4_1/images/bg02.gif") no-repeat scroll '+(d.layout.width-300)+"px 36px #FFFFFF;",".comment .comList .comSubList":"width:"+(d.layout.width-50)+"px",".comment .comList .comSubList .box .r":"width:"+(d.layout.width-95)+"px",".comment .comList .comSubList .subRemark .ta, .comment .comList .comSubList .subRemark .ta":"width:"+(d.layout.width-110)+"px"}}if(d.layout.hideUserInfo){c[".comment .remark .nameInfo"]="display:none";c[".comment .remark"]=c[".comment .remark"]?(c[".comment .remark"]+";min-height:122px"):"min-height:122px;"}if(d.layout.hideUserIcon){c[".comment .remark .l"]="display:none";c[".comment .remark .form .comInput .jiao"]="display:none";if(d.layout.width){c[".comment .remark .r"]="width:"+(d.layout.width-24)+"px";c[".comment .remark .form .comInput .comBord"]="width:"+(d.layout.width-35)+'px; background:url("http://comment.news.sohu.com/upload/comment4_1/images/bg02.gif") no-repeat scroll '+(d.layout.width-240)+"px 36px #FFFFFF;"}}if(d.layout.hideFace){c[".comment .comFun .face"]="display:none"}if(d.layout.hidePK){c[".comment .comFun li.pk"]="display:none"}a.addStyle(c)}},OnLoad:function(b){}})})(jQuery);(function($){SohuComment.AddModule("commList",{Init:function(opts){var _i=this;if(!opts.topicId){return false}opts.type=opts.type||"all";if(!opts.floorList){opts.files="topic_"+opts.type+"_"+opts.topicId;opts.files_n="topicp_"+opts.type+"_"+opts.topicId}else{opts.files="floor_"+opts.type+"_"+opts.topicId;opts.files_n="floorp_"+opts.type+"_"+opts.topicId}var temp_file="topic_tmp_"+opts.topicId;if(opts.pageList){opts.pages=$.extend({pageNo:1,pageSize:30},opts.pages);opts.uri="dynamic";opts.prame=$.fn.commMain.ParseTpl("?pageNo={{#pageNo}}&pageSize={{#pageSize}}",opts.pages);opts.topicUrl=opts.topicUrl||"http://{{#host}}/{{#uri}}/cmt_{{#files}}.json{{#prame}}"}else{opts.pages=$.extend({pageNo:1,pageSize:30},opts.pages);opts.uri="static";opts.prame="";opts.topicUrl=opts.topicUrl||"http://{{#host}}/{{#uri}}/cmt_{{#files_n}}_1_30.json{{#prame}}"}opts.mytopicUrlData="http://"+opts.host+"/static/cmt_user_topic_allcomment/"+opts.pp.base64+"/"+opts.topicId+"/1/3/";if(opts.type=="mine"){opts.topicUrlData="http://"+opts.host+"/static/cmt_user_topic_allcomment/"+opts.pp.base64+"/"+opts.topicId+"/"+opts.pages.pageNo+"/"+opts.pages.pageSize+"/";opts.files="cmt_user_topic_allcomment"}else{opts.topicUrlData=$.fn.commMain.ParseTpl(opts.topicUrl,opts)}this.opt=opts;var returnDataTmp={};if(window[temp_file]!=undefined){returnDataTmp=window[temp_file];for(var i=0;i<returnDataTmp.commentList.length;i++){returnDataTmp.commentList[i].createTime=new Date().getTime()}}if(window[opts.files]&&window[opts.files].allCount==0){opts.pages.pageNo=0}if(!window.cmt_user_topic_allcomment&&opts.showList&&opts.login&&typeof opts.pp.base64!=="undefined"){$.getScript(opts.mytopicUrlData,function(){window.cmt_user_topic_allcomment=eval(cmt_user_topic_allcomment)||null;_i.preLoad(window.cmt_user_topic_allcomment,"mine")},{cache:true})}if(window[opts.files]&&window[opts.files].pageNumber==opts.pages.pageNo){var returns={};var returnDate=$.extend(true,returns,window[opts.files]);if(returnDataTmp.commentList!=undefined){returnDate.commentList=returnDataTmp.commentList.concat(returnDate.commentList)}_i.preLoad(returnDate);if(opts.onAfterDataShow&&typeof(opts.onAfterDataShow)==="function"){opts.onAfterDataShow(returnDate)}}else{$($.fn.commMain.defaults.comList).before($.fn.commMain.defaults.$commLoading);if(opts.loadingNum==undefined||opts.loadingNum<1){}var tempDD={};var tempData=$.extend(true,tempDD,window[opts.files]);$.getScript(opts.topicUrlData,function(){window[opts.files]=eval(opts.files)||null;var returns={};var returnDate=$.extend(true,returns,window[opts.files]);if(returnDataTmp.commentList!=undefined){returnDate.commentList=returnDataTmp.commentList.concat(returnDate.commentList)}_i.preLoad(returnDate);if(opts.onAfterDataShow&&typeof(opts.onAfterDataShow)==="function"){opts.onAfterDataShow(returnDate)}},{cache:true})}},OnLoad:function(p){},preLoad:function(d,belong,urlCg){var _i=this,opts=_i.opt,load=function(r){var relation=eval(r)||{};if(belong&&belong=="mine"){_i.opt.urlChange=urlCg;$("#SOHUcomment").commMain($.extend(_i.opt,{modelName:"MyModelList",relation:relation,myData:d}));return}$("#SOHUcomment").commMain($.extend(_i.opt,{modelName:"ModelList",relation:relation,data:d}));var $valueCount=$.fn.commMain.defaults.$valueCount;var $subjectValueCount=$.fn.commMain.defaults.$subjectValueCount;var $valueCountTitle=$.fn.commMain.defaults.$valueCountTitle;var valueCountHtml=$.fn.commMain.ParseTpl($valueCount,$.extend({},opts.data));var subjectValueCountHtml=(opts.data.mode!=-1&&opts.data.subjectId!=undefined)?$.fn.commMain.ParseTpl($subjectValueCount,$.extend({},opts.data)):"";var $valueCountTitleHtml=$.fn.commMain.ParseTpl($valueCountTitle,$.extend({titleright_adver:$.fn.commMain.defaults.$titleright_adver},opts.data));if(opts.qingComm){$("#SOHUcommentTitle").html($valueCountTitleHtml);if($("#headers .timeTag .commentTag span.red").length>0){$("#headers .timeTag .commentTag span.red").text(opts.data.allCount)}}if(!opts.pageList){if($("#commentTab li").length==1){$("#commentTab li").eq(0).after(valueCountHtml)}if($("#SOHUcomment .reTitle").length==0&&!opts.simpleMode){$("#SOHUcomment").prepend($valueCountTitleHtml)}}else{if(opts.editor&&$("#commentTab").length>0){$("#commentTab li").eq(2).remove()}else{if(!opts.editor&&$("#contentA .label").length>0){$("#commentTab  li").eq(1).find("span").remove();$("#commentTab li").eq(2).remove()}}}if(opts.picComm){$("#commentLink a").eq(0).attr("href","http://pinglun.sohu.com/s"+opts.topicId+".html");$("#commentLink #commA").text(opts.data.allCount)}if(opts.layout&&opts.layout.hideComShare){$(".comment .comShare").remove()}if(opts.openSharedQuanzi){$.fn.shareToQuanzi.GetSharedAdver(opts.topicId,function(str){if($("#SOHUcomment").find(".titleright_adver").length>0){$("#SOHUcomment").find(".titleright_adver").html("|"+str)}else{if($("#commentTab .ad").length>0&&/^\n*$/.test($("#commentTab .ad").html())){$("#commentTab .ad").html(str)}}})}};load({})}})})(jQuery);(function(a){a.fn.floorHtml=function(j,n){var p=a(this),q=a.fn.commMain.defaults,b=p.$layout,o="",g,h=0,f="";var e=0,m;var c="",l="";var d,k;h=n.length;function i(w){var B="",C="",z="",A="",r=/http:\/\/comment.news.sohu.com\/upload\/comment4_1\/images\/face\/face_\d{2}\.gif/,y=/\[[^\[\]]+\]/g,t="",v="",u="http://comment.news.sohu.com/upload/comment4_1/images/face_0606/",x={"[:D!]":["face_01_s.gif","开心"],"[):(!]":["face_02_s.gif","愤怒"],"[:^!]":["face_03_s.gif","鄙视"],"[:v!]":["face_04_s.gif","给力"],"[:_(!]":["face_05_s.gif","难过"],"[:x!]":["face_06_s.gif","无语"],"[S_G!]":["face_07_s.gif","Strong"],"[U_L!]":["face_08_s.gif","不喜欢"],"[djy!]":["face_09_s.gif","打酱油"],"[G_Z!]":["face_10_s.gif","鼓掌"],"[L_H!]":["face_11_s.gif","流汗"],"[G_M!]":["face_12_s.gif","计划购买"],"[J_Y!]":["face_13_s.gif","加油"],"[S_M!]":["face_14_s.gif","色迷迷"],"[W_S!]":["face_15_s.gif","握手"],"[X_H!]":["face_16_s.gif","喜欢"],"[flo!]":["face_17_s.gif","鲜花"],"[J_J!]":["face_18_s.gif","祭酒"],"[Q_F!]":["face_19_s.gif","祈福"],"[X_flo!]":["face_20_s.gif","献花"],"[S_X!]":["face_21_s.gif","上香"],"[B_M!]":["face_22_s.gif","闭嘴"],"[G_D!]":["face_23_s.gif","感动"],"[J_Ya!]":["face_24_s.gif","惊讶"],"[K_L!]":["face_25_s.gif","可怜"],"[K_B!]":["face_26_s.gif","恐怖"],"[Q_D!]":["face_27_s.gif","期待"],"[S_K!]":["face_28_s.gif","思考"],"[C_K!]":["face_29_s.gif","抓狂"]};if(r.test(w)){C=w.substr(0,w.indexOf("face_"));z=w.substr(w.indexOf("face_"),7);B='<img src="'+C+z+'_s.gif" alt="" />'}else{if(y.test(w)){v=w.match(y,"").toString();B=w.replace(y,'<img src="'+u+x[v][0]+'" alt="'+x[v][1]+'" title="'+x[v][1]+'" />')}}return B}a.each(n,function(r){var v="",w=0;if(n[r].debate){if(n[r].title){n[r].content=n[r].title}f=a.fn.commMain.ParseTpl(q.$debateCode,{debateUrl:q.lhost+q.topicId+"/d"+n[r].commentId+".html",detateTarget:' target="_blank"',detateText:q.debatePart})}else{f=""}if(n[r].location!=""&&n[r].location!=undefined){d="<em class='net-location'>"+n[r].location+"</em>"}else{if(n[r].iploc!=""&&n[r].iploc!=undefined){d="<em class='net-f'>["+n[r].iploc+"]</em>"}else{d=""}}if(n[r].phone!=""&&n[r].phone!=undefined&&n[r].phone!="spider"){k="<em class='sj'>"+n[r].phone+"</em>"}else{k=""}if(n[r].exp&&n[r].exp.currentRank){var t=n[r].exp.currentRank.code;var u=unescape(n[r].exp.currentRank.task.name);w=t<10?"0"+t:t;v=a.fn.commMain.ParseTpl(q.$comm_level,{level:w,code:t,levelMedalName:u})}if(n[r].from==7){n[r].content=i(unescape(n[r].content))}g=a.fn.commMain.ParseTpl(q.thecode.commModel.floorListModel,a.extend(true,{},n[r],{debateCode:f,commentId:n[r].commentId,num:r+1,floorNum:r,commLevel:v,iploc:d,phone:k}),true);if(h<=15){g=a(g).prepend(o);o=a(g)}else{if(r<10){g=a(g).prepend(o);o=a(g)}else{if(r>=h-5){if(c.length==0){c=a("<div></div>").append(o,l);g=c.html()}else{g=a(g).prepend(o)}o=a(g)}else{g=g.replace("floor-bord","floor-bord-noup floor-bord");if(l.length==0){l=a('<div class="floor-bord-noup-wrapper"></div>').prepend(g)}else{l.append(g)}}}}});j.find("h4").after(q.$floorWrapper);j.find(".comm-floor-wrapper").append(g);return j}})(jQuery);(function($){$.fn.reply=function($layout,cId){var _t=this,$opts=$.fn.commMain.defaults,$layout=$layout,commentId=$layout.closest(".box").attr("data-commentid");var _ReplayModel;var inputKey=function(e){var e=window.event||e,keyCode=e.keyCode||e.which;var _t=this;var _len=$.fn.commMain.len($.trim($(_t).val()));var _max=($opts.maxInput);var commentValue=$layout.find("textarea").val();if(_len>_max){$layout.find(".erInfo").html($.fn.commMain.ParseTpl($opts.$MaxInputTxt,{maxInputLen:_len-_max})).attr("errlen",_len-_max).show()}else{if(commentValue==""&&commentValue.replace(/\s/g,"").length==0){$layout.find(".erInfo").html($opts.required).show();return}else{$layout.find(".erInfo").html("Ctrl+Enter快捷提交").attr("errlen",0);$layout.find(".btn").unbind("click").bind("click",$.fn.commMain.replysubmit)}}if(e.ctrlKey&&keyCode==13){$.fn.commMain.replysubmit.call($layout.find(".btn"))}};_t.unbind("click").bind("click",function(){if($(this).hasClass("clicked")){$layout.html("").hide();$(this).removeClass("clicked");return true}else{var replayWrapper=$(this).closest(".box").find(".comm-floor-replay:visible");var lastReply=$(this).closest(".box").find(".comSubList:visible");if(replayWrapper.length>0){replayWrapper.hide();replayWrapper.siblings("h5").find("span.feed-set > a").eq(1).removeClass("clicked")}if(lastReply.length>0){lastReply.hide();lastReply.siblings(".r").find("h5:last span.feed-set > a").eq(1).removeClass("clicked")}$(this).addClass("clicked");$layout.show()}_ReplayModel=$(this).closest(".comm-floor-wrapper").length==0?$opts.thecode.commModel.SubListModel:$opts.thecode.commModel.floorReplayModel;$layout.html($.fn.commMain.ParseTpl(_ReplayModel,$.extend({},{login_replyPic:$opts.$login_replyPic},$opts.pp)));$layout.parents(".box").attr("data-replyid",$layout.parents(".box,.floor-bord,.floor-bord-noup").attr("data-commentid"));if($layout.hasClass("comSubList")){$layout.parents(".box").removeAttr("data-floorNum")}else{$layout.parents(".box").attr("data-floorNum",$layout.parents(".floor-bord,.floor-bord-noup").attr("data-floorNum"))}$layout.find("textarea").focus();$layout.find(".comShare").show();$.fn.commMain.bindemote($layout.find(".face > a"),$layout.find("textarea"));$layout.find("textarea").bind("blur",inputKey).bind("keyup",inputKey).bind("paste",inputKey).bind("cut",inputKey);$layout.find(".btn").bind("click",$.fn.commMain.replysubmit);if($opts.floorList){return true}$opts.replyUrl=$opts.replyUrl||"http://{{#host}}/dynamic/cmt_reply_{{#commentId}}.json?pageNo=1&pageSize=10";$.getScript($.fn.commMain.ParseTpl($opts.replyUrl,$.extend({},$opts,{commentId:commentId})),function(r){var result=eval("reply_"+commentId),s=new $.Buffers(),$opts=$.fn.commMain.defaults;var d=result.replies;var iploc,phone;if(result.totalNumber>0){$layout.append($.fn.commMain.ParseTpl($opts.$replyNum,{replyUrl:$opts.$replyUrl,replyNumber:result.totalNumber}));$.each(d,function(i){var userReplyFrom=d[i].from;var passport=d[i].passport;d[i].createTime=$.fn.commMain.time.friendly(d[i].createTime);d[i].from=$.fn.commMain.from(d[i].from);d[i].authorimg=d[i].authorimg==""?$opts.$icon:d[i].authorimg;d[i].baseid=$.fn.commMain.base64(unescape(d[i].passport));if(d[i].location!=""&&d[i].location!=undefined){d[i].iploc="<em class='net-location'>"+d[i].location+"</em>"}else{if(d[i].iploc!=""&&d[i].iploc!=undefined){d[i].iploc="<em class='net-f'>["+d[i].iploc+"]</em>"}else{d[i].iploc=""}}if(d[i].phone!=""&&d[i].phone!=undefined&&d[i].phone!="spider"){d[i].phone="<em class='sj'>"+d[i].phone+"</em>"}else{d[i].phone=""}if(!passport){s.append($.fn.commMain.ParseTpl($opts.thecode.commModel.subListMobile,$.extend(true,{},d[i]),true))}else{s.append($.fn.commMain.ParseTpl($opts.thecode.commModel.subList,$.extend(true,{},d[i]),true))}});$layout.find(".comSubFull").before(s.toString());$layout.find(".box h5").each(function(){var topicId=$opts.topicId,replyid=$(this).closest(".box").attr("data-replyid"),$commlist=$(this).closest(".box").find(".comSubList");$(this).find("a").eq(0).agree(replyid,topicId);$(this).find("a").eq(1).bind("click",function(){if($("html,body").scrollTop()>($layout.find("textarea").offset().top-260)){$("html,body").animate({scrollTop:$layout.find("textarea").offset().top-260},100)}$layout.find("textarea").focus();$layout.find("textarea").val("回复 "+$(this).parent().parent().children("h4").text()+":");$layout.parents(".box").attr("data-replyid",$(this).parent().parent().parent().attr("data-replyid"))})})}},{parameter:["reply_"+commentId],cache:false});return true})}})(jQuery);(function($){$.fn.relation=function(obj){var $layout=$(this),$opts=$.fn.commMain.defaults;if($.cookie("ppinf")&&$layout.length>0){var followers=[];if(typeof obj=="undefined"){$.each($opts.data.commentList,function(i){if($.inArray($opts.data.commentList[i].passport,followers)==-1){followers.push($opts.data.commentList[i].passport)}})}else{$.each($layout,function(i){if($.inArray($($layout[i]).attr("passport"),followers)==-1){followers.push($($layout[i]).attr("passport"))}})}function getRelation(){$.getScript($.fn.commMain.ParseTpl($opts.relationUrl,$.extend({},$opts,{pp_base64:$opts.pp?$opts.pp.base64:undefined})),function(){$.extend($opts,{relation:eval(returnRelation)||{}});var result=returnRelation.relation||{};$layout.each(function(i){var r=result[$(this).attr("data-baseid")];r=r==undefined?0:r;if($opts.pp.base64==$(this).attr("data-baseid")){r=1}if(r!=1){$(this).find(".fun").html('<a attr="0" href="javascript:void(0)" class="bA follow">留言</a>').find(".follow").each(function(){$(this).leaveMsg($(this).closest(".box").attr("data-baseid"))})}})},true)}$opts.relationUrl="http://{{#host}}/direct/cmt_relation_{{#pp_base64}}.json?fassports="+followers;if(!$opts.pp){var trytimes=0;var interval=setInterval(function(){trytimes++;if(trytimes>5){clearInterval(interval)}if(!$opts.pp){return}getRelation();clearInterval(interval)},200)}else{getRelation()}}return}})(jQuery);(function($){$.fn.agree=function(cId,tId){var _t=$(this),$opts=$.fn.commMain.defaults;if(!!!cId&&!!!tId){return}_t.append($("<span>",{css:{font:"600 30px/34px '黑体'",color:"#c00",position:"absolute",display:"none",top:-20,left:10},text:"+1",className:"float"})).click(function(){return false}).one("click",function(){$opts.dingUrl=$opts.dingUrl||"http://{{#host}}/post/simple_up?commentId={{#cId}}&topicId={{#topicId}}";$.getScript($.fn.commMain.ParseTpl($opts.dingUrl,$.extend({},$opts,{cId:cId})),function(r){r=eval("simpleUpResult");if(!!r.status&&r.status==1){_t.css("position","relative");_t.siblings("font").children("em").text(parseInt(_t.siblings("font").children("em").text())+1);_t.css({color:"#999","text-decoration":"none"});_t.find("> span").css("display","block").animate({top:[-50,"swing"]},300,function(){$(this).fadeOut(300,function(){_t.css("position","static")})})}return},{parameter:["simpleUpResult"],cache:true});return false})}})(jQuery);(function(a){a.fn.leaveMsg=function(c){var h=a(this),i=a.fn.commMain.defaults;if(!!!c){return}var g="",e="",b=406,f=window.innerWidth?window.innerWidth:document.documentElement.clientWidth;var j=function(){var k=new a.Buffers();k.append('<div class="diglog-wrapper message-wrapper" style="position:absolute;">');k.append('<div class="message-tit"><span class="login-icon pannel-close"></span><span class="tit-cont">给<strong></strong>留言</span></div>');k.append('<div class="message-cont">');k.append('	<div class="txt-border">');k.append('		<textarea rows="10" cols="30" id="" name=""></textarea>');k.append("	</div>");k.append('	<div class="message-num-btn clear">');k.append('		<span class="message-num-text">验证码</span>');k.append('		<div class="message-num-input"><input type="text" class="" name=""></div>');k.append('		<div class="message-num-img"><img width="70" height="18" alt="" src=""></div>');k.append('		<span class="message-num-img-next"><a href="javascript:void(0);">看不清</a></span><span class="error_msg"></span>');k.append('		<div class="message-btn"><a href="javascript:void(0);">留言</a></div>');k.append("	</div>");k.append("	</div>");k.append('<div class="msg-succeed"><div class="close-btn"><span class="login-icon pannel-close"></span>'),k.append('</div><div class="msg-succeed-name"><span>给<strong></strong>的留言已发送！</span></div>'),k.append('<div class="msg-succeed-close-btn"><a href="javascript:void(0);">关闭</a></div></div>'),k.append("</div>");return k.toString()}();var d=function(k){a.ajax({type:"get",url:"http://i.sohu.com/a/guestbook/vcode.htm?callback=?",dataType:"jsonp",cache:false,success:function(l){g=l.vcode;k.attr("src","http://i.sohu.com/a/guestbook/rand.htm?vcode="+g);k.attr("vcode",g)}})};h.bind("click",function(){if(h.closest(".box").find(".pic a img").length){var p=h.closest(".box").find(".pic a img").attr("alt")}else{var p=h.closest(".box").find(".r span:eq(0) a").html()}if(a(".message-wrapper").length>0){var n=a(".message-wrapper .message-num-btn .message-num-img img");var v=a(".message-wrapper");v.show();v.attr("base",c);v.find(".error_msg").html("");v.find(".txt-border textarea").val("");v.find(".message-num-btn .message-num-input input").val("");if(v.find(".msg-succeed:visible").length){v.find(".message-tit").show();v.find(".message-cont").show();v.find(".msg-succeed").hide()}}else{a("body").append(j);var v=a(".message-wrapper");var l=v.find(".message-tit .pannel-close");var m=v.find(".message-num-btn .message-num-img-next a");var o=v.find(".message-num-btn .message-btn a");var n=v.find(".message-num-btn .message-num-img img");var t=v.find(".txt-border textarea");var r=v.find(".message-num-btn .message-num-input input");var k=v.find(".error_msg");v.attr("base",c);m.click(function(){d(n);return false});r.focus(function(){k.html("")});t.focus(function(){k.html("")});var u=function(){v.hide();v.find(".message-tit").show();v.find(".message-cont").show();v.find(".msg-succeed").hide()};o.click(function(){var w=t.val();var x=r.val();var y=v.attr("base");var z=n.attr("vcode");e="http://i.sohu.com/a/guestbook/addMessage.htm?receiverPassport="+y+"&content="+w+"&usercode="+x+"&vcode="+z+"&callback=?";if(!w||w.replace(/\s/g,"").length==0){k.html("请输入留言")}else{if(w.length>200){k.html("留言超过200字")}else{if(!x){k.html("请输入验证码");return}a.ajax({type:"GET",url:e,dataType:"jsonp",success:function(A){if(A){if(A.statusText=="验证码错误。"){k.html("验证码错误");d(n)}else{t.val("");r.val("");v.find(".message-tit").hide();v.find(".message-cont").hide();v.find(".msg-succeed").show();v.find(".msg-succeed .pannel-close").click(u);v.find(".msg-succeed .msg-succeed-close-btn a").click(u)}}}})}}return false});l.click(function(){t.val("");r.val("");v.hide()})}d(n);var v=a(".message-wrapper");var q=0;if((h.position().left+b+100)>f){q=h.position().left-b-30}else{q=h.position().left+50}v.find(".message-tit .tit-cont strong").html(p);v.find(".msg-succeed .msg-succeed-name span strong").html(p);v.css({top:h.position().top-25,left:q})})}})(jQuery);(function(a){a.fn.debateFn=function(){var g=a(this),f=g.find(".pk-cont-left strong:eq(1) a"),d=g.find(".pk-cont-right strong:eq(1) a"),c=g.find(".pk-cont-center p span"),h=g.find(".pk-cont-left .pk-cont-btn input"),b=g.find(".pk-cont-right .pk-cont-btn input");h.bind("click",e);b.bind("click",e);function e(){var p=a(this);var n=true;var o=p.closest(".pk-cont-btn");var m=g.attr("topicid");var k=g.closest(".box").attr("data-commentid");var j="";var l=f.attr("href");h.unbind("click",e);b.unbind("click",e);if(p.closest(".pk-cont-left").length>0){n=true}else{n=false}if(n){f.html(parseInt(f.html())+1);j="http://comment4.news.sohu.com/post/spcomment?topicId="+m+"&commentId="+k}else{d.html(parseInt(d.html())+1);j="http://comment4.news.sohu.com/post/opcomment?topicId="+m+"&commentId="+k}c.html(parseInt(c.html())+1);h.addClass("gray");b.addClass("gray");a.getScript(j,function(){});o.append("<em class='num-up'>+1</em>");o.find(".num-up").animate({top:"-40px"},500,i);function i(q){o.find(".num-up").remove();window.location=l}}}})(jQuery);(function(a){a.fn.follows=function(b){var e=a(this),c=a.fn.commMain.defaults,d=e.attr("attr");if(!!!b){return}}})(jQuery);(function(a){a.fn.pageList=function(){var H=a(this),z=a.fn.commMain.defaults;var C=z.data.totalNumber,I=z.data.pageNumber,t=z.pages.pageSize;var m="",n="",g="",k="",K="",j="",l="",D=0;var y=0,v=0,M=0,L=0,e="",d="",c="",b="",x="",u="",w="";var J=0,G=0,F=0,B=0;var o=0;var f=z.pages.ViewNum==undefined?30:z.pages.ViewNum;m=parseInt(C%t)>0?parseInt(C/t)+1:parseInt(C/t);if(m==1){return}n=parseInt(C%t);nPages=I>1?(I-1)*t+1:1;nPagee=m-I>0?I*t:C;D=parseInt(Math.round(m/f));l=f;var r=1;var h="";var E="";o=m-I;h=I==1?"<span>1</span>":'<a href="javascript:void(0)" attr="1">1</a>';E=I==m?"<span>"+m+"</span>":'<a href="javascript:void(0)" attr="'+m+'">'+m+"</a>";if(m<8){for(var A=1;A<=m;A++){if(A==I){k+="<span>"+A+"</span>"}else{k+='<a href="javascript:void(0)" attr="'+A+'">'+A+"</a>"}}}else{if(I<=3){for(var A=1;A<=6;A++){if(A==I){k+="<span>"+A+"</span>"}else{k+='<a href="javascript:void(0)" attr="'+A+'">'+A+"</a>"}}k=k+"..."+E}else{if(m-I<=2){for(var A=m-5;A<=m;A++){if(A==I){k+="<span>"+A+"</span>"}else{k+='<a href="javascript:void(0)" attr="'+A+'">'+A+"</a>"}}k=h+"..."+k}else{y=I-1;v=I-2;M=I+1;L=I+2;e=y<=1?"":'<a href="javascript:void(0)" attr="'+y+'">'+y+"</a>";d=v<=1?"":'<a href="javascript:void(0)" attr="'+v+'">'+v+"</a>";c=M>=m?"":'<a href="javascript:void(0)" attr="'+M+'">'+M+"</a>";b=L>=m?"":'<a href="javascript:void(0)" attr="'+L+'">'+L+"</a>";x=v>2?"...":"";u=m-L>1?"...":"";w=I==1||I==m?"":"<span>"+I+"</span>";k=h+x+d+e+w+c+b+u+E}}}var q=new a.Buffers();if(m-I>0&&I==1){K=I+1;q.append(k+' <a href="javascript:void(0)" attr="'+K+'"" >下一页</a>')}else{if(m-I>0&&I>1){K=I+1;j=I-1;q.append('<a href="javascript:void(0)" attr="'+j+'">上一页</a> '+k+' <a href="javascript:void(0)" attr="'+K+'">下一页 </a>')}else{if(m-I==0&&m>1){j=I-1;q.append('<a href="javascript:void(0)" attr="'+j+'">上一页</a> '+k)}else{if(m-I==0&&m<=1){j=I-1;q.append('<span class="selected">上一页</span> '+k+' <span class="selected">下一页</span>&nbsp;')}}}}a(this).html(q.toString());a(this).find("a").each(function(){a(this).bind("click",function(){SohuComment.GetModule("commList").Init(a.extend({},z,{pages:{pageNo:a(this).attr("attr")}}));var O=document.documentElement.scrollTop||window.pageYOffset;var N=a("#SOHUcomment .comMenu:eq(0)");var i=N.position();if(O>i.top){a(document).scrollTop(i.top-40)}})});a("#SOHUcomment .allList").after('<div class="comMenu clear"></div>').next().append(a(this).clone(true))}})(jQuery);(function(a){a.follower={init:function(){var b=this;if(a.CommentLogin){if(!a.cookie("ppinf")){if(a.fn.commMain.defaults.qingComm){a("#recommend_follower .com-follow").hide()}else{a("#recommend_follower a.bA").each(function(){a(this).click(function(){a.CommentLogin.commnetLoginInit(a.follower.init)})})}}else{a("#recommend_follower .box").relation("recommend");if(a.fn.commMain.defaults.qingComm){a("#recommend_follower .com-follow").show()}}a.follower.initCard()}else{setTimeout(a.follower.init,2000);return}},findDiv:function(b){if(b.xpt){return a(document.body).find('div[data-baseid="'+b.xpt+'"]')}else{if(b.friendid){return a(document.body).find('div[data-baseid="'+b.xpt+'"]')}}return null},initCard:function(){var c=a("#recommend_follower"),b=this;if(!a.iCard){return}a(function(){b.card=new a.iCard({bindElement:c,params:{product:"scomment"},onFollow:function(e){var d=b.findDiv(e)},onUnfollow:function(f){var d=b.findDiv(f);var e=d.find("div.fun a");e.follows(e.closest(".box").attr("data-baseid"))}})})}}})(jQuery);(function(a){a.fn.backTop=function(){if(a("#back_top").length>0){return}a("body").append('<div id="back_top"><a href="javascript:void(0);" title="返回页面顶部"></a></div>');var b=a("#back_top");function d(){var e=document.documentElement.scrollWidth;if((e-1080)>0){b.css("right",(e-1080)/2+"px")}else{b.css("right","0px")}}function c(){var e=window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop;if(e>460){b.show()}else{b.hide()}}c();d();b.click(function(){window.scrollTo(0,0);return false});a(window).scroll(function(){c()});a(window).resize(function(){d()})}})(jQuery);(function(a){a.regMonitor=function(f){var b="http://comment4.news.sohu.com/stat/pingback.jsp?type="+f;var e=document.getElementsByTagName("head")[0]||document.documentElement;var d=document.createElement("script"),c=false;d.setAttribute("type","text/javascript");d.setAttribute("src",b);e.appendChild(d)}})(jQuery);(function(a){a.alertMsg=function(b){b.animate({opacity:"hide"},200,function(){b.animate({opacity:"show"},200,function(){b.animate({opacity:"hide"},200,function(){b.animate({opacity:"show"},200)})})})}})(jQuery);(function(a){a.returnRefer=function(){var b=location.href.toString().match(/^http\:\/\/([a-z\.]+)\/[a-z0-9\.\/]+/);if(b!=null&&b[1]=="pinglun.sohu.com"){return"1"}else{return"0"}}})(jQuery);(function(a){a.popEmote=function(k,g){var p="",q="",n="",o="",d=k,b=/http:\/\/comment.news.sohu.com\/upload\/comment4_1\/images\/face\/face_\d{2}\.gif/,m=/\[[^\[\]]+\]/g,c="",f="",e="http://comment.news.sohu.com/upload/comment4_1/images/face_0606/",l={"[:D!]":["face_01_s.gif","开心"],"[):(!]":["face_02_s.gif","愤怒"],"[:^!]":["face_03_s.gif","鄙视"],"[:v!]":["face_04_s.gif","给力"],"[:_(!]":["face_05_s.gif","难过"],"[:x!]":["face_06_s.gif","无语"],"[S_G!]":["face_07_s.gif","Strong"],"[U_L!]":["face_08_s.gif","不喜欢"],"[djy!]":["face_09_s.gif","打酱油"],"[G_Z!]":["face_10_s.gif","鼓掌"],"[L_H!]":["face_11_s.gif","流汗"],"[G_M!]":["face_12_s.gif","计划购买"],"[J_Y!]":["face_13_s.gif","加油"],"[S_M!]":["face_14_s.gif","色迷迷"],"[W_S!]":["face_15_s.gif","握手"],"[X_H!]":["face_16_s.gif","喜欢"],"[flo!]":["face_17_s.gif","鲜花"],"[J_J!]":["face_18_s.gif","祭酒"],"[Q_F!]":["face_19_s.gif","祈福"],"[X_flo!]":["face_20_s.gif","献花"],"[S_X!]":["face_21_s.gif","上香"],"[B_M!]":["face_22_s.gif","闭嘴"],"[G_D!]":["face_23_s.gif","感动"],"[J_Ya!]":["face_24_s.gif","惊讶"],"[K_L!]":["face_25_s.gif","可怜"],"[K_B!]":["face_26_s.gif","恐怖"],"[Q_D!]":["face_27_s.gif","期待"],"[S_K!]":["face_28_s.gif","思考"],"[C_K!]":["face_29_s.gif","抓狂"]};if(b.test(k)){q=k.substr(0,k.indexOf("face_"));n=k.substr(k.indexOf("face_"),7);p='<img src="'+q+n+'_s.gif" alt="" />'}else{if(m.test(k)){f=k.match(m,"").toString();var j=f.split(",");if(j.length>1){for(var h=0;h<j.length;h++){if(typeof l[j[h]]=="undefined"){continue}k=k.replace(j[h],'<img src="'+e+l[j[h]][0]+'" alt="'+l[j[h]][1]+'" title="'+l[j[h]][1]+'" />');d=d.replace(j[h],"")}p=k}else{if(typeof l[f]=="undefined"){return}p=k.replace(m,'<img src="'+e+l[f][0]+'" alt="'+l[f][1]+'" title="'+l[f][1]+'" />');d=d.replace(m,"")}}}if(d.replace(/\s/g,"")==""&&g){return"nocomment"}else{return p}}})(jQuery);