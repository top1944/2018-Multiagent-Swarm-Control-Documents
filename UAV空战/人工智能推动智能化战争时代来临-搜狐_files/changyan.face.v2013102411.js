(function(e,f){e.cookie=function(j,k,h){if(arguments.length>1&&String(k)!=="[object Object]"){h=e.extend({},h);if(k===null||k===undefined){h.expires=-1}if(typeof h.expires==="number"){var m=h.expires,i=h.expires=new Date();i.setDate(i.getDate()+m)}k=String(k);return(document.cookie=[encodeURIComponent(j),"=",h.raw?k:encodeURIComponent(k),h.expires?"; expires="+h.expires.toUTCString():"",h.path?"; path="+h.path:"",h.domain?"; domain="+h.domain:"",h.secure?"; secure":""].join(""))}h=k||{};var g,l=h.raw?function(n){return n}:decodeURIComponent;return(g=new RegExp("(?:^|; )"+encodeURIComponent(j)+"=([^;]*)").exec(document.cookie))?l(g[1]):null};var c=function(g,i){var h="http://comment4.news.sohu.com/direct/topic/face/"+g;e.ajax({type:"get",url:h,dataType:"script",scriptCharset:"utf-8",success:function(){i(facelist)}})};var d=function(n,h,m,l,j){var g=!!e.cookie("ppinf");if(g){if(window.voteFaceCallback){window.voteFaceCallback=null}window.ac&&window.ac.destory();var k="http://comment4.news.sohu.com/post/quickcomment";e.ajax({type:"get",data:{topicId:h,quickId:n,cmt_from:7},url:k,dataType:"script",scriptCharset:"utf-8",success:function(){e("<span>",{css:{font:"600 30px/34px '黑体'",color:"#c00",position:"absolute",display:"none",top:-20,left:35,display:"block"},text:"+1",className:"float"}).appendTo(e(j.selectDom)).animate({top:[-50,"swing"]},300,function(){e(this).fadeOut(300,function(){})});var o=e(j.selectDom).find(".num"),p=o.html();o.html(parseInt(p.substr(0,p.length-1))+1+"人");setTimeout(function(){l&&l(j.selectDesc,n,h,m)},400)}});var i="http://changyan.sohu.com/api/2/comment/quick?callback=?";e.ajax({type:"get",url:i,data:{client_id:"cyqemw6s1",topic_id:m,quick_id:n},dataType:"jsonp",scriptCharset:"utf-8",success:function(){}})}else{window.voteFaceCallback=function(){d(n,h,m,l,j)};ac=new f(window.voteFaceCallback);ac.render()}};var b=function(i){var h=i.faceList,g="",j=i.faceCount;e.each(h,function(l){var k=j[h[l].id];var m=k==undefined?0:k;g=g+'<li class="face" data_id="'+h[l].id+'" data_ubb="'+unescape(h[l].faceCode)+'" data-desc="'+unescape(h[l].desc)+'" ><div><img  src="'+unescape(h[l].url)+'"  alt="" title="'+unescape(h[l].name)+'" /></div><p class="desc">'+unescape(h[l].name)+'</p><p class="num">'+m+"人</p></li>"});g='<div class="mood-con">   <h4 class="mood-hd">您看完此新闻的心情是</h4>    <ul class="mood-bd clear">'+g+"</ul></div>";return g};var a=function(g){this.$el=e(g.el);this.topicId=g.topicId;this.afterVoteCallback=g.afterVoteCallback;this.changYanId=g.changYanId;this.events={"click .face":"click_vote"}};a.prototype={render:function(){var g=this;c(this.topicId,function(l){g.data=l;var m=l.mode;if(m==0){g.$el.append(b(facelist)).show();for(var j in g.events){var k=j.substr(j.indexOf(" ")+1);var i=j.substr(0,j.indexOf(" "));var h=i+" "+k;g.$el.find(k).attr("data-event-rel-"+i,h).bind(i,function(n){g[g.events[e(this).attr("data-event-rel-"+n.type)]].call(g,n)})}}})},vote:function(g){d(g,this.topicId,this.changYanId||SOHUCS.scs.scsUtil.getTopicID(),this.afterVoteCallback,this)},unbindClick:function(){this.$el.find(".face").unbind("click")},click_vote:function(h){if(e(".moodpop").size()>0){return false}var g=e(h.target).is(".face")?e(h.target):e(h.target).parents(".face:eq(0)");this.selectDesc=g.attr("data-desc");this.selectDom=g;this.vote(g.attr("data_id"))},destory:function(){this.$el.empty()}};window.changYanFace=a})(jQuery,freeAccountUI);(function(){var c=function(h,e,k,i,j,g){var d=!!$.cookie("ppinf");if(d){window.ac&&window.ac.destory();window.voteFaceSayMoreCallback&&delete window.voteFaceSayMoreCallback;$.getScript("http://comment4.news.sohu.com/stat/pingback.jsp?type=forcefacepost"+(g?"2":""));if(!g){$(".wrap-text-f, .textarea-fw").val(h);j();$(".single-btn-bf,.btn-bf").click()}else{var f="http://changyan.sohu.com/api/2/comment/quick?callback=?";$.ajax({type:"get",url:f,data:{client_id:"cyqemw6s1",topic_id:k,quick_id:"9"+i},dataType:"jsonp",scriptCharset:"utf-8",success:function(){window.location="http://pinglun.sohu.com/s"+e+".html"}})}}else{window.voteFaceSayMoreCallback=function(){c(id,e,j,g)};window.ac=new Ac(window.voteFaceSayMoreCallback).render()}};var b=function(d){this.$el=$(d.el);this.topicId=d.topicId;this.afterSubmitCallback=d.afterSubmitCallback;this.defaultText=d.defaultText;this.changYanId=d.changYanId;this.voteId=d.voteId;this.events={"click .close":"destory","click .submit_btn":"click_submit","keypress .txt":"keytest"}};var a=['<div class="moodpop moodpop-pl saymore">','<div class="hd">','<a href="javascript:void(0)" class="close"></a>',"<h4>文字比表情更深刻，更有力</h4>","</div>",'<div class="bd">',' <div class="tip"><img width="16" height="13" src="http://comment.news.sohu.com/upload/comment4_1/images/bq_23.png">表情发表成功，您可以继续说两句：</div>',' <div class="pub">','<input type="text" maxlength="2000" value="" class="txt">','<input type="button" class="submit_btn btn">','</div><div class="error-tip"></div>',"</div>","</div>"].join("");b.prototype={render:function(){var g=this;this.$el.append(a);this.$el.find(".txt").val(this.defaultText).attr("placeholder",this.defaultText).focus().select();for(var f in this.events){var h=f.substr(f.indexOf(" ")+1);var e=f.substr(0,f.indexOf(" "));var d=e+" "+h;this.$el.find(".saymore").find(h).attr("data-event-rel",d).bind(e,function(i){g[g.events[$(i.target).attr("data-event-rel")]].call(g,i)})}this.$el.find(".saymore").css({top:$("#changyanface").position().top+40,left:$("#changyanface").position().left+160})},submit:function(e){var d=e==this.defaultText;c(e,this.topicId,this.changYanId,this.voteId,this.afterSubmitCallback,d)},click_submit:function(){var d=this.$el.find(".txt").val();if(/^\s*$/ig.test(d)){this.$el.find(".error-tip").html("请输入文字后评论");return}this.submit(d)},keytest:function(d){this.$el.find(".error-tip").html("");if(d.keyCode===13){this.click_submit()}},destory:function(){this.$el.find(".saymore").remove()}};window.changYanSayMore=b})();